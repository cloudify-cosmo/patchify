diff --git a/dist/appData/widgets/sitesMap/widget.js b/dist/appData/widgets/sitesMap/widget.js
index e47dae4..95af45e 100644
--- a/dist/appData/widgets/sitesMap/widget.js
+++ b/dist/appData/widgets/sitesMap/widget.js
@@ -1 +1 @@
-!function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/console",n(n.s=57)}({0:function(e,t){e.exports=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}},1:function(e,t){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},2:function(e,t){function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e.exports=function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}},3:function(e,t,n){var r=n(7),i=n(6);e.exports=function(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?i(e):t}},4:function(e,t){function n(t){return e.exports=n=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},n(t)}e.exports=n},5:function(e,t,n){var r=n(8);e.exports=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&r(e,t)}},57:function(e,t,n){"use strict";n.r(t);var r=n(0),i=n.n(r),o=n(9),a=n.n(o),s=n(1),u=n.n(s),c=n(2),l=n.n(c),p=n(3),d=n.n(p),f=n(4),m=n.n(f),y=n(5),g=n.n(y),b=function(e){function t(){return u()(this,t),d()(this,m()(t).apply(this,arguments))}return g()(t,e),l()(t,[{key:"_goToDeploymentsPage",value:function(e){var t=this;return new Promise((function(e){e(t.props.toolbox.goToPage("deployments"))})).then((function(){return t.props.toolbox.getContext().setValue("siteName",e)}))}},{key:"render",value:function(){var e=this,t=Stage.Basic.Grid,n=this.props.site,r=Stage.Common,i=r.DeploymentStates,o=r.GroupState;return React.createElement("span",null,React.createElement(h,{name:n.name}),React.createElement(t,{columns:4,container:!0},React.createElement(t.Row,null,_.map(i.groupStates,(function(r,i){var a=n.deploymentStates[i].length,s=React.createElement(v,{description:r.description,value:a});return React.createElement(t.Column,{key:r.name,textAlign:"center",className:"deploymentState"},React.createElement(o,{state:r,value:a,className:"deploymentState",onClick:function(){return e._goToDeploymentsPage(n.name)},description:s}))})))))}}]),t}(React.Component);function h(e){var t=e.name,n=Stage.Basic,r=n.Popup,i=n.Header,o=function(e){return React.createElement(i,{as:"h5",className:"ui header dividing"},e)};return t.length<50?o(t):React.createElement(r,{content:t,trigger:o("".concat(t.slice(0,47),"..."))})}function v(e){var t=e.description,n=e.value;return React.createElement("span",null,React.createElement("strong",null,n)," ",t)}function P(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}i()(b,"propTypes",{site:PropTypes.shape({name:PropTypes.string.isRequired,deploymentStates:PropTypes.shape({pending:PropTypes.array.isRequired,inProgress:PropTypes.array.isRequired,good:PropTypes.array.isRequired,failed:PropTypes.array.isRequired}).isRequired}).isRequired,toolbox:PropTypes.object.isRequired});var O=function(e){function t(e){var n;return u()(this,t),(n=d()(this,m()(t).call(this,e))).mapRef=React.createRef(),n.state={isMapAvailable:!0},n}return g()(t,e),l()(t,[{key:"shouldComponentUpdate",value:function(e,t){var n=this.props,r=n.attribution,i=n.data,o=n.dimensions,a=n.mapUrl,s=n.showAllLabels,u=n.sitesAreDefined,c=n.tilesUrlTemplate,l=this.state.isMapAvailable;return!(_.isEqual(r,e.attribution)&&_.isEqual(i,e.data)&&_.isEqual(o,e.dimensions)&&_.isEqual(a,e.mapUrl)&&_.isEqual(s,e.showAllLabels)&&_.isEqual(u,e.sitesAreDefined)&&_.isEqual(c,e.tilesUrlTemplate)&&_.isEqual(l,t.isMapAvailable))}},{key:"componentDidMount",value:function(){var e=this,t=this.props,n=t.mapUrl;t.toolbox.getExternal().isReachable(n).then((function(t){return e.setState({isMapAvailable:t})}))}},{key:"componentDidUpdate",value:function(e){var t=this,n=this.props.dimensions;if(e.dimensions!==n){setTimeout((function(){return t.mapRef.current.leafletElement.invalidateSize()}),500)}}},{key:"_openPopup",value:function(e){e&&e.leafletElement&&window.setTimeout((function(){e.leafletElement.openPopup()}))}},{key:"_createMarkers",value:function(){var e=this,t=[],n=this.props,r=n.data,i=n.showAllLabels,o=n.toolbox,a=i?this._openPopup:void 0;return _.forEach(r,(function(n){var r=(0,Stage.Common.createMarkerIcon)(n.color),i=Stage.Basic.Leaflet,s=i.Marker,u=i.Popup;t.push(React.createElement(s,{position:e._mapToLatLng(n),ref:a,key:"siteMarker".concat(n.name),riseOnHover:!0,icon:r},React.createElement(u,{interactive:!0,autoClose:!1,closeOnClick:!1},React.createElement(b,{site:n,toolbox:o}))))})),t}},{key:"_mapToLatLng",value:function(e){return[e.latitude,e.longitude]}},{key:"render",value:function(){var e=Stage.Basic.Leaflet,t=e.Map,n=e.TileLayer,r=this.props,o=r.attribution,s=r.sitesAreDefined,u=r.tilesUrlTemplate;if(!this.state.isMapAvailable){return React.createElement(T,{text:"The widget content cannot be displayed because there is no connection \n                                         to the maps repository. Please check network connection and widget's configuration."})}var c=this._createMarkers();if(_.isEmpty(c))return React.createElement(S,{sitesAreDefined:s});var l=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?P(Object(n),!0).forEach((function(t){i()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):P(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},Stage.Common.Consts.leaflet.mapOptions),p=_.values(this.props.data);return p.length>1?l.bounds=L.latLngBounds(p.map(this._mapToLatLng)).pad(.05):(l.center=this._mapToLatLng(p[0]),l.zoom=Stage.Common.Consts.leaflet.initialZoom),React.createElement(t,a()({ref:this.mapRef,className:"sites-map"},l),React.createElement(n,{attribution:o,url:u}),c)}}]),t}(React.Component);i()(O,"propTypes",{sitesAreDefined:PropTypes.bool.isRequired,toolbox:PropTypes.object.isRequired,data:PropTypes.objectOf(PropTypes.shape({name:PropTypes.string.isRequired,color:PropTypes.string.isRequired,latitude:PropTypes.number.isRequired,longitude:PropTypes.number.isRequired,deploymentStates:PropTypes.shape({pending:PropTypes.array.isRequired,inProgress:PropTypes.array.isRequired,good:PropTypes.array.isRequired,failed:PropTypes.array.isRequired}).isRequired})).isRequired,dimensions:PropTypes.shape({height:PropTypes.number.isRequired,width:PropTypes.number.isRequired,maximized:PropTypes.bool}).isRequired,mapUrl:PropTypes.string.isRequired,tilesUrlTemplate:PropTypes.string.isRequired,attribution:PropTypes.string.isRequired,showAllLabels:PropTypes.bool.isRequired});var R=connectToStore((function(e){return _.get(e,"config.app.maps",(function(){return{}}))}),{})(O);function S(e){var t=e.sitesAreDefined,n="This widget shares site location and status info.\n                             There is no data to display because ".concat(t?"the defined sites have no location":"no sites are defined",". Sites can be added in the ");return React.createElement(T,{text:n,addLink:!0})}function T(e){var t=e.text,n=e.addLink,r=Stage.Basic,i=r.Link,o=r.Message,a=r.MessageContainer;return React.createElement(a,{wide:!0,margin:"30px auto"},React.createElement(o,null,t,n&&React.createElement(i,{to:"/page/site_management"},"Site Management page.")))}function E(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function w(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?E(Object(n),!0).forEach((function(t){i()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):E(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}Stage.defineWidget({id:"sitesMap",name:"Sites Map",description:"This widget displays a map view of sites by location with site deployments status summary",initialWidth:6,initialHeight:30,color:"green",isReact:!0,hasReadme:!0,hasStyle:!0,permission:Stage.GenericConfig.WIDGET_PERMISSION("sitesMap"),categories:[Stage.GenericConfig.CATEGORY.SPIRE],supportedEditions:[Stage.Common.Consts.licenseEdition.spire],initialConfiguration:[Stage.GenericConfig.POLLING_TIME_CONFIG(10),{id:"showAllLabels",name:"Show all the site labels",default:!1,type:Stage.Basic.GenericField.BOOLEAN_TYPE}],processSite:function(e,t,n,r,i){var o=Stage.Common.DeploymentStates,a=o.groupStates,s=o.getDeploymentState,u=o.GOOD_STATE,c=_.reduce(a,(function(e,t,n){return e[n]=[],e}),{});_.forEach(n[e.name],(function(e){var t=_.first(r[e.id]),n=s(e.id,i,t);c[n].push(e.id),a[n].severity>a[u].severity&&(u=n)})),t[e.name]=w({},e),t[e.name].deploymentStates=c,t[e.name].color=n[e.name]?a[u].colorSUI:"grey"},processData:function(e){var t=this,n=_.reduce(e[2].items,(function(e,t){return e[t.deployment_id]={states:_.reduce(t["by state"],(function(e,t){return e[t.state]=t.node_instances,e}),{}),count:t.node_instances},e}),{}),r=e[0],i=_.groupBy(e[1].items,"site_name"),o=_.groupBy(e[3].items,"deployment_id"),a={};_.forEach(r,(function(e){t.processSite(e,a,i,o,n)}));var s=e[4].items.length>0;return{siteStatuses:a,sitesAreDefined:s}},fetchParams:function(e,t){return{blueprint_id:t.getContext().getValue("blueprintId"),id:t.getContext().getValue("deploymentId")}},fetchData:function(e,t,n){var r=t.getManager().doGet("/sites",{_include:"name,latitude,longitude",_get_all_results:!0}),i=r.then((function(e){return _.filter(e.items,(function(e){return!_.isNil(e.latitude)}))})),o=i.then((function(e){return _.map(e.items,(function(e){return e.name}))})).then((function(e){return t.getManager().doGet("/deployments",w({_include:"id,site_name",_get_all_results:!0,site_name:e},n))})),a=o.then((function(e){return _.map(e.items,(function(e){return e.id}))})),s=a.then((function(e){return t.getManager().doGet("/summary/node_instances",{_target_field:"deployment_id",_sub_field:"state",_get_all_results:!0,deployment_id:e})})),u=a.then((function(e){return t.getManager().doGet("/executions",{_include:"id,deployment_id,workflow_id,status,status_display,created_at,ended_at",_sort:"-ended_at",_get_all_results:!0,deployment_id:e})}));return Promise.all([i,o,s,u,r])},render:function(e,t,n,r){if(_.isEmpty(t))return React.createElement(Stage.Basic.Loading,null);var i=this.processData(t),o=i.siteStatuses,a=i.sitesAreDefined;return React.createElement(R,{data:o,dimensions:{height:e.height,width:e.width,maximized:e.maximized||!1},showAllLabels:e.configuration.showAllLabels,sitesAreDefined:a,toolbox:r})}})},6:function(e,t){e.exports=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}},7:function(e,t){function n(t){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?e.exports=n=function(e){return typeof e}:e.exports=n=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(t)}e.exports=n},8:function(e,t){function n(t,r){return e.exports=n=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},n(t,r)}e.exports=n},9:function(e,t){function n(){return e.exports=n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},n.apply(this,arguments)}e.exports=n}});
\ No newline at end of file
+!function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/console",n(n.s=56)}({0:function(e,t){e.exports=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}},1:function(e,t){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},2:function(e,t){function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e.exports=function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}},3:function(e,t,n){var r=n(7),i=n(6);e.exports=function(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?i(e):t}},4:function(e,t){function n(t){return e.exports=n=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},n(t)}e.exports=n},5:function(e,t,n){var r=n(8);e.exports=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&r(e,t)}},56:function(e,t,n){"use strict";n.r(t);var r=n(0),i=n.n(r),o=n(9),a=n.n(o),s=n(1),u=n.n(s),c=n(2),l=n.n(c),p=n(3),d=n.n(p),f=n(4),m=n.n(f),y=n(5),g=n.n(y),b=function(e){function t(){return u()(this,t),d()(this,m()(t).apply(this,arguments))}return g()(t,e),l()(t,[{key:"_goToDeploymentsPage",value:function(e){var t=this;return new Promise((function(e){e(t.props.toolbox.goToPage("deployments"))})).then((function(){return t.props.toolbox.getContext().setValue("siteName",e)}))}},{key:"render",value:function(){var e=this,t=Stage.Basic.Grid,n=this.props.site,r=Stage.Common,i=r.DeploymentStates,o=r.GroupState;return React.createElement("span",null,React.createElement(h,{name:n.name}),React.createElement(t,{columns:4,container:!0},React.createElement(t.Row,null,_.map(i.groupStates,(function(r,i){var a=n.deploymentStates[i].length,s=React.createElement(v,{description:r.description,value:a});return React.createElement(t.Column,{key:r.name,textAlign:"center",className:"deploymentState"},React.createElement(o,{state:r,value:a,className:"deploymentState",onClick:function(){return e._goToDeploymentsPage(n.name)},description:s}))})))))}}]),t}(React.Component);function h(e){var t=e.name,n=Stage.Basic,r=n.Popup,i=n.Header,o=function(e){return React.createElement(i,{as:"h5",className:"ui header dividing"},e)};return t.length<50?o(t):React.createElement(r,{content:t,trigger:o("".concat(t.slice(0,47),"..."))})}function v(e){var t=e.description,n=e.value;return React.createElement("span",null,React.createElement("strong",null,n)," ",t)}i()(b,"propTypes",{site:PropTypes.shape({name:PropTypes.string.isRequired,deploymentStates:PropTypes.shape({pending:PropTypes.array.isRequired,inProgress:PropTypes.array.isRequired,good:PropTypes.array.isRequired,failed:PropTypes.array.isRequired}).isRequired}).isRequired,toolbox:PropTypes.object.isRequired});var P=function(e){function t(e){var n;return u()(this,t),(n=d()(this,m()(t).call(this,e))).mapRef=React.createRef(),n.state={isMapAvailable:null},n}return g()(t,e),l()(t,[{key:"shouldComponentUpdate",value:function(e,t){var n=this.props,r=n.attribution,i=n.data,o=n.dimensions,a=n.showAllLabels,s=n.sitesAreDefined,u=this.state.isMapAvailable;return!(_.isEqual(r,e.attribution)&&_.isEqual(i,e.data)&&_.isEqual(o,e.dimensions)&&_.isEqual(a,e.showAllLabels)&&_.isEqual(s,e.sitesAreDefined)&&_.isEqual(u,t.isMapAvailable))}},{key:"componentDidMount",value:function(){var e=this,t=this.props.toolbox;return new(0,Stage.Common.MapsActions)(t).isAvailable().then((function(t){return e.setState({isMapAvailable:t})}))}},{key:"componentDidUpdate",value:function(e){var t=this,n=this.props.dimensions;if(e.dimensions!==n){setTimeout((function(){return t.mapRef.current.leafletElement.invalidateSize()}),500)}}},{key:"openPopup",value:function(e){e&&e.leafletElement&&window.setTimeout((function(){e.leafletElement.openPopup()}))}},{key:"createMarkers",value:function(){var e=this,t=[],n=this.props,r=n.data,i=n.showAllLabels,o=n.toolbox,a=i?this.openPopup:void 0;return _.forEach(r,(function(n){var r=(0,Stage.Common.createMarkerIcon)(n.color),i=Stage.Basic.Leaflet,s=i.Marker,u=i.Popup;t.push(React.createElement(s,{position:e.mapToLatLng(n),ref:a,key:"siteMarker".concat(n.name),riseOnHover:!0,icon:r},React.createElement(u,{interactive:!0,autoClose:!1,closeOnClick:!1},React.createElement(b,{site:n,toolbox:o}))))})),t}},{key:"mapToLatLng",value:function(e){return[e.latitude,e.longitude]}},{key:"render",value:function(){var e=Stage.Basic,t=e.Leaflet,n=e.Loading,r=t.Map,i=t.TileLayer,o=this.props,s=o.attribution,u=o.data,c=o.sitesAreDefined,l=this.state.isMapAvailable;if(null===l)return React.createElement(n,null);if(!1===l){return React.createElement(T,{text:"The widget content cannot be displayed because there is no connection \n                                         to the maps repository. Please check network connection and widget's configuration."})}var p=this.createMarkers();if(_.isEmpty(p))return React.createElement(S,{sitesAreDefined:c});var d=Stage.Common.Consts.leaflet,f=d.initialZoom,m=d.mapOptions,y=d.urlTemplate,g=Stage.Utils.Url.url(y),b=_.values(u);return b.length>1?m.bounds=L.latLngBounds(b.map(this.mapToLatLng)).pad(.05):(m.center=this.mapToLatLng(b[0]),m.zoom=f),React.createElement(r,a()({ref:this.mapRef,className:"sites-map"},m),React.createElement(i,{attribution:s,url:g}),p)}}]),t}(React.Component);i()(P,"propTypes",{sitesAreDefined:PropTypes.bool.isRequired,toolbox:PropTypes.object.isRequired,data:PropTypes.objectOf(PropTypes.shape({name:PropTypes.string.isRequired,color:PropTypes.string.isRequired,latitude:PropTypes.number.isRequired,longitude:PropTypes.number.isRequired,deploymentStates:PropTypes.shape({pending:PropTypes.array.isRequired,inProgress:PropTypes.array.isRequired,good:PropTypes.array.isRequired,failed:PropTypes.array.isRequired}).isRequired})).isRequired,dimensions:PropTypes.shape({height:PropTypes.number.isRequired,width:PropTypes.number.isRequired,maximized:PropTypes.bool}).isRequired,attribution:PropTypes.string.isRequired,showAllLabels:PropTypes.bool.isRequired});var R=connectToStore((function(e){return _.get(e,"config.app.maps",(function(){return{}}))}),{})(P);function S(e){var t=e.sitesAreDefined,n="This widget shares site location and status info.\n                             There is no data to display because ".concat(t?"the defined sites have no location":"no sites are defined",". Sites can be added in the ");return React.createElement(T,{text:n,addLink:!0})}function T(e){var t=e.text,n=e.addLink,r=Stage.Basic,i=r.Link,o=r.Message,a=r.MessageContainer;return React.createElement(a,{wide:!0,margin:"30px auto"},React.createElement(o,null,t,n&&React.createElement(i,{to:"/page/site_management"},"Site Management page.")))}function E(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function O(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?E(Object(n),!0).forEach((function(t){i()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):E(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}Stage.defineWidget({id:"sitesMap",name:"Sites Map",description:"This widget displays a map view of sites by location with site deployments status summary",initialWidth:6,initialHeight:30,color:"green",isReact:!0,hasReadme:!0,hasStyle:!0,permission:Stage.GenericConfig.WIDGET_PERMISSION("sitesMap"),categories:[Stage.GenericConfig.CATEGORY.SPIRE],supportedEditions:[Stage.Common.Consts.licenseEdition.spire],initialConfiguration:[Stage.GenericConfig.POLLING_TIME_CONFIG(10),{id:"showAllLabels",name:"Show all the site labels",default:!1,type:Stage.Basic.GenericField.BOOLEAN_TYPE}],processSite:function(e,t,n,r,i){var o=Stage.Common.DeploymentStates,a=o.groupStates,s=o.getDeploymentState,u=o.GOOD_STATE,c=_.reduce(a,(function(e,t,n){return e[n]=[],e}),{});_.forEach(n[e.name],(function(e){var t=_.first(r[e.id]),n=s(e.id,i,t);c[n].push(e.id),a[n].severity>a[u].severity&&(u=n)})),t[e.name]=O({},e),t[e.name].deploymentStates=c,t[e.name].color=n[e.name]?a[u].colorSUI:"grey"},processData:function(e){var t=this,n=_.reduce(e[2].items,(function(e,t){return e[t.deployment_id]={states:_.reduce(t["by state"],(function(e,t){return e[t.state]=t.node_instances,e}),{}),count:t.node_instances},e}),{}),r=e[0],i=_.groupBy(e[1].items,"site_name"),o=_.groupBy(e[3].items,"deployment_id"),a={};_.forEach(r,(function(e){t.processSite(e,a,i,o,n)}));var s=e[4].items.length>0;return{siteStatuses:a,sitesAreDefined:s}},fetchParams:function(e,t){return{blueprint_id:t.getContext().getValue("blueprintId"),id:t.getContext().getValue("deploymentId")}},fetchData:function(e,t,n){var r=t.getManager().doGet("/sites",{_include:"name,latitude,longitude",_get_all_results:!0}),i=r.then((function(e){return _.filter(e.items,(function(e){return!_.isNil(e.latitude)}))})),o=i.then((function(e){return _.map(e.items,(function(e){return e.name}))})).then((function(e){return t.getManager().doGet("/deployments",O({_include:"id,site_name",_get_all_results:!0,site_name:e},n))})),a=o.then((function(e){return _.map(e.items,(function(e){return e.id}))})),s=a.then((function(e){return t.getManager().doGet("/summary/node_instances",{_target_field:"deployment_id",_sub_field:"state",_get_all_results:!0,deployment_id:e})})),u=a.then((function(e){return t.getManager().doGet("/executions",{_include:"id,deployment_id,workflow_id,status,status_display,created_at,ended_at",_sort:"-ended_at",_get_all_results:!0,deployment_id:e})}));return Promise.all([i,o,s,u,r])},render:function(e,t,n,r){if(_.isEmpty(t))return React.createElement(Stage.Basic.Loading,null);var i=this.processData(t),o=i.siteStatuses,a=i.sitesAreDefined;return React.createElement(R,{data:o,dimensions:{height:e.height,width:e.width,maximized:e.maximized||!1},showAllLabels:e.configuration.showAllLabels,sitesAreDefined:a,toolbox:r})}})},6:function(e,t){e.exports=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}},7:function(e,t){function n(t){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?e.exports=n=function(e){return typeof e}:e.exports=n=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(t)}e.exports=n},8:function(e,t){function n(t,r){return e.exports=n=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},n(t,r)}e.exports=n},9:function(e,t){function n(){return e.exports=n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},n.apply(this,arguments)}e.exports=n}});
\ No newline at end of file
