diff --git a/dist/appData/widgets/sites/widget.js b/dist/appData/widgets/sites/widget.js
index 211de9e..e17fe28 100644
--- a/dist/appData/widgets/sites/widget.js
+++ b/dist/appData/widgets/sites/widget.js
@@ -1 +1 @@
-!function(e){var t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(o,r,function(t){return e[t]}.bind(null,r));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/console",n(n.s=44)}([function(e,t){e.exports=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}},function(e,t){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},function(e,t){function n(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}e.exports=function(e,t,o){return t&&n(e.prototype,t),o&&n(e,o),e}},function(e,t,n){var o=n(7),r=n(6);e.exports=function(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?r(e):t}},function(e,t){function n(t){return e.exports=n=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},n(t)}e.exports=n},function(e,t,n){var o=n(8);e.exports=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&o(e,t)}},function(e,t){e.exports=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}},function(e,t){function n(t){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?e.exports=n=function(e){return typeof e}:e.exports=n=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(t)}e.exports=n},function(e,t){function n(t,o){return e.exports=n=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},n(t,o)}e.exports=n},function(e,t){function n(){return e.exports=n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},n.apply(this,arguments)}e.exports=n},,,,,,function(e,t){e.exports=function(e){if(Array.isArray(e))return e}},function(e,t){e.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}},function(e,t,n){var o=n(15),r=n(19),i=n(16);e.exports=function(e,t){return o(e)||r(e,t)||i()}},,function(e,t){e.exports=function(e,t){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)){var n=[],o=!0,r=!1,i=void 0;try{for(var a,s=e[Symbol.iterator]();!(o=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);o=!0);}catch(e){r=!0,i=e}finally{try{o||null==s.return||s.return()}finally{if(r)throw i}}return n}}},,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";n.r(t);var o=n(0),r=n.n(o),i=n(17),a=n.n(i),s=n(1),l=n.n(s),c=n(2),u=n.n(c),p=n(3),h=n.n(p),f=n(4),d=n.n(f),m=n(5),b=n.n(m),y=function(){function e(t){l()(this,e),this.toolbox=t}return u()(e,[{key:"doGet",value:function(e){return this.toolbox.getManager().doGet("/sites/".concat(e))}},{key:"doDelete",value:function(e){return this.toolbox.getManager().doDelete("/sites/".concat(e))}},{key:"doCreate",value:function(e,t,n){return this.toolbox.getManager().doPut("/sites/".concat(e),null,{location:n,visibility:t})}},{key:"doUpdate",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=_.omitBy({location:n,visibility:t,new_name:o},_.isNil);return this.toolbox.getManager().doPost("/sites/".concat(e),null,r)}}]),e}(),g=n(9),v=n.n(g),E=function(e){function t(e,n){var o;return l()(this,t),(o=h()(this,d()(t).call(this,e,n))).initialLocation=o.props.location,o.toolbox=Stage.Utils.getToolbox((function(){}),(function(){}),null),o.state={isMapAvailable:!0},o}return b()(t,e),u()(t,[{key:"componentDidMount",value:function(){var e=this,t=this.props.mapUrl;this.toolbox.getExternal().isReachable(t).then((function(t){return e.setState({isMapAvailable:t})}))}},{key:"toLatLng",value:function(e){return _(e).split(",").map((function(e){return parseFloat(e)||0})).concat(0,0).take(2).value()}},{key:"render",value:function(){var e=Stage.Basic,t=e.Leaflet,n=e.Message,o=Stage.Common,r=o.Consts,i=o.createMarkerIcon,a=this.props,s=a.attribution,l=a.location,c=a.mapOptions,u=a.tilesUrlTemplate;if(!this.state.isMapAvailable){return React.createElement(n,{warning:!0,style:{display:"block"}},"Map cannot be displayed because there is no connection \n                                         to the maps repository. Please check network connection.")}return React.createElement(t.Map,v()({},c,r.leaflet.mapOptions,{zoom:r.leaflet.initialZoom,center:this.toLatLng(this.initialLocation)}),React.createElement(t.TileLayer,{attribution:s,url:u}),l&&React.createElement(t.Marker,{position:this.toLatLng(l),icon:i("grey")}))}}]),t}(React.Component);r()(E,"propTypes",{attribution:PropTypes.string.isRequired,location:PropTypes.string.isRequired,mapOptions:PropTypes.object.isRequired,mapUrl:PropTypes.string.isRequired,tilesUrlTemplate:PropTypes.string.isRequired});var O=connectToStore((function(e){return _.get(e,"config.app.maps",(function(){return{}}))}),{})(E),S=function(e){function t(e,n){var o;return l()(this,t),(o=h()(this,d()(t).call(this,e,n))).state={mapOpen:!1,value:e.value||""},o}return b()(t,e),u()(t,[{key:"componentDidUpdate",value:function(e){this.props.value!==e.value&&this.setState(_.pick(this.props,"value"))}},{key:"onLocationChange",value:function(e){var t=this.props.onChange;this.setState({value:e},(function(){return t(null,{name:"siteLocation",value:e})}))}},{key:"render",value:function(){var e=this,t=Stage.Basic,n=t.Button,o=t.Form,r=this.state,i=r.mapOpen,a=r.value;return React.createElement(React.Fragment,null,React.createElement(o.Input,{label:"Location",value:a,placeholder:"latitude, longitude (32.166369, 34.810893)",onChange:function(t,n){return e.onLocationChange(n.value)},action:React.createElement(n,{active:i,icon:"crosshairs",onClick:function(){return e.setState({mapOpen:!i})}})}),i&&React.createElement(O,{location:a,mapOptions:{onClick:function(t){return e.onLocationChange("".concat(t.latlng.lat,", ").concat(t.latlng.lng))},style:{height:"calc(100vh - 344px)",maxHeight:460,marginTop:-14,cursor:"pointer"}}}))}}]),t}(React.Component);function R(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}r()(S,"propTypes",{onChange:PropTypes.func.isRequired,value:PropTypes.string.isRequired});var C=function(e){function t(e,n){var o;return l()(this,t),(o=h()(this,d()(t).call(this,e,n))).state=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?R(Object(n),!0).forEach((function(t){r()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):R(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},t.initialState,{open:!1}),o}return b()(t,e),u()(t,[{key:"onApprove",value:function(){return this._createSite(),!1}},{key:"onCancel",value:function(){return this.setState({open:!1}),!0}},{key:"componentDidUpdate",value:function(e,n){!n.open&&this.state.open&&this.setState(t.initialState)}},{key:"_createSite",value:function(){var e=this,t={};if(_.isEmpty(this.state.siteName)&&(t.siteName="Please provide site name"),!_.isEmpty(t))return this.setState({errors:t}),!1;this.setState({loading:!0}),new y(this.props.toolbox).doCreate(this.state.siteName,this.state.siteVisibility,this.state.siteLocation).then((function(){e.setState({errors:{},loading:!1,open:!1}),e.props.toolbox.refresh()})).catch((function(t){e.setState({errors:{error:t.message},loading:!1})}))}},{key:"_handleInputChange",value:function(e,t){this.setState(Stage.Basic.Form.fieldNameValue(t))}},{key:"render",value:function(){var e=this,t=Stage.Basic,n=t.ApproveButton,o=t.Button,r=t.CancelButton,i=t.Icon,a=t.Form,s=t.Modal,l=t.VisibilityField,c=React.createElement(o,{content:"Create",icon:"add",labelPosition:"left"});return React.createElement(s,{trigger:c,open:this.state.open,onOpen:function(){return e.setState({open:!0})},onClose:function(){return e.setState({open:!1})}},React.createElement(s.Header,null,React.createElement(i,{name:"add"})," Create site",React.createElement(l,{visibility:this.state.siteVisibility,className:"rightFloated",onVisibilityChange:function(t){return e.setState({siteVisibility:t})}})),React.createElement(s.Content,null,React.createElement(a,{loading:this.state.loading,errors:this.state.errors,onErrorsDismiss:function(){return e.setState({errors:{}})}},React.createElement(a.Field,{label:"Name",error:this.state.errors.siteName,required:!0},React.createElement(a.Input,{name:"siteName",value:this.state.siteName,onChange:this._handleInputChange.bind(this)})),React.createElement(a.Field,{error:this.state.errors.siteLocation},React.createElement(S,{onChange:this._handleInputChange.bind(this)})))),React.createElement(s.Actions,null,React.createElement(r,{onClick:this.onCancel.bind(this),disabled:this.state.loading}),React.createElement(n,{onClick:this.onApprove.bind(this),disabled:this.state.loading,content:"Create",icon:"add",color:"green"})))}}]),t}(React.Component);function w(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}r()(C,"initialState",{loading:!1,siteName:"",siteLocation:"",siteVisibility:Stage.Common.Consts.defaultVisibility,errors:{}}),r()(C,"propTypes",{toolbox:PropTypes.object.isRequired});var T=function(e){function t(e,n){var o;return l()(this,t),(o=h()(this,d()(t).call(this,e,n))).state=t.initialState,o}return b()(t,e),u()(t,[{key:"onApprove",value:function(){return this._updateSite(),!1}},{key:"onCancel",value:function(){return this.props.onHide(),!0}},{key:"componentDidUpdate",value:function(e){!e.open&&this.props.open&&this.setState(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?w(Object(n),!0).forEach((function(t){r()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):w(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},t.initialState,{siteNewName:this.props.site.name,siteLocation:this.props.site.location||""}))}},{key:"_updateSite",value:function(){var e=this;this.setState({loading:!0}),new y(this.props.toolbox).doUpdate(this.props.site.name,null,this.state.siteLocation,this.state.siteNewName).then((function(){e.setState({errors:{},loading:!1}),e.props.toolbox.refresh(),e.props.onHide()})).catch((function(t){e.setState({errors:{error:t.message},loading:!1})}))}},{key:"_handleInputChange",value:function(e,t){this.setState(Stage.Basic.Form.fieldNameValue(t))}},{key:"render",value:function(){var e=this,t=Stage.Basic,n=t.Modal,o=t.Icon,r=t.Form,i=t.ApproveButton,a=t.CancelButton;return React.createElement("div",null,React.createElement(n,{open:this.props.open,onClose:function(){return e.props.onHide()}},React.createElement(n.Header,null,React.createElement(o,{name:"edit"})," Update site ",this.props.site.name),React.createElement(n.Content,null,React.createElement(r,{loading:this.state.loading,errors:this.state.errors,onErrorsDismiss:function(){return e.setState({errors:{}})}},React.createElement(r.Field,{error:this.state.errors.siteNewName},React.createElement(r.Input,{label:"Name",name:"siteNewName",value:this.state.siteNewName,onChange:this._handleInputChange.bind(this)})),React.createElement(r.Field,{error:this.state.errors.siteLocation},React.createElement(S,{value:this.state.siteLocation,onChange:this._handleInputChange.bind(this)})))),React.createElement(n.Actions,null,React.createElement(a,{onClick:this.onCancel.bind(this),disabled:this.state.loading}),React.createElement(i,{onClick:this.onApprove.bind(this),disabled:this.state.loading,content:"Update",icon:"edit",color:"green"}))))}}]),t}(React.Component);function P(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function j(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?P(Object(n),!0).forEach((function(t){r()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):P(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}r()(T,"initialState",{loading:!1,errors:{},siteNewName:""}),r()(T,"propTypes",{site:PropTypes.object.isRequired,toolbox:PropTypes.object.isRequired,open:PropTypes.bool.isRequired,onHide:PropTypes.func.isRequired});var x=function(e){function t(e,n){var o;return l()(this,t),(o=h()(this,d()(t).call(this,e,n))).state={error:null,showModal:!1,modalType:"",site:{}},o}return b()(t,e),u()(t,[{key:"shouldComponentUpdate",value:function(e,t){return!_.isEqual(this.props.widget,e.widget)||!_.isEqual(this.state,t)||!_.isEqual(this.props.data,e.data)}},{key:"_refreshData",value:function(){this.setState({error:null}),this.props.toolbox.refresh()}},{key:"componentDidMount",value:function(){this.props.toolbox.getEventBus().on("sites:refresh",this._refreshData,this)}},{key:"componentWillUnmount",value:function(){this.props.toolbox.getEventBus().off("sites:refresh",this._refreshData)}},{key:"fetchGridData",value:function(e){return this.props.toolbox.refresh(e)}},{key:"_onDeleteSite",value:function(e){this.setState({site:e,modalType:t.DELETE_SITE_ACTION,showModal:!0})}},{key:"_onUpdateSite",value:function(e){this.setState({site:e,modalType:t.UPDATE_SITE_ACTION,showModal:!0})}},{key:"_setSiteVisibility",value:function(e,t){var n=this,o=new y(this.props.toolbox);this.props.toolbox.loading(!0),o.doUpdate(e,t).then((function(){n.props.toolbox.loading(!1),n.props.toolbox.refresh()})).catch((function(e){n.props.toolbox.loading(!1),n.setState({error:e.message})}))}},{key:"_deleteSite",value:function(){var e=this,n={modalType:t.DELETE_SITE_ACTION,showModal:!1};new y(this.props.toolbox).doDelete(this.state.site.name).then((function(){e.setState(j({},n,{error:null})),e.props.toolbox.getEventBus().trigger("sites:refresh")})).catch((function(t){e.setState(j({},n,{error:t.message}))}))}},{key:"_hideModal",value:function(){this.setState({showModal:!1})}},{key:"render",value:function(){var e,n=this,o=Stage.Basic,r=o.DataTable,i=o.ErrorMessage,s=o.Icon,l=o.ResourceVisibility,c=o.Label,u=o.Popup,p=Stage.Basic.Confirm,h=this.props.data,f=null;return React.createElement("div",null,React.createElement(i,{error:this.state.error,onDismiss:function(){return n.setState({error:null})},autoHide:!0}),React.createElement(r,{fetchData:this.fetchGridData.bind(this),totalSize:h.total,pageSize:this.props.widget.configuration.pageSize,sortColumn:this.props.widget.configuration.sortColumn,sortAscending:this.props.widget.configuration.sortAscending,searchable:!0,className:"sitesTable",noDataMessage:'There are no Sites available. Click "Create" to create Sites.'},React.createElement(r.Column,{label:"Name",name:"name",width:"20%"}),React.createElement(r.Column,{label:"Location",width:"20%"}),React.createElement(r.Column,{label:"Created",name:"created_at",width:"20%"}),React.createElement(r.Column,{label:"Creator",name:"created_by",width:"10%"}),React.createElement(r.Column,{label:"Tenant",name:"tenant_name",width:"10%"}),React.createElement(r.Column,{label:"# Deployments",width:"10%"}),React.createElement(r.Column,{width:"10%"}),h.items.map((function(t){if(t.location){var o=t.location.split(","),i=a()(o,2);e=i[0],f=i[1]}return React.createElement(r.Row,{key:t.name},React.createElement(r.Data,null,t.name,React.createElement(l,{visibility:t.visibility,onSetVisibility:function(e){n._setSiteVisibility(t.name,e)},allowedSettingTo:["tenant","global"],className:"rightFloated"})),React.createElement(r.Data,null,t.location&&React.createElement(React.Fragment,null,"Latitude: ",e,", Longitude: ",f,React.createElement(u,{hoverable:!0},React.createElement(u.Trigger,null,React.createElement(s,{name:"crosshairs",link:!0,bordered:!0,className:"rightFloated",onClick:function(e){return e.stopPropagation()}})),React.createElement(u.Content,null,React.createElement(O,{location:t.location,mapOptions:{zoomControl:!1,style:{width:200,height:200}}}))))),React.createElement(r.Data,null,t.created_at),React.createElement(r.Data,null,t.created_by),React.createElement(r.Data,null,t.tenant_name),React.createElement(r.Data,null,React.createElement(c,{className:"blue",horizontal:!0},t.deploymentCount)),React.createElement(r.Data,{className:"center aligned rowActions"},React.createElement(s,{bordered:!0,link:!0,name:"edit",title:"Update site",onClick:n._onUpdateSite.bind(n,t)}),React.createElement(s,{bordered:!0,link:!0,name:"trash",title:"Delete site",onClick:n._onDeleteSite.bind(n,t)})))})),React.createElement(r.Action,null,React.createElement(C,{toolbox:this.props.toolbox}))),React.createElement(p,{content:"Are you sure you want to delete the site '".concat(this.state.site.name,"'?"),open:this.state.modalType===t.DELETE_SITE_ACTION&&this.state.showModal,onConfirm:this._deleteSite.bind(this),onCancel:this._hideModal.bind(this)}),React.createElement(T,{toolbox:this.props.toolbox,open:this.state.modalType===t.UPDATE_SITE_ACTION&&this.state.showModal,onHide:this._hideModal.bind(this),site:this.state.site}))}}]),t}(React.Component);function k(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}r()(x,"propTypes",{widget:PropTypes.object.isRequired,data:PropTypes.object.isRequired,toolbox:PropTypes.object.isRequired}),r()(x,"DELETE_SITE_ACTION","delete"),r()(x,"UPDATE_SITE_ACTION","update"),Stage.defineWidget({id:"sites",name:"Sites",description:"This widget shows a list of available sites and allow managing them",initialWidth:5,initialHeight:16,color:"blue",fetchUrl:{sites:"[manager]/sites[params]",siteDeploymentCount:"[manager]/summary/deployments?_target_field=site_name"},isReact:!0,hasReadme:!0,hasStyle:!0,permission:Stage.GenericConfig.WIDGET_PERMISSION("sites"),categories:[Stage.GenericConfig.CATEGORY.SYSTEM_RESOURCES],initialConfiguration:[Stage.GenericConfig.POLLING_TIME_CONFIG(30),Stage.GenericConfig.PAGE_SIZE_CONFIG(),Stage.GenericConfig.SORT_COLUMN_CONFIG("name"),Stage.GenericConfig.SORT_ASCENDING_CONFIG(!0)],render:function(e,t,n,o){if(_.isEmpty(t))return React.createElement(Stage.Basic.Loading,null);var i=t.sites,a=t.siteDeploymentCount,s={};_.forEach(a.items,(function(e){s[e.site_name]=e.deployments}));var l={items:_.map(i.items,(function(e){return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?k(Object(n),!0).forEach((function(t){r()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):k(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e,{created_at:Stage.Utils.Time.formatTimestamp(e.created_at),deploymentCount:s[e.name]||0})})),total:_.get(i,"metadata.pagination.total",0)};return React.createElement(x,{widget:e,data:l,toolbox:o})}})}]);
\ No newline at end of file
+!function(e){var t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(o,r,function(t){return e[t]}.bind(null,r));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/console",n(n.s=45)}([function(e,t){e.exports=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}},function(e,t){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},function(e,t){function n(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}e.exports=function(e,t,o){return t&&n(e.prototype,t),o&&n(e,o),e}},function(e,t,n){var o=n(7),r=n(6);e.exports=function(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?r(e):t}},function(e,t){function n(t){return e.exports=n=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},n(t)}e.exports=n},function(e,t,n){var o=n(8);e.exports=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&o(e,t)}},function(e,t){e.exports=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}},function(e,t){function n(t){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?e.exports=n=function(e){return typeof e}:e.exports=n=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(t)}e.exports=n},function(e,t){function n(t,o){return e.exports=n=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},n(t,o)}e.exports=n},function(e,t){function n(){return e.exports=n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},n.apply(this,arguments)}e.exports=n},,,,,,function(e,t){e.exports=function(e){if(Array.isArray(e))return e}},function(e,t){e.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}},function(e,t,n){var o=n(15),r=n(19),i=n(16);e.exports=function(e,t){return o(e)||r(e,t)||i()}},,function(e,t){e.exports=function(e,t){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)){var n=[],o=!0,r=!1,i=void 0;try{for(var a,s=e[Symbol.iterator]();!(o=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);o=!0);}catch(e){r=!0,i=e}finally{try{o||null==s.return||s.return()}finally{if(r)throw i}}return n}}},,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";n.r(t);var o=n(0),r=n.n(o),i=n(17),a=n.n(i),s=n(1),l=n.n(s),c=n(2),u=n.n(c),p=n(3),h=n.n(p),f=n(4),d=n.n(f),m=n(5),b=n.n(m),y=function(){function e(t){l()(this,e),this.toolbox=t}return u()(e,[{key:"doGet",value:function(e){return this.toolbox.getManager().doGet("/sites/".concat(e))}},{key:"doDelete",value:function(e){return this.toolbox.getManager().doDelete("/sites/".concat(e))}},{key:"doCreate",value:function(e,t,n){return this.toolbox.getManager().doPut("/sites/".concat(e),null,{location:n,visibility:t})}},{key:"doUpdate",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=_.omitBy({location:n,visibility:t,new_name:o},_.isNil);return this.toolbox.getManager().doPost("/sites/".concat(e),null,r)}}]),e}(),g=n(9),v=n.n(g),E=function(e){function t(e,n){var o;l()(this,t);var r=(o=h()(this,d()(t).call(this,e,n))).props.location;return o.initialLocation=r,o.state={isMapAvailable:null},o}return b()(t,e),u()(t,[{key:"componentDidMount",value:function(){var e=this,t=this.props.toolbox;return new(0,Stage.Common.MapsActions)(t).isAvailable().then((function(t){return e.setState({isMapAvailable:t})}))}},{key:"toLatLng",value:function(e){return _(e).split(",").map((function(e){return parseFloat(e)||0})).concat(0,0).take(2).value()}},{key:"render",value:function(){var e=Stage.Basic,t=e.Leaflet,n=e.Loading,o=e.Message,r=Stage.Common,i=r.Consts,a=r.createMarkerIcon,s=i.leaflet,l=s.mapOptions,c=s.initialZoom,u=s.urlTemplate,p=this.props,h=p.attribution,f=p.location,d=p.mapOptions,m=this.state.isMapAvailable,b=Stage.Utils.Url.url(u);if(null===m)return React.createElement("div",{style:{width:50,height:50,margin:"0 auto"}},React.createElement(n,null));if(!1===m){return React.createElement(o,{warning:!0,style:{display:"block"}},"Map cannot be displayed because there is no connection \n                                         to the maps repository. Please check network connection.")}return React.createElement(t.Map,v()({},d,l,{zoom:c,center:this.toLatLng(this.initialLocation)}),React.createElement(t.TileLayer,{attribution:h,url:b}),f&&React.createElement(t.Marker,{position:this.toLatLng(f),icon:a("grey")}))}}]),t}(React.Component);r()(E,"propTypes",{attribution:PropTypes.string.isRequired,location:PropTypes.string.isRequired,mapOptions:PropTypes.object.isRequired,toolbox:PropTypes.object.isRequired});var O=connectToStore((function(e){return _.get(e,"config.app.maps",(function(){return{}}))}),{})(E),S=function(e){function t(e,n){var o;return l()(this,t),(o=h()(this,d()(t).call(this,e,n))).state={mapOpen:!1,value:e.value||""},o}return b()(t,e),u()(t,[{key:"componentDidUpdate",value:function(e){this.props.value!==e.value&&this.setState(_.pick(this.props,"value"))}},{key:"onLocationChange",value:function(e){var t=this.props.onChange;this.setState({value:e},(function(){return t(null,{name:"siteLocation",value:e})}))}},{key:"render",value:function(){var e=this,t=Stage.Basic,n=t.Button,o=t.Form,r=this.state,i=r.mapOpen,a=r.value,s=this.props.toolbox;return React.createElement(React.Fragment,null,React.createElement(o.Input,{label:"Location",value:a,placeholder:"latitude, longitude (32.166369, 34.810893)",onChange:function(t,n){return e.onLocationChange(n.value)},action:React.createElement(n,{active:i,icon:"crosshairs",onClick:function(){return e.setState({mapOpen:!i})}})}),i&&React.createElement(O,{location:a,mapOptions:{onClick:function(t){return e.onLocationChange("".concat(t.latlng.lat,", ").concat(t.latlng.lng))},style:{height:"calc(100vh - 344px)",maxHeight:460,marginTop:-14,cursor:"pointer"}},toolbox:s}))}}]),t}(React.Component);function R(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}r()(S,"propTypes",{onChange:PropTypes.func.isRequired,value:PropTypes.string.isRequired,toolbox:PropTypes.shape({}).isRequired});var C=function(e){function t(e,n){var o;return l()(this,t),(o=h()(this,d()(t).call(this,e,n))).state=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?R(Object(n),!0).forEach((function(t){r()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):R(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},t.initialState,{open:!1}),o}return b()(t,e),u()(t,[{key:"onApprove",value:function(){return this._createSite(),!1}},{key:"onCancel",value:function(){return this.setState({open:!1}),!0}},{key:"componentDidUpdate",value:function(e,n){!n.open&&this.state.open&&this.setState(t.initialState)}},{key:"_createSite",value:function(){var e=this,t={};if(_.isEmpty(this.state.siteName)&&(t.siteName="Please provide site name"),!_.isEmpty(t))return this.setState({errors:t}),!1;this.setState({loading:!0}),new y(this.props.toolbox).doCreate(this.state.siteName,this.state.siteVisibility,this.state.siteLocation).then((function(){e.setState({errors:{},loading:!1,open:!1}),e.props.toolbox.refresh()})).catch((function(t){e.setState({errors:{error:t.message},loading:!1})}))}},{key:"_handleInputChange",value:function(e,t){this.setState(Stage.Basic.Form.fieldNameValue(t))}},{key:"render",value:function(){var e=this,t=Stage.Basic,n=t.ApproveButton,o=t.Button,r=t.CancelButton,i=t.Icon,a=t.Form,s=t.Modal,l=t.VisibilityField,c=React.createElement(o,{content:"Create",icon:"add",labelPosition:"left"});return React.createElement(s,{trigger:c,open:this.state.open,onOpen:function(){return e.setState({open:!0})},onClose:function(){return e.setState({open:!1})}},React.createElement(s.Header,null,React.createElement(i,{name:"add"})," Create site",React.createElement(l,{visibility:this.state.siteVisibility,className:"rightFloated",onVisibilityChange:function(t){return e.setState({siteVisibility:t})}})),React.createElement(s.Content,null,React.createElement(a,{loading:this.state.loading,errors:this.state.errors,onErrorsDismiss:function(){return e.setState({errors:{}})}},React.createElement(a.Field,{label:"Name",error:this.state.errors.siteName,required:!0},React.createElement(a.Input,{name:"siteName",value:this.state.siteName,onChange:this._handleInputChange.bind(this)})),React.createElement(a.Field,{error:this.state.errors.siteLocation},React.createElement(S,{onChange:this._handleInputChange.bind(this),toolbox:this.props.toolbox})))),React.createElement(s.Actions,null,React.createElement(r,{onClick:this.onCancel.bind(this),disabled:this.state.loading}),React.createElement(n,{onClick:this.onApprove.bind(this),disabled:this.state.loading,content:"Create",icon:"add",color:"green"})))}}]),t}(React.Component);function w(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}r()(C,"initialState",{loading:!1,siteName:"",siteLocation:"",siteVisibility:Stage.Common.Consts.defaultVisibility,errors:{}}),r()(C,"propTypes",{toolbox:PropTypes.object.isRequired});var j=function(e){function t(e,n){var o;return l()(this,t),(o=h()(this,d()(t).call(this,e,n))).state=t.initialState,o}return b()(t,e),u()(t,[{key:"onApprove",value:function(){return this._updateSite(),!1}},{key:"onCancel",value:function(){return this.props.onHide(),!0}},{key:"componentDidUpdate",value:function(e){!e.open&&this.props.open&&this.setState(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?w(Object(n),!0).forEach((function(t){r()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):w(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},t.initialState,{siteNewName:this.props.site.name,siteLocation:this.props.site.location||""}))}},{key:"_updateSite",value:function(){var e=this;this.setState({loading:!0}),new y(this.props.toolbox).doUpdate(this.props.site.name,null,this.state.siteLocation,this.state.siteNewName).then((function(){e.setState({errors:{},loading:!1}),e.props.toolbox.refresh(),e.props.onHide()})).catch((function(t){e.setState({errors:{error:t.message},loading:!1})}))}},{key:"_handleInputChange",value:function(e,t){this.setState(Stage.Basic.Form.fieldNameValue(t))}},{key:"render",value:function(){var e=this,t=Stage.Basic,n=t.Modal,o=t.Icon,r=t.Form,i=t.ApproveButton,a=t.CancelButton;return React.createElement("div",null,React.createElement(n,{open:this.props.open,onClose:function(){return e.props.onHide()}},React.createElement(n.Header,null,React.createElement(o,{name:"edit"})," Update site ",this.props.site.name),React.createElement(n.Content,null,React.createElement(r,{loading:this.state.loading,errors:this.state.errors,onErrorsDismiss:function(){return e.setState({errors:{}})}},React.createElement(r.Field,{error:this.state.errors.siteNewName},React.createElement(r.Input,{label:"Name",name:"siteNewName",value:this.state.siteNewName,onChange:this._handleInputChange.bind(this)})),React.createElement(r.Field,{error:this.state.errors.siteLocation},React.createElement(S,{value:this.state.siteLocation,onChange:this._handleInputChange.bind(this),toolbox:this.props.toolbox})))),React.createElement(n.Actions,null,React.createElement(a,{onClick:this.onCancel.bind(this),disabled:this.state.loading}),React.createElement(i,{onClick:this.onApprove.bind(this),disabled:this.state.loading,content:"Update",icon:"edit",color:"green"}))))}}]),t}(React.Component);function P(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function T(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?P(Object(n),!0).forEach((function(t){r()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):P(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}r()(j,"initialState",{loading:!1,errors:{},siteNewName:""}),r()(j,"propTypes",{site:PropTypes.object.isRequired,toolbox:PropTypes.object.isRequired,open:PropTypes.bool.isRequired,onHide:PropTypes.func.isRequired});var x=function(e){function t(e,n){var o;return l()(this,t),(o=h()(this,d()(t).call(this,e,n))).state={error:null,showModal:!1,modalType:"",site:{}},o}return b()(t,e),u()(t,[{key:"shouldComponentUpdate",value:function(e,t){return!_.isEqual(this.props.widget,e.widget)||!_.isEqual(this.state,t)||!_.isEqual(this.props.data,e.data)}},{key:"_refreshData",value:function(){this.setState({error:null}),this.props.toolbox.refresh()}},{key:"componentDidMount",value:function(){this.props.toolbox.getEventBus().on("sites:refresh",this._refreshData,this)}},{key:"componentWillUnmount",value:function(){this.props.toolbox.getEventBus().off("sites:refresh",this._refreshData)}},{key:"fetchGridData",value:function(e){return this.props.toolbox.refresh(e)}},{key:"_onDeleteSite",value:function(e){this.setState({site:e,modalType:t.DELETE_SITE_ACTION,showModal:!0})}},{key:"_onUpdateSite",value:function(e){this.setState({site:e,modalType:t.UPDATE_SITE_ACTION,showModal:!0})}},{key:"_setSiteVisibility",value:function(e,t){var n=this,o=new y(this.props.toolbox);this.props.toolbox.loading(!0),o.doUpdate(e,t).then((function(){n.props.toolbox.loading(!1),n.props.toolbox.refresh()})).catch((function(e){n.props.toolbox.loading(!1),n.setState({error:e.message})}))}},{key:"_deleteSite",value:function(){var e=this,n={modalType:t.DELETE_SITE_ACTION,showModal:!1};new y(this.props.toolbox).doDelete(this.state.site.name).then((function(){e.setState(T({},n,{error:null})),e.props.toolbox.getEventBus().trigger("sites:refresh")})).catch((function(t){e.setState(T({},n,{error:t.message}))}))}},{key:"_hideModal",value:function(){this.setState({showModal:!1})}},{key:"render",value:function(){var e,n=this,o=Stage.Basic,r=o.DataTable,i=o.ErrorMessage,s=o.Icon,l=o.ResourceVisibility,c=o.Label,u=o.Popup,p=Stage.Basic.Confirm,h=this.props.data,f=null;return React.createElement("div",null,React.createElement(i,{error:this.state.error,onDismiss:function(){return n.setState({error:null})},autoHide:!0}),React.createElement(r,{fetchData:this.fetchGridData.bind(this),totalSize:h.total,pageSize:this.props.widget.configuration.pageSize,sortColumn:this.props.widget.configuration.sortColumn,sortAscending:this.props.widget.configuration.sortAscending,searchable:!0,className:"sitesTable",noDataMessage:'There are no Sites available. Click "Create" to create Sites.'},React.createElement(r.Column,{label:"Name",name:"name",width:"20%"}),React.createElement(r.Column,{label:"Location",width:"20%"}),React.createElement(r.Column,{label:"Created",name:"created_at",width:"20%"}),React.createElement(r.Column,{label:"Creator",name:"created_by",width:"10%"}),React.createElement(r.Column,{label:"Tenant",name:"tenant_name",width:"10%"}),React.createElement(r.Column,{label:"# Deployments",width:"10%"}),React.createElement(r.Column,{width:"10%"}),h.items.map((function(t){if(t.location){var o=t.location.split(","),i=a()(o,2);e=i[0],f=i[1]}return React.createElement(r.Row,{key:t.name},React.createElement(r.Data,null,t.name,React.createElement(l,{visibility:t.visibility,onSetVisibility:function(e){n._setSiteVisibility(t.name,e)},allowedSettingTo:["tenant","global"],className:"rightFloated"})),React.createElement(r.Data,null,t.location&&React.createElement(React.Fragment,null,"Latitude: ",e,", Longitude: ",f,React.createElement(u,{hoverable:!0},React.createElement(u.Trigger,null,React.createElement(s,{name:"crosshairs",link:!0,bordered:!0,className:"rightFloated",onClick:function(e){return e.stopPropagation()}})),React.createElement(u.Content,null,React.createElement(O,{location:t.location,mapOptions:{zoomControl:!1,style:{width:200,height:200}},toolbox:n.props.toolbox}))))),React.createElement(r.Data,null,t.created_at),React.createElement(r.Data,null,t.created_by),React.createElement(r.Data,null,t.tenant_name),React.createElement(r.Data,null,React.createElement(c,{className:"blue",horizontal:!0},t.deploymentCount)),React.createElement(r.Data,{className:"center aligned rowActions"},React.createElement(s,{bordered:!0,link:!0,name:"edit",title:"Update site",onClick:n._onUpdateSite.bind(n,t)}),React.createElement(s,{bordered:!0,link:!0,name:"trash",title:"Delete site",onClick:n._onDeleteSite.bind(n,t)})))})),React.createElement(r.Action,null,React.createElement(C,{toolbox:this.props.toolbox}))),React.createElement(p,{content:"Are you sure you want to delete the site '".concat(this.state.site.name,"'?"),open:this.state.modalType===t.DELETE_SITE_ACTION&&this.state.showModal,onConfirm:this._deleteSite.bind(this),onCancel:this._hideModal.bind(this)}),React.createElement(j,{toolbox:this.props.toolbox,open:this.state.modalType===t.UPDATE_SITE_ACTION&&this.state.showModal,onHide:this._hideModal.bind(this),site:this.state.site}))}}]),t}(React.Component);function k(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}r()(x,"propTypes",{widget:PropTypes.object.isRequired,data:PropTypes.object.isRequired,toolbox:PropTypes.object.isRequired}),r()(x,"DELETE_SITE_ACTION","delete"),r()(x,"UPDATE_SITE_ACTION","update"),Stage.defineWidget({id:"sites",name:"Sites",description:"This widget shows a list of available sites and allow managing them",initialWidth:5,initialHeight:16,color:"blue",fetchUrl:{sites:"[manager]/sites[params]",siteDeploymentCount:"[manager]/summary/deployments?_target_field=site_name"},isReact:!0,hasReadme:!0,hasStyle:!0,permission:Stage.GenericConfig.WIDGET_PERMISSION("sites"),categories:[Stage.GenericConfig.CATEGORY.SYSTEM_RESOURCES],initialConfiguration:[Stage.GenericConfig.POLLING_TIME_CONFIG(30),Stage.GenericConfig.PAGE_SIZE_CONFIG(),Stage.GenericConfig.SORT_COLUMN_CONFIG("name"),Stage.GenericConfig.SORT_ASCENDING_CONFIG(!0)],render:function(e,t,n,o){if(_.isEmpty(t))return React.createElement(Stage.Basic.Loading,null);var i=t.sites,a=t.siteDeploymentCount,s={};_.forEach(a.items,(function(e){s[e.site_name]=e.deployments}));var l={items:_.map(i.items,(function(e){return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?k(Object(n),!0).forEach((function(t){r()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):k(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e,{created_at:Stage.Utils.Time.formatTimestamp(e.created_at),deploymentCount:s[e.name]||0})})),total:_.get(i,"metadata.pagination.total",0)};return React.createElement(x,{widget:e,data:l,toolbox:o})}})}]);
\ No newline at end of file
