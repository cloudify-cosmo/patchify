diff --git a/dist/appData/widgets/blueprints/widget.js b/dist/appData/widgets/blueprints/widget.js
index c6713c7..28221f6 100644
--- a/dist/appData/widgets/blueprints/widget.js
+++ b/dist/appData/widgets/blueprints/widget.js
@@ -1 +1 @@
-!function(e){var t={};function n(o){if(t[o])return t[o].exports;var a=t[o]={i:o,l:!1,exports:{}};return e[o].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(o,a,function(t){return e[t]}.bind(null,a));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/console",n(n.s=52)}({0:function(e,t){e.exports=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}},1:function(e,t){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},2:function(e,t){function n(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}e.exports=function(e,t,o){return t&&n(e.prototype,t),o&&n(e,o),e}},3:function(e,t,n){var o=n(7),a=n(6);e.exports=function(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?a(e):t}},4:function(e,t){function n(t){return e.exports=n=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},n(t)}e.exports=n},5:function(e,t,n){var o=n(8);e.exports=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&o(e,t)}},52:function(e,t,n){"use strict";n.r(t);var o=n(0),a=n.n(o),i=n(1),r=n.n(i),l=n(2),c=n.n(l),s=n(3),u=n.n(s),p=n(4),d=n.n(p),m=n(5),f=n.n(m),h=function(e){function t(){return r()(this,t),u()(this,d()(t).apply(this,arguments))}return f()(t,e),c()(t,[{key:"render",value:function(){var e=this,t=Stage.Basic,n=t.DataTable,o=t.Image,a=t.ResourceVisibility;return React.createElement(n,{fetchData:this.props.fetchGridData,totalSize:this.props.data.total,pageSize:this.props.widget.configuration.pageSize,sortColumn:this.props.widget.configuration.sortColumn,sortAscending:this.props.widget.configuration.sortAscending,selectable:!0,searchable:!0,className:"blueprintsTable",noDataMessage:this.props.noDataMessage},React.createElement(n.Column,{label:"Name",name:"id",width:"20%"}),React.createElement(n.Column,{label:"Created",name:"created_at",width:"15%"}),React.createElement(n.Column,{label:"Updated",name:"updated_at",width:"15%"}),React.createElement(n.Column,{label:"Creator",name:"created_by",width:"15%"}),React.createElement(n.Column,{label:"Main Blueprint File",name:"main_file_name",width:"15%"}),React.createElement(n.Column,{label:"# Deployments",width:"10%"}),React.createElement(n.Column,{width:"10%"}),this.props.data.items.map((function(t){return React.createElement(n.Row,{id:"".concat("blueprintsTable","_").concat(t.id),key:t.id,selected:t.isSelected,onClick:function(){return e.props.onSelectBlueprint(t)}},React.createElement(n.Data,null,React.createElement(o,{src:Stage.Utils.Url.url("/ba/image/".concat(t.id)),width:"30px",height:"auto",inline:!0})," ",React.createElement("a",{className:"blueprintName",href:"javascript:void(0)"},t.id),React.createElement(a,{visibility:t.visibility,onSetVisibility:function(n){return e.props.onSetVisibility(t.id,n)},allowedSettingTo:e.props.allowedSettingTo,className:"rightFloated"})),React.createElement(n.Data,null,t.created_at),React.createElement(n.Data,null,t.updated_at),React.createElement(n.Data,null,t.created_by),React.createElement(n.Data,null,t.main_file_name),React.createElement(n.Data,null,React.createElement("div",{className:"ui green horizontal label"},t.depCount)),React.createElement(n.Data,{className:"center aligned rowActions"},React.createElement("i",{className:"rocket icon link bordered",title:"Create deployment",onClick:function(n){n.stopPropagation(),e.props.onCreateDeployment(t)}}),React.createElement("i",{className:"trash icon link bordered",title:"Delete blueprint",onClick:function(n){n.stopPropagation(),e.props.onDeleteBlueprint(t)}})))})))}}]),t}(React.Component);a()(h,"propTypes",{data:PropTypes.object.isRequired,widget:PropTypes.object.isRequired,toolbox:PropTypes.object.isRequired,fetchGridData:PropTypes.func,onSelectBlueprint:PropTypes.func,onDeleteBlueprint:PropTypes.func,onCreateDeployment:PropTypes.func,onSetVisibility:PropTypes.func,allowedSettingTo:PropTypes.array,noDataMessage:PropTypes.string}),a()(h,"defaultProps",{fetchGridData:function(){},onSelectBlueprint:function(){},onDeleteBlueprint:function(){},onCreateDeployment:function(){},onSetVisibility:function(){},allowedSettingTo:["tenant","global"],noDataMessage:""});var b=function(e){function t(){return r()(this,t),u()(this,d()(t).apply(this,arguments))}return f()(t,e),c()(t,[{key:"render",value:function(){var e=this,t=Stage.Basic,n=t.DataSegment,o=t.Grid,a=t.Image,i=t.Button,r=t.Label,l=t.ResourceVisibility,c=t.Header,s=this.props.data.items.map((function(t){return React.createElement(o.Column,{key:t.id},React.createElement(n.Item,{selected:t.isSelected,className:"fullHeight ".concat(t.id),onClick:function(n){n.stopPropagation(),e.props.onSelectBlueprint(t)}},React.createElement(o,null,React.createElement(o.Row,{className:"bottomDivider"},React.createElement(o.Column,{width:"16"},React.createElement(a,{src:Stage.Utils.Url.url("/ba/image/".concat(t.id))}),React.createElement(c,null,React.createElement("a",{href:"javascript:void(0)",className:"breakWord"},t.id)),React.createElement(l,{visibility:t.visibility,onSetVisibility:function(n){return e.props.onSetVisibility(t.id,n)},allowedSettingTo:e.props.allowedSettingTo,className:"rightFloated"}))),React.createElement(o.Column,{width:"16"},t.description),React.createElement(o.Row,{className:"noPadded"},React.createElement(o.Column,{width:"7"},React.createElement("h5",{className:"ui icon header"},"Created")),React.createElement(o.Column,{width:"9"},t.created_at)),React.createElement(o.Row,{className:"noPadded"},React.createElement(o.Column,{width:"7"},React.createElement("h5",{className:"ui icon header"},"Updated")),React.createElement(o.Column,{width:"9"},t.updated_at)),React.createElement(o.Row,{className:"noPadded"},React.createElement(o.Column,{width:"7"},React.createElement("h5",{className:"ui icon header"},"Creator")),React.createElement(o.Column,{width:"9"},t.created_by)),React.createElement(o.Row,{className:"noPadded"},React.createElement(o.Column,{width:"7"},React.createElement("h5",{className:"ui icon header"},"Main Blueprint File")),React.createElement(o.Column,{width:"9"},t.main_file_name)),React.createElement(o.Row,{className:"noPadded"},React.createElement(o.Column,{width:"7"},React.createElement("h5",{className:"ui icon header"},"# Deployments")),React.createElement(o.Column,{width:"9"},React.createElement(r,{color:"green",horizontal:!0},t.depCount)))),React.createElement(o.Column,{width:"16"},React.createElement("div",{style:{height:"50px"}}))),React.createElement("div",{className:"actionButtons"},React.createElement(i,{icon:"trash",content:"Delete",className:"icon",basic:!0,onClick:function(n){n.stopPropagation(),e.props.onDeleteBlueprint(t)}}),React.createElement(i,{icon:"rocket",content:"Deploy",className:"labeled icon",onClick:function(n){n.stopPropagation(),e.props.onCreateDeployment(t)}})))})),u=[],p=[];return _.each(s,(function(e,t){p.push(e),(t+1)%3==0&&(u.push(React.createElement("div",{key:u.length+1,className:"three column row"},p)),p=[])})),p.length>0&&u.push(React.createElement("div",{key:u.length+1,className:"three column row"},p)),React.createElement("div",null,React.createElement(n,{totalSize:this.props.data.total,pageSize:this.props.widget.configuration.pageSize,fetchData:this.props.fetchData,className:"blueprintCatalog",searchable:!0,noDataMessage:this.props.noDataMessage},React.createElement(o,null,u)))}}]),t}(React.Component);a()(b,"propTypes",{data:PropTypes.object.isRequired,widget:PropTypes.object.isRequired,toolbox:PropTypes.object.isRequired,fetchData:PropTypes.func,onSelectBlueprint:PropTypes.func,onDeleteBlueprint:PropTypes.func,onCreateDeployment:PropTypes.func,onSetVisibility:PropTypes.func,allowedSettingTo:PropTypes.array,noDataMessage:PropTypes.string}),a()(b,"defaultProps",{fetchData:function(){},onSelectBlueprint:function(){},onDeleteBlueprint:function(){},onCreateDeployment:function(){},onSetVisibility:function(){},allowedSettingTo:["tenant","global"],noDataMessage:""});var y=function(e){function t(e,n){var o;return r()(this,t),(o=u()(this,d()(t).call(this,e,n))).state={showDeploymentModal:!1,showUploadModal:!1,blueprint:{},confirmDelete:!1,error:null,force:!1,item:{id:""}},o}return f()(t,e),c()(t,[{key:"shouldComponentUpdate",value:function(e,t){return!_.isEqual(this.props.widget,e.widget)||!_.isEqual(this.state,t)||!_.isEqual(this.props.data,e.data)}},{key:"_selectBlueprint",value:function(e){if(this.props.widget.configuration.clickToDrillDown)this.props.toolbox.drillDown(this.props.widget,"blueprint",{blueprintId:e.id},e.id);else{var t=this.props.toolbox.getContext().getValue("blueprintId");this.props.toolbox.getContext().setValue("blueprintId",e.id===t?null:e.id)}}},{key:"_createDeployment",value:function(e){var t=this;new Stage.Common.BlueprintActions(this.props.toolbox).doGetFullBlueprintData(e).then((function(e){t.setState({error:null,blueprint:e,showDeploymentModal:!0})})).catch((function(e){t.setState({error:e.message})}))}},{key:"_deleteBlueprintConfirm",value:function(e){this.setState({confirmDelete:!0,item:e,force:!1})}},{key:"_deleteBlueprint",value:function(){var e=this;if(this.state.item){var t=new Stage.Common.BlueprintActions(this.props.toolbox);this.setState({confirmDelete:!1}),t.doDelete(this.state.item,this.state.force).then((function(){e.setState({error:null}),e.props.toolbox.refresh()})).catch((function(t){e.setState({error:t.message})}))}else this.setState({error:"Something went wrong, no blueprint was selected for delete"})}},{key:"_setBlueprintVisibility",value:function(e,t){var n=this,o=new Stage.Common.BlueprintActions(this.props.toolbox);this.props.toolbox.loading(!0),o.doSetVisibility(e,t).then((function(){n.props.toolbox.loading(!1),n.props.toolbox.refresh()})).catch((function(e){n.props.toolbox.loading(!1),n.setState({error:e.message})}))}},{key:"_refreshData",value:function(){this.props.toolbox.refresh()}},{key:"componentDidMount",value:function(){this.props.toolbox.getEventBus().on("blueprints:refresh",this._refreshData,this)}},{key:"componentWillUnmount",value:function(){this.props.toolbox.getEventBus().off("blueprints:refresh",this._refreshData)}},{key:"_hideDeploymentModal",value:function(){this.setState({showDeploymentModal:!1})}},{key:"_showUploadModal",value:function(){this.setState({showUploadModal:!0})}},{key:"_hideUploadModal",value:function(){this.setState({showUploadModal:!1})}},{key:"_handleForceChange",value:function(e,t){this.setState(Stage.Basic.Form.fieldNameValue(t))}},{key:"fetchGridData",value:function(e){return this.props.toolbox.refresh(e)}},{key:"render",value:function(){var e=this,t='There are no Blueprints available. Click "Upload" to add Blueprints.',n=Stage.Basic,o=n.Button,a=n.ErrorMessage,i=Stage.Common,r=i.DeleteConfirm,l=i.DeployBlueprintModal,c=i.UploadBlueprintModal,s="table"===this.props.widget.configuration.displayStyle;return React.createElement("div",null,React.createElement(a,{error:this.state.error,onDismiss:function(){return e.setState({error:null})},autoHide:!0}),React.createElement(o,{content:"Upload",icon:"upload",labelPosition:"left",className:"uploadBlueprintButton",onClick:this._showUploadModal.bind(this)}),s?React.createElement(h,{widget:this.props.widget,data:this.props.data,toolbox:this.props.toolbox,fetchGridData:this.fetchGridData.bind(this),onSelectBlueprint:this._selectBlueprint.bind(this),onDeleteBlueprint:this._deleteBlueprintConfirm.bind(this),onCreateDeployment:this._createDeployment.bind(this),onSetVisibility:this._setBlueprintVisibility.bind(this),noDataMessage:t}):React.createElement(b,{widget:this.props.widget,data:this.props.data,toolbox:this.props.toolbox,fetchData:this.fetchGridData.bind(this),onSelectBlueprint:this._selectBlueprint.bind(this),onDeleteBlueprint:this._deleteBlueprintConfirm.bind(this),onCreateDeployment:this._createDeployment.bind(this),onSetVisibility:this._setBlueprintVisibility.bind(this),noDataMessage:t}),React.createElement(r,{resourceName:"blueprint ".concat(_.get(this.state.item,"id","")),force:this.state.force,open:this.state.confirmDelete,onConfirm:this._deleteBlueprint.bind(this),onCancel:function(){return e.setState({confirmDelete:!1})},onForceChange:this._handleForceChange.bind(this)}),React.createElement(l,{open:this.state.showDeploymentModal,blueprint:this.state.blueprint,onHide:this._hideDeploymentModal.bind(this),toolbox:this.props.toolbox}),React.createElement(c,{open:this.state.showUploadModal,onHide:this._hideUploadModal.bind(this),toolbox:this.props.toolbox}))}}]),t}(React.Component);function g(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function R(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?g(Object(n),!0).forEach((function(t){a()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):g(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}Stage.defineWidget({id:"blueprints",name:"Blueprints",description:"Shows blueprint list",initialWidth:8,initialHeight:20,color:"blue",hasStyle:!0,isReact:!0,hasReadme:!0,permission:Stage.GenericConfig.WIDGET_PERMISSION("blueprints"),categories:[Stage.GenericConfig.CATEGORY.BLUEPRINTS],initialConfiguration:[Stage.GenericConfig.POLLING_TIME_CONFIG(10),Stage.GenericConfig.PAGE_SIZE_CONFIG(5),{id:"clickToDrillDown",name:"Enable click to drill down",default:!0,type:Stage.Basic.GenericField.BOOLEAN_TYPE},{id:"displayStyle",name:"Display style",items:[{name:"Table",value:"table"},{name:"Catalog",value:"catalog"}],default:"table",type:Stage.Basic.GenericField.LIST_TYPE},Stage.GenericConfig.SORT_COLUMN_CONFIG("created_at"),Stage.GenericConfig.SORT_ASCENDING_CONFIG(!1)],fetchData:function(e,t,n){var o={};return t.getManager().doGet("/blueprints?_include=id,updated_at,created_at,description,created_by,visibility,main_file_name",n).then((function(e){return o.blueprints=e,t.getManager().doGetFull("/summary/deployments",{_target_field:"blueprint_id",blueprint_id:_.map(e.items,(function(e){return e.id}))})})).then((function(e){return o.deployments=e,o}))},fetchParams:function(e,t){return t.getContext().getValue("onlyMyResources")?{created_by:t.getManager().getCurrentUsername()}:{}},_processData:function(e,t){var n=e.blueprints,o=e.deployments,a=_.reduce(o.items,(function(e,t){return e[t.blueprint_id]=t.deployments,e}),{});_.each(n.items,(function(e){e.depCount=a[e.id]||0}));var i=t.getContext().getValue("blueprintId");return R({},n,{items:_.map(n.items,(function(e){return R({},e,{created_at:Stage.Utils.Time.formatTimestamp(e.created_at),updated_at:Stage.Utils.Time.formatTimestamp(e.updated_at),isSelected:i===e.id})})),total:_.get(n,"metadata.pagination.total",0)})},render:function(e,t,n,o){if(_.isEmpty(t))return React.createElement(Stage.Basic.Loading,null);var a=this._processData(t,o);return React.createElement("div",null,React.createElement(y,{widget:e,data:a,toolbox:o}))}})},6:function(e,t){e.exports=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}},7:function(e,t){function n(t){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?e.exports=n=function(e){return typeof e}:e.exports=n=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(t)}e.exports=n},8:function(e,t){function n(t,o){return e.exports=n=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},n(t,o)}e.exports=n}});
\ No newline at end of file
+!function(e){var t={};function n(o){if(t[o])return t[o].exports;var a=t[o]={i:o,l:!1,exports:{}};return e[o].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(o,a,function(t){return e[t]}.bind(null,a));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/console",n(n.s=52)}({0:function(e,t){e.exports=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}},1:function(e,t){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},2:function(e,t){function n(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}e.exports=function(e,t,o){return t&&n(e.prototype,t),o&&n(e,o),e}},3:function(e,t,n){var o=n(7),a=n(6);e.exports=function(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?a(e):t}},4:function(e,t){function n(t){return e.exports=n=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},n(t)}e.exports=n},5:function(e,t,n){var o=n(8);e.exports=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&o(e,t)}},52:function(e,t,n){"use strict";n.r(t);var o=n(0),a=n.n(o),i=n(1),r=n.n(i),l=n(2),c=n.n(l),s=n(3),u=n.n(s),p=n(4),d=n.n(p),m=n(5),f=n.n(m),h=function(e){function t(){return r()(this,t),u()(this,d()(t).apply(this,arguments))}return f()(t,e),c()(t,[{key:"render",value:function(){var e=this,t=Stage.Basic,n=t.DataTable,o=t.Image,a=t.ResourceVisibility;return React.createElement(n,{fetchData:this.props.fetchGridData,totalSize:this.props.data.total,pageSize:this.props.widget.configuration.pageSize,sortColumn:this.props.widget.configuration.sortColumn,sortAscending:this.props.widget.configuration.sortAscending,selectable:!0,searchable:!0,className:"blueprintsTable",noDataMessage:this.props.noDataMessage},React.createElement(n.Column,{label:"Name",name:"id",width:"20%"}),React.createElement(n.Column,{label:"Created",name:"created_at",width:"15%"}),React.createElement(n.Column,{label:"Updated",name:"updated_at",width:"15%"}),React.createElement(n.Column,{label:"Creator",name:"created_by",width:"15%"}),React.createElement(n.Column,{label:"Main Blueprint File",name:"main_file_name",width:"15%"}),React.createElement(n.Column,{label:"# Deployments",width:"10%"}),React.createElement(n.Column,{width:"10%"}),this.props.data.items.map((function(t){return React.createElement(n.Row,{id:"".concat("blueprintsTable","_").concat(t.id),key:t.id,selected:t.isSelected,onClick:function(){return e.props.onSelectBlueprint(t)}},React.createElement(n.Data,null,React.createElement(o,{src:Stage.Utils.Url.url("/ba/image/".concat(t.id)),width:"30px",height:"auto",inline:!0})," ",React.createElement("a",{className:"blueprintName",href:"javascript:void(0)"},t.id),React.createElement(a,{visibility:t.visibility,onSetVisibility:function(n){return e.props.onSetVisibility(t.id,n)},allowedSettingTo:e.props.allowedSettingTo,className:"rightFloated"})),React.createElement(n.Data,null,t.created_at),React.createElement(n.Data,null,t.updated_at),React.createElement(n.Data,null,t.created_by),React.createElement(n.Data,null,t.main_file_name),React.createElement(n.Data,null,React.createElement("div",{className:"ui green horizontal label"},t.depCount)),React.createElement(n.Data,{className:"center aligned rowActions"},React.createElement("i",{className:"rocket icon link bordered",title:"Create deployment",onClick:function(n){n.stopPropagation(),e.props.onCreateDeployment(t)}}),React.createElement("i",{className:"trash icon link bordered",title:"Delete blueprint",onClick:function(n){n.stopPropagation(),e.props.onDeleteBlueprint(t)}})))})))}}]),t}(React.Component);a()(h,"propTypes",{data:PropTypes.object.isRequired,widget:PropTypes.object.isRequired,toolbox:PropTypes.object.isRequired,fetchGridData:PropTypes.func,onSelectBlueprint:PropTypes.func,onDeleteBlueprint:PropTypes.func,onCreateDeployment:PropTypes.func,onSetVisibility:PropTypes.func,allowedSettingTo:PropTypes.array,noDataMessage:PropTypes.string}),a()(h,"defaultProps",{fetchGridData:function(){},onSelectBlueprint:function(){},onDeleteBlueprint:function(){},onCreateDeployment:function(){},onSetVisibility:function(){},allowedSettingTo:["tenant","global"],noDataMessage:""});var b=function(e){function t(){return r()(this,t),u()(this,d()(t).apply(this,arguments))}return f()(t,e),c()(t,[{key:"render",value:function(){var e=this,t=Stage.Basic,n=t.DataSegment,o=t.Grid,a=t.Image,i=t.Button,r=t.Label,l=t.ResourceVisibility,c=t.Header,s=this.props.data.items.map((function(t){return React.createElement(o.Column,{key:t.id},React.createElement(n.Item,{selected:t.isSelected,className:"fullHeight ".concat(t.id),onClick:function(n){n.stopPropagation(),e.props.onSelectBlueprint(t)}},React.createElement(o,null,React.createElement(o.Row,{className:"bottomDivider"},React.createElement(o.Column,{width:"16"},React.createElement(a,{src:Stage.Utils.Url.url("/ba/image/".concat(t.id))}),React.createElement(c,null,React.createElement("a",{href:"javascript:void(0)",className:"breakWord"},t.id)),React.createElement(l,{visibility:t.visibility,onSetVisibility:function(n){return e.props.onSetVisibility(t.id,n)},allowedSettingTo:e.props.allowedSettingTo,className:"rightFloated"}))),React.createElement(o.Column,{width:"16"},t.description),React.createElement(o.Row,{className:"noPadded"},React.createElement(o.Column,{width:"7"},React.createElement("h5",{className:"ui icon header"},"Created")),React.createElement(o.Column,{width:"9"},t.created_at)),React.createElement(o.Row,{className:"noPadded"},React.createElement(o.Column,{width:"7"},React.createElement("h5",{className:"ui icon header"},"Updated")),React.createElement(o.Column,{width:"9"},t.updated_at)),React.createElement(o.Row,{className:"noPadded"},React.createElement(o.Column,{width:"7"},React.createElement("h5",{className:"ui icon header"},"Creator")),React.createElement(o.Column,{width:"9"},t.created_by)),React.createElement(o.Row,{className:"noPadded"},React.createElement(o.Column,{width:"7"},React.createElement("h5",{className:"ui icon header"},"Main Blueprint File")),React.createElement(o.Column,{width:"9"},t.main_file_name)),React.createElement(o.Row,{className:"noPadded"},React.createElement(o.Column,{width:"7"},React.createElement("h5",{className:"ui icon header"},"# Deployments")),React.createElement(o.Column,{width:"9"},React.createElement(r,{color:"green",horizontal:!0},t.depCount)))),React.createElement(o.Column,{width:"16"},React.createElement("div",{style:{height:"50px"}}))),React.createElement("div",{className:"actionButtons"},React.createElement(i,{icon:"trash",content:"Delete",className:"icon",basic:!0,onClick:function(n){n.stopPropagation(),e.props.onDeleteBlueprint(t)}}),React.createElement(i,{icon:"rocket",content:"Deploy",className:"labeled icon",onClick:function(n){n.stopPropagation(),e.props.onCreateDeployment(t)}})))})),u=[],p=[];return _.each(s,(function(e,t){p.push(e),(t+1)%3==0&&(u.push(React.createElement("div",{key:u.length+1,className:"three column row"},p)),p=[])})),p.length>0&&u.push(React.createElement("div",{key:u.length+1,className:"three column row"},p)),React.createElement("div",null,React.createElement(n,{totalSize:this.props.data.total,pageSize:this.props.widget.configuration.pageSize,fetchData:this.props.fetchData,className:"blueprintCatalog",searchable:!0,noDataMessage:this.props.noDataMessage},React.createElement(o,null,u)))}}]),t}(React.Component);a()(b,"propTypes",{data:PropTypes.object.isRequired,widget:PropTypes.object.isRequired,toolbox:PropTypes.object.isRequired,fetchData:PropTypes.func,onSelectBlueprint:PropTypes.func,onDeleteBlueprint:PropTypes.func,onCreateDeployment:PropTypes.func,onSetVisibility:PropTypes.func,allowedSettingTo:PropTypes.array,noDataMessage:PropTypes.string}),a()(b,"defaultProps",{fetchData:function(){},onSelectBlueprint:function(){},onDeleteBlueprint:function(){},onCreateDeployment:function(){},onSetVisibility:function(){},allowedSettingTo:["tenant","global"],noDataMessage:""});var y=function(e){function t(e,n){var o;return r()(this,t),(o=u()(this,d()(t).call(this,e,n))).state={showDeploymentModal:!1,showUploadModal:!1,blueprintId:"",confirmDelete:!1,error:null,force:!1},o}return f()(t,e),c()(t,[{key:"shouldComponentUpdate",value:function(e,t){return!_.isEqual(this.props.widget,e.widget)||!_.isEqual(this.state,t)||!_.isEqual(this.props.data,e.data)}},{key:"_selectBlueprint",value:function(e){if(this.props.widget.configuration.clickToDrillDown)this.props.toolbox.drillDown(this.props.widget,"blueprint",{blueprintId:e.id},e.id);else{var t=this.props.toolbox.getContext().getValue("blueprintId");this.props.toolbox.getContext().setValue("blueprintId",e.id===t?null:e.id)}}},{key:"_createDeployment",value:function(e){this.setState({error:null,blueprintId:e.id,showDeploymentModal:!0})}},{key:"_deleteBlueprintConfirm",value:function(e){this.setState({confirmDelete:!0,blueprintId:e.id,force:!1})}},{key:"_deleteBlueprint",value:function(){var e=this;if(this.state.blueprintId){var t=new Stage.Common.BlueprintActions(this.props.toolbox);this.setState({confirmDelete:!1}),t.doDelete(this.state.blueprintId,this.state.force).then((function(){e.setState({error:null}),e.props.toolbox.refresh()})).catch((function(t){e.setState({error:t.message})}))}else this.setState({error:"Something went wrong, no blueprint was selected for delete"})}},{key:"_setBlueprintVisibility",value:function(e,t){var n=this,o=new Stage.Common.BlueprintActions(this.props.toolbox);this.props.toolbox.loading(!0),o.doSetVisibility(e,t).then((function(){n.props.toolbox.loading(!1),n.props.toolbox.refresh()})).catch((function(e){n.props.toolbox.loading(!1),n.setState({error:e.message})}))}},{key:"_refreshData",value:function(){this.props.toolbox.refresh()}},{key:"componentDidMount",value:function(){this.props.toolbox.getEventBus().on("blueprints:refresh",this._refreshData,this)}},{key:"componentWillUnmount",value:function(){this.props.toolbox.getEventBus().off("blueprints:refresh",this._refreshData)}},{key:"_hideDeploymentModal",value:function(){this.setState({showDeploymentModal:!1})}},{key:"_showUploadModal",value:function(){this.setState({showUploadModal:!0})}},{key:"_hideUploadModal",value:function(){this.setState({showUploadModal:!1})}},{key:"_handleForceChange",value:function(e,t){this.setState(Stage.Basic.Form.fieldNameValue(t))}},{key:"fetchGridData",value:function(e){return this.props.toolbox.refresh(e)}},{key:"render",value:function(){var e=this,t='There are no Blueprints available. Click "Upload" to add Blueprints.',n=Stage.Basic,o=n.Button,a=n.ErrorMessage,i=Stage.Common,r=i.DeleteConfirm,l=i.DeployBlueprintModal,c=i.UploadBlueprintModal,s="table"===this.props.widget.configuration.displayStyle;return React.createElement("div",null,React.createElement(a,{error:this.state.error,onDismiss:function(){return e.setState({error:null})},autoHide:!0}),React.createElement(o,{content:"Upload",icon:"upload",labelPosition:"left",className:"uploadBlueprintButton",onClick:this._showUploadModal.bind(this)}),s?React.createElement(h,{widget:this.props.widget,data:this.props.data,toolbox:this.props.toolbox,fetchGridData:this.fetchGridData.bind(this),onSelectBlueprint:this._selectBlueprint.bind(this),onDeleteBlueprint:this._deleteBlueprintConfirm.bind(this),onCreateDeployment:this._createDeployment.bind(this),onSetVisibility:this._setBlueprintVisibility.bind(this),noDataMessage:t}):React.createElement(b,{widget:this.props.widget,data:this.props.data,toolbox:this.props.toolbox,fetchData:this.fetchGridData.bind(this),onSelectBlueprint:this._selectBlueprint.bind(this),onDeleteBlueprint:this._deleteBlueprintConfirm.bind(this),onCreateDeployment:this._createDeployment.bind(this),onSetVisibility:this._setBlueprintVisibility.bind(this),noDataMessage:t}),React.createElement(r,{resourceName:"blueprint ".concat(this.state.blueprintId),force:this.state.force,open:this.state.confirmDelete,onConfirm:this._deleteBlueprint.bind(this),onCancel:function(){return e.setState({confirmDelete:!1})},onForceChange:this._handleForceChange.bind(this)}),React.createElement(l,{open:this.state.showDeploymentModal,blueprintId:this.state.blueprintId,onHide:this._hideDeploymentModal.bind(this),toolbox:this.props.toolbox}),React.createElement(c,{open:this.state.showUploadModal,onHide:this._hideUploadModal.bind(this),toolbox:this.props.toolbox}))}}]),t}(React.Component);function g(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function R(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?g(Object(n),!0).forEach((function(t){a()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):g(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}Stage.defineWidget({id:"blueprints",name:"Blueprints",description:"Shows blueprint list",initialWidth:8,initialHeight:20,color:"blue",hasStyle:!0,isReact:!0,hasReadme:!0,permission:Stage.GenericConfig.WIDGET_PERMISSION("blueprints"),categories:[Stage.GenericConfig.CATEGORY.BLUEPRINTS],initialConfiguration:[Stage.GenericConfig.POLLING_TIME_CONFIG(10),Stage.GenericConfig.PAGE_SIZE_CONFIG(5),{id:"clickToDrillDown",name:"Enable click to drill down",default:!0,type:Stage.Basic.GenericField.BOOLEAN_TYPE},{id:"displayStyle",name:"Display style",items:[{name:"Table",value:"table"},{name:"Catalog",value:"catalog"}],default:"table",type:Stage.Basic.GenericField.LIST_TYPE},Stage.GenericConfig.SORT_COLUMN_CONFIG("created_at"),Stage.GenericConfig.SORT_ASCENDING_CONFIG(!1)],fetchData:function(e,t,n){var o={};return t.getManager().doGet("/blueprints?_include=id,updated_at,created_at,description,created_by,visibility,main_file_name",n).then((function(e){return o.blueprints=e,t.getManager().doGetFull("/summary/deployments",{_target_field:"blueprint_id",blueprint_id:_.map(e.items,(function(e){return e.id}))})})).then((function(e){return o.deployments=e,o}))},fetchParams:function(e,t){return t.getContext().getValue("onlyMyResources")?{created_by:t.getManager().getCurrentUsername()}:{}},_processData:function(e,t){var n=e.blueprints,o=e.deployments,a=_.reduce(o.items,(function(e,t){return e[t.blueprint_id]=t.deployments,e}),{});_.each(n.items,(function(e){e.depCount=a[e.id]||0}));var i=t.getContext().getValue("blueprintId");return R({},n,{items:_.map(n.items,(function(e){return R({},e,{created_at:Stage.Utils.Time.formatTimestamp(e.created_at),updated_at:Stage.Utils.Time.formatTimestamp(e.updated_at),isSelected:i===e.id})})),total:_.get(n,"metadata.pagination.total",0)})},render:function(e,t,n,o){if(_.isEmpty(t))return React.createElement(Stage.Basic.Loading,null);var a=this._processData(t,o);return React.createElement("div",null,React.createElement(y,{widget:e,data:a,toolbox:o}))}})},6:function(e,t){e.exports=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}},7:function(e,t){function n(t){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?e.exports=n=function(e){return typeof e}:e.exports=n=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(t)}e.exports=n},8:function(e,t){function n(t,o){return e.exports=n=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},n(t,o)}e.exports=n}});
\ No newline at end of file
