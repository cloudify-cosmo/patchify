diff --git a/dist/appData/widgets/deploymentWizardButtons/widget.js b/dist/appData/widgets/deploymentWizardButtons/widget.js
index 55e1eaf..c3bb288 100644
--- a/dist/appData/widgets/deploymentWizardButtons/widget.js
+++ b/dist/appData/widgets/deploymentWizardButtons/widget.js
@@ -1 +1 @@
-!function(e){var t={};function n(r){if(t[r])return t[r].exports;var a=t[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(r,a,function(t){return e[t]}.bind(null,a));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/console",n(n.s=37)}([function(e,t){e.exports=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}},function(e,t){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},function(e,t){function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e.exports=function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}},function(e,t,n){var r=n(7),a=n(6);e.exports=function(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?a(e):t}},function(e,t){function n(t){return e.exports=n=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},n(t)}e.exports=n},function(e,t,n){var r=n(8);e.exports=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&r(e,t)}},function(e,t){e.exports=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}},function(e,t){function n(t){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?e.exports=n=function(e){return typeof e}:e.exports=n=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(t)}e.exports=n},function(e,t){function n(t,r){return e.exports=n=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},n(t,r)}e.exports=n},function(e,t){function n(){return e.exports=n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},n.apply(this,arguments)}e.exports=n},function(e,t,n){var r=n(13),a=n(11),i=n(14);e.exports=function(e){return r(e)||a(e)||i()}},function(e,t){e.exports=function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}},function(e,t,n){e.exports=n(26)},function(e,t){e.exports=function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}},function(e,t){e.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}},function(e,t){e.exports=function(e){if(Array.isArray(e))return e}},function(e,t){e.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}},function(e,t,n){var r=n(15),a=n(19),i=n(16);e.exports=function(e,t){return r(e)||a(e,t)||i()}},function(e,t){function n(e,t,n,r,a,i,o){try{var s=e[i](o),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(r,a)}e.exports=function(e){return function(){var t=this,r=arguments;return new Promise((function(a,i){var o=e.apply(t,r);function s(e){n(o,a,i,s,l,"next",e)}function l(e){n(o,a,i,s,l,"throw",e)}s(void 0)}))}}},function(e,t){e.exports=function(e,t){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)){var n=[],r=!0,a=!1,i=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){a=!0,i=e}finally{try{r||null==s.return||s.return()}finally{if(a)throw i}}return n}}},,,,,,,function(e,t,n){var r=function(e){"use strict";var t,n=Object.prototype,r=n.hasOwnProperty,a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",o=a.asyncIterator||"@@asyncIterator",s=a.toStringTag||"@@toStringTag";function l(e,t,n,r){var a=t&&t.prototype instanceof m?t:m,i=Object.create(a.prototype),o=new O(r||[]);return i._invoke=function(e,t,n){var r=c;return function(a,i){if(r===d)throw new Error("Generator is already running");if(r===h){if("throw"===a)throw i;return C()}for(n.method=a,n.arg=i;;){var o=n.delegate;if(o){var s=R(o,n);if(s){if(s===f)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(r===c)throw r=h,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r=d;var l=u(e,t,n);if("normal"===l.type){if(r=n.done?h:p,l.arg===f)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(r=h,n.method="throw",n.arg=l.arg)}}}(e,n,o),i}function u(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=l;var c="suspendedStart",p="suspendedYield",d="executing",h="completed",f={};function m(){}function g(){}function y(){}var v={};v[i]=function(){return this};var b=Object.getPrototypeOf,S=b&&b(b(x([])));S&&S!==n&&r.call(S,i)&&(v=S);var w=y.prototype=m.prototype=Object.create(v);function E(e){["next","throw","return"].forEach((function(t){e[t]=function(e){return this._invoke(t,e)}}))}function k(e){var t;this._invoke=function(n,a){function i(){return new Promise((function(t,i){!function t(n,a,i,o){var s=u(e[n],e,a);if("throw"!==s.type){var l=s.arg,c=l.value;return c&&"object"==typeof c&&r.call(c,"__await")?Promise.resolve(c.__await).then((function(e){t("next",e,i,o)}),(function(e){t("throw",e,i,o)})):Promise.resolve(c).then((function(e){l.value=e,i(l)}),(function(e){return t("throw",e,i,o)}))}o(s.arg)}(n,a,t,i)}))}return t=t?t.then(i,i):i()}}function R(e,n){var r=e.iterator[n.method];if(r===t){if(n.delegate=null,"throw"===n.method){if(e.iterator.return&&(n.method="return",n.arg=t,R(e,n),"throw"===n.method))return f;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return f}var a=u(r,e.iterator,n.arg);if("throw"===a.type)return n.method="throw",n.arg=a.arg,n.delegate=null,f;var i=a.arg;return i?i.done?(n[e.resultName]=i.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,f):i:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,f)}function P(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function D(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function O(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(P,this),this.reset(!0)}function x(e){if(e){var n=e[i];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var a=-1,o=function n(){for(;++a<e.length;)if(r.call(e,a))return n.value=e[a],n.done=!1,n;return n.value=t,n.done=!0,n};return o.next=o}}return{next:C}}function C(){return{value:t,done:!0}}return g.prototype=w.constructor=y,y.constructor=g,y[s]=g.displayName="GeneratorFunction",e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,y):(e.__proto__=y,s in e||(e[s]="GeneratorFunction")),e.prototype=Object.create(w),e},e.awrap=function(e){return{__await:e}},E(k.prototype),k.prototype[o]=function(){return this},e.AsyncIterator=k,e.async=function(t,n,r,a){var i=new k(l(t,n,r,a));return e.isGeneratorFunction(n)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},E(w),w[s]="Generator",w[i]=function(){return this},w.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},e.values=x,O.prototype={constructor:O,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(D),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function a(r,a){return s.type="throw",s.arg=e,n.next=r,a&&(n.method="next",n.arg=t),!!a}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],s=o.completion;if("root"===o.tryLoc)return a("end");if(o.tryLoc<=this.prev){var l=r.call(o,"catchLoc"),u=r.call(o,"finallyLoc");if(l&&u){if(this.prev<o.catchLoc)return a(o.catchLoc,!0);if(this.prev<o.finallyLoc)return a(o.finallyLoc)}else if(l){if(this.prev<o.catchLoc)return a(o.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return a(o.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var a=this.tryEntries[n];if(a.tryLoc<=this.prev&&r.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var i=a;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=e,o.arg=t,i?(this.method="next",this.next=i.finallyLoc,f):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),f},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),D(n),f}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var a=r.arg;D(n)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:x(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),f}},e}(e.exports);try{regeneratorRuntime=r}catch(e){Function("r","regeneratorRuntime = r")(r)}},,,,,,,,,,,function(e,t,n){"use strict";n.r(t);var r=n(1),a=n.n(r),i=n(2),o=n.n(i),s=n(3),l=n.n(s),u=n(4),c=n.n(u),p=n(5),d=n.n(p),h=n(0),f=n.n(h),m=function(e){function t(e,n){var r;return a()(this,t),(r=l()(this,c()(t).call(this,e,n))).state={open:!1},r}return d()(t,e),o()(t,[{key:"openWizard",value:function(e){e.stopPropagation(),this.setState({open:!0})}},{key:"closeWizard",value:function(){this.setState({open:!1})}},{key:"render",value:function(){var e=Stage.Basic,t=e.Button,n=e.Icon,r=e.Wizard,a=this.props,i=a.color,o=a.icon,s=a.name,l=a.steps,u=a.toolbox,c=a.wizardTitle;return React.createElement(React.Fragment,null,React.createElement(t,{color:i,onClick:this.openWizard.bind(this),labelPosition:"left",icon:!0,className:"widgetButton"},React.createElement(n,{name:o,size:"large"}),s),React.createElement(r.Modal,{header:c,open:this.state.open,steps:l,onClose:this.closeWizard.bind(this),toolbox:u}))}}]),t}(React.Component);f()(m,"propTypes",{color:PropTypes.string.isRequired,name:PropTypes.string.isRequired,icon:PropTypes.string.isRequired,wizardTitle:PropTypes.string.isRequired,steps:Stage.Basic.Wizard.Modal.propTypes.steps,toolbox:PropTypes.object.isRequired});var g=n(9),y=n.n(g);function v(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function b(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?v(Object(n),!0).forEach((function(t){f()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):v(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var S=Stage.Basic.Wizard.Utils.createWizardStep,w=function(e){function t(e){return a()(this,t),l()(this,c()(t).call(this,e))}return d()(t,e),o()(t,[{key:"onNext",value:function(e){var t=this,n={};this.props.onLoading().then(this.props.fetchData).then((function(e){var r=e.stepData;n=r;var a=r.blueprintFile?"":r.blueprintUrl,i=r.imageFile?"":r.imageUrl,o={};return r.blueprintFile||!_.isEmpty(a)&&Stage.Utils.Url.isUrl(a)||(o.blueprintUrl="Blueprint package"),_.isEmpty(r.blueprintName)&&(o.blueprintName="Blueprint name"),_.isEmpty(r.blueprintFileName)&&(o.blueprintFileName="Blueprint YAML file"),_.isEmpty(i)||Stage.Utils.Url.isUrl(i)||(o.imageUrl="Blueprint icon"),_.isEmpty(o)?_.isNil(r.blueprintFile)?t.props.toolbox.getInternal().doPut("source/list/resources",{yamlFile:r.blueprintFileName,url:r.blueprintUrl}):t.props.toolbox.getInternal().doUpload("source/list/resources",{yamlFile:r.blueprintFileName},{archive:r.blueprintFile}):Promise.reject({message:"Please fill in the following fields with valid values: ".concat(_.values(o).join(", "),"."),errors:o})})).then((function(r){return t.props.onNext(e,{blueprint:b({},r,{},n)})})).catch((function(n){return t.props.onError(e,n.message,n.errors)}))}},{key:"render",value:function(){var e=Stage.Basic.Wizard;return React.createElement(e.Step.Actions,y()({},this.props,{onNext:this.onNext.bind(this)}))}}]),t}(React.Component);f()(w,"propTypes",Stage.Basic.Wizard.Step.Actions.propTypes);var E=function(e){function t(e){return a()(this,t),l()(this,c()(t).call(this,e))}return d()(t,e),o()(t,[{key:"componentDidMount",value:function(){this.props.onChange(this.props.id,b({},t.defaultBlueprintState,{},this.props.stepData))}},{key:"onChange",value:function(e){this.props.onChange(this.props.id,b({},this.props.stepData,{},e))}},{key:"render",value:function(){var e=this,t=Stage.Basic,n=t.Container,r=t.VisibilityField,a=Stage.Common.UploadBlueprintForm;return _.isEmpty(this.props.stepData)?null:React.createElement(React.Fragment,null,React.createElement(n,{textAlign:"right"},React.createElement(r,{visibility:this.props.stepData.visibility,className:"large",onVisibilityChange:function(t){return e.onChange({visibility:t})}})),React.createElement(a,{blueprintUrl:this.props.stepData.blueprintUrl,blueprintFile:this.props.stepData.blueprintFile,blueprintName:this.props.stepData.blueprintName,blueprintFileName:this.props.stepData.blueprintFileName,imageUrl:this.props.stepData.imageUrl,imageFile:this.props.stepData.imageFile,loading:this.props.loading,errors:this.props.errors,showErrorsSummary:!1,onChange:this.onChange.bind(this),toolbox:this.props.toolbox}))}}]),t}(React.Component);f()(E,"propTypes",Stage.Basic.Wizard.Step.Content.propTypes),f()(E,"defaultBlueprintState",{blueprintUrl:"",blueprintFile:null,blueprintName:"",blueprintFileName:"",imageUrl:"",imageFile:null,visibility:Stage.Common.Consts.defaultVisibility});var k=S("blueprint","Blueprint","Select blueprint",E,w);function R(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function P(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?R(Object(n),!0).forEach((function(t){f()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):R(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var D=Stage.Basic.Wizard.Utils.createWizardStep,O=function(e){function t(e){return a()(this,t),l()(this,c()(t).call(this,e))}return d()(t,e),o()(t,[{key:"onNext",value:function(e){var t=this,n={};this.props.onLoading().then(this.props.fetchData).then((function(e){var t=e.stepData;return n=t})).then((function(e){return t.props.toolbox.getInternal().doPut("source/list/resources",{yamlFile:e.blueprintFileName,url:e.blueprintUrl})})).then((function(r){return t.props.onNext(e,{blueprint:P({},r,{},n)})})).catch((function(){return t.props.onError(e,"Error during fetching data for the next step")}))}},{key:"render",value:function(){var e=Stage.Basic.Wizard;return React.createElement(e.Step.Actions,y()({},this.props,{onNext:this.onNext.bind(this)}))}}]),t}(React.Component);f()(O,"propTypes",Stage.Basic.Wizard.Step.Actions.propTypes);var x=function(e){function t(e){var n;return a()(this,t),(n=l()(this,c()(t).call(this,e))).state=t.initialState,n}return d()(t,e),o()(t,[{key:"componentDidMount",value:function(){_.isEmpty(this.props.stepData)?this.props.onChange(this.props.id,this.state.stepData):this.setState({stepData:P({},this.props.stepData)})}},{key:"onChange",value:function(e){var t=this;this.setState({stepData:P({},this.state.stepData,{blueprintFileName:e})},(function(){return t.props.onChange(t.props.id,t.state.stepData)}))}},{key:"render",value:function(){var e=this,t=Stage.Basic,n=t.Button,r=t.Form,a=t.Image,i=Stage.Utils.Url.widgetResourceUrl,o=this.state.stepData.blueprintFileName,s=function(t){var r;return React.createElement(n,{fluid:!0,basic:!0,size:"huge",active:t.active,name:t.value,onClick:e.onChange.bind(e,t.value)},React.createElement(a,{src:(r=t.value,i("deploymentWizardButtons","/images/".concat(_.replace(r,".yaml",""),"_logo.svg"),!1)),inline:!0,style:{cursor:"pointer",height:35}}))};return React.createElement(r,{loading:this.props.loading},_.map(_.chunk(["aws.yaml","gcp.yaml","openstack.yaml","azure.yaml"],2),(function(e,t){return React.createElement(r.Group,{key:"platformGroup".concat(t),widths:"equal"},_.map(e,(function(e){return React.createElement(r.Field,{key:e},React.createElement(s,{value:e,active:o===e}))})))})))}}]),t}(React.Component);f()(x,"defaultBlueprintName","hello-world"),f()(x,"helloWorldBlueprintUrl","https://github.com/cloudify-cosmo/cloudify-hello-world-example/archive/master.zip"),f()(x,"defaultBlueprintYaml","aws.yaml"),f()(x,"initialState",{stepData:{blueprintUrl:x.helloWorldBlueprintUrl,blueprintFile:null,blueprintName:x.defaultBlueprintName,blueprintFileName:x.defaultBlueprintYaml,imageUrl:"",imageFile:null,visibility:Stage.Common.Consts.defaultVisibility}}),f()(x,"propTypes",Stage.Basic.Wizard.Step.Content.propTypes);var C=D("infrastructure","Infrastructure","Select IaaS Provider",x,O),I=n(17),T=n.n(I),j=function(e){function t(){return a()(this,t),l()(this,c()(t).apply(this,arguments))}return d()(t,e),o()(t,[{key:"shouldComponentUpdate",value:function(e){return this.props.status!==e.status||this.props.text!==e.text}},{key:"render",value:function(){var e=Stage.Basic,n=e.Icon,r=e.Popup,a=this.props.status,i=null,o=this.props.text;switch(a){case t.unknown:i=React.createElement(n,{name:"question",color:"grey",size:"big"});break;case t.noActionRequired:i=React.createElement(n,{name:"check",color:"green",size:"big"});break;case t.actionRequired:i=React.createElement(n,{name:"warning",color:"yellow",size:"big"});break;case t.errorOccurred:default:i=React.createElement(n,{name:"cancel",color:"red",size:"big"})}return React.createElement(r,{hoverable:!0,trigger:i,header:"Status",content:o})}}]),t}(React.Component);f()(j,"unknown",0),f()(j,"noActionRequired",1),f()(j,"actionRequired",2),f()(j,"errorOccurred",3),f()(j,"propTypes",{status:PropTypes.oneOf([j.unknown,j.noActionRequired,j.actionRequired,j.errorOccurred]).isRequired,text:PropTypes.string.isRequired});var N=function(e){function t(){return a()(this,t),l()(this,c()(t).apply(this,arguments))}return d()(t,e),o()(t,[{key:"render",value:function(){var e=this.props.children;return React.createElement("div",null,e)}}]),t}(React.Component);f()(N,"propTypes",{children:PropTypes.any});var U=function(e){function t(){return a()(this,t),l()(this,c()(t).apply(this,arguments))}return d()(t,e),o()(t,[{key:"render",value:function(){var e=Stage.Basic.Message,t=this.props.resourceName;return React.createElement(e,{success:!0,icon:"checkmark",header:"No ".concat(t," required"),content:"You can go to the next step."})}}]),t}(React.Component);function B(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function z(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?B(Object(n),!0).forEach((function(t){f()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):B(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}f()(U,"propTypes",{resourceName:PropTypes.string.isRequired});var F=Stage.Basic.Wizard.Utils.createWizardStep,A=function(e){function t(e){return a()(this,t),l()(this,c()(t).call(this,e))}return d()(t,e),o()(t,[{key:"onNext",value:function(e){var t=this;return this.props.onLoading().then(this.props.fetchData).then((function(n){var r=n.stepData,a=_.pickBy(r,(function(e){return e.status!==W.statusInstalledAndParametersMatched})),i=[],o={};if(_.forEach(a,(function(e,t){var n=e.wagonFile?"":e.wagonUrl,r=e.yamlFile?"":e.yamlUrl,a=_.isEmpty(n)?!e.wagonFile:!Stage.Utils.Url.isUrl(n),s=_.isEmpty(r)?!e.yamlFile:!Stage.Utils.Url.isUrl(r);(a||s)&&(i.push(t),o[t]={wagonUrl:a,yamlUrl:s})})),!_.isEmpty(i))return Promise.reject({message:"Please correctly fill in fields for the following plugins: ".concat(i.join(", "),"."),errors:o});var s=_.pickBy(a,(function(e){return e.status===W.statusUserDefinedPlugin})),l={plugins:_.mapValues(s,(function(){return{params:{}}}))};return t.props.onNext(e,{plugins:a,userResources:l})})).catch((function(n){return t.props.onError(e,n.message,n.errors)}))}},{key:"render",value:function(){var e=Stage.Basic.Wizard;return React.createElement(e.Step.Actions,y()({},this.props,{onNext:this.onNext.bind(this)}))}}]),t}(React.Component);f()(A,"propTypes",Stage.Basic.Wizard.Step.Actions.propTypes);var W=function(e){function t(e){var n;return a()(this,t),(n=l()(this,c()(t).call(this,e))).state={pluginsInCatalog:[],pluginsInManager:[]},n}return d()(t,e),o()(t,[{key:"componentDidMount",value:function(){var e=this;this.props.onLoading().then((function(){return Promise.all([e.props.toolbox.getManager().doGet("/plugins?_include=distribution,package_name,package_version,visibility"),e.props.toolbox.getExternal().doGet("http://repository.cloudifysource.org/cloudify/wagons/plugins.json")])})).then((function(n){var r=T()(n,2),a=r[0],i=r[1],o=_.get(e.props.wizardData,t.blueprintDataPath,{}),s=_.get(e.props.wizardData,t.userDataPath,{});a=a.items,a=_.reduce(a,(function(e,t){return e[t.package_name]={version:t.package_version,distribution:t.distribution,visibility:t.visibility},e}),{}),i=_.reduce(i,(function(e,t){return e[t.name]=z({},_.omit(t,"name")),e}),{});var l={},u=!0,c=!1,p=void 0;try{for(var d,h=_.keys(o)[Symbol.iterator]();!(u=(d=h.next()).done);u=!0){var f=d.value,m=z({},t.defaultPluginState,{},e.props.stepData[f]);m.status=t.getPluginStatus(f,o,a,i),m.status===t.statusNotInstalledAndInCatalog?function(){var t="".concat(e.props.toolbox.getManager().getDistributionName().toLowerCase()," ").concat(e.props.toolbox.getManager().getDistributionRelease().toLowerCase()),n=_.find(i[f].wagons,(function(e){return e.name.toLowerCase()===t||"any"===e.name.toLowerCase()}));m.wagonUrl=n.url,m.yamlUrl=i[f].link}():m.status===t.statusInstalledAndParametersMatched&&(m.visibility=a[f].visibility),l[f]=z({},m)}}catch(e){c=!0,p=e}finally{try{u||null==h.return||h.return()}finally{if(c)throw p}}var g=!0,y=!1,v=void 0;try{for(var b,S=_.keys(s)[Symbol.iterator]();!(g=(b=S.next()).done);g=!0){var w=b.value,E=z({},t.defaultPluginState,{},e.props.stepData[w]);E.status=t.statusUserDefinedPlugin,l[w]=z({},E)}}catch(e){y=!0,v=e}finally{try{g||null==S.return||S.return()}finally{if(y)throw v}}return{stepData:l,pluginsInManager:a,pluginsInCatalog:i}})).then((function(t){var n=t.stepData,r=t.pluginsInManager,a=t.pluginsInCatalog;return new Promise((function(t){return e.setState({pluginsInManager:r,pluginsInCatalog:a},(function(){e.props.onChange(e.props.id,n),t()}))}))})).catch((function(t){return e.props.onError(e.props.id,t)})).finally((function(){return e.props.onReady()}))}},{key:"getPluginStatus",value:function(e){switch(_.get(this.props.stepData[e],"status")){case t.statusInstalledAndParametersMatched:return React.createElement(j,{status:j.noActionRequired,text:"Plugin already installed. No action required."});case t.statusInstalledAndParametersUnmatched:return React.createElement(j,{status:j.actionRequired,text:"Plugin installed but with different parameters. Provide details."});case t.statusNotInstalledAndNotInCatalog:return React.createElement(j,{status:j.actionRequired,text:"Cannot find plugin. Provide details."});case t.statusUserDefinedPlugin:return React.createElement(j,{status:j.actionRequired,text:"User defined plugin. Provide details."});case t.statusNotInstalledAndInCatalog:return React.createElement(j,{status:j.noActionRequired,text:"Plugin has been found in catalog and will be installed automatically. No action required."});case t.statusUnknown:return React.createElement(j,{status:j.unknown,text:"Unknown status."});default:return React.createElement(j,{status:j.errorOccurred,text:"Error during status calculation."})}}},{key:"onChange",value:function(e){var t=this;return function(n){var r=z({},t.props.stepData);return r[e]=z({},r[e],{},n),t.props.onChange(t.props.id,z({},r))}}},{key:"addUserPlugin",value:function(){var e=z({},this.props.stepData),n=function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"user-plugin",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3,r="",a=!1,i=0;i<n&&!a;i++)r="".concat(t,"-").concat(i),a=!e[r];return r}();e[n]=z({},t.defaultPluginState),e[n].status=t.statusUserDefinedPlugin,this.props.onChange(this.props.id,e)}},{key:"deleteUserPlugin",value:function(e){var t=z({},_.omit(this.props.stepData,e));this.props.onChange(this.props.id,t)}},{key:"getPluginAction",value:function(e){var n=_.get(this.props.stepData[e],"status"),r=Stage.Common.UploadPluginForm;switch(n){case t.statusInstalledAndParametersMatched:return React.createElement(N,null,"No action required.");case t.statusInstalledAndParametersUnmatched:case t.statusNotInstalledAndNotInCatalog:case t.statusUserDefinedPlugin:return React.createElement(N,null,React.createElement(r,{wagonUrl:this.props.stepData[e].wagonUrl,wagonFile:this.props.stepData[e].wagonFile,wagonPlaceholder:"",yamlUrl:this.props.stepData[e].yamlUrl,yamlFile:this.props.stepData[e].yamlFile,yamlPlaceholder:"",errors:this.props.errors[e],wrapInForm:!1,addRequiredMarks:!1,loading:this.props.loading,onChange:this.onChange(e).bind(this)}));case t.statusNotInstalledAndInCatalog:return React.createElement(N,null,"No action required.");case t.statusUnknown:default:return React.createElement(N,null)}}},{key:"getPluginVisibility",value:function(e){var n=this,r=Stage.Basic.VisibilityField,a=this.props.stepData[e];switch(_.get(a,"status")){case t.statusInstalledAndParametersMatched:return React.createElement(N,null,React.createElement(r,{visibility:a.visibility,className:"large",allowChange:!1}));case t.statusInstalledAndParametersUnmatched:case t.statusNotInstalledAndNotInCatalog:case t.statusNotInstalledAndInCatalog:case t.statusUserDefinedPlugin:return React.createElement(N,null,React.createElement(r,{visibility:a.visibility,className:"large",onVisibilityChange:function(t){return n.onChange(e)({visibility:t})}}));default:return null}}},{key:"isUserDefinedPlugin",value:function(e){return _.isEqual(_.get(this.props.stepData[e],"status",t.statusUnknown),t.statusUserDefinedPlugin)}},{key:"render",value:function(){var e=this,n=Stage.Basic,r=n.Button,a=n.Form,i=n.Popup,o=n.Table,s=z({},_.get(this.props.wizardData,t.blueprintDataPath,{}),{},_.get(this.props.wizardData,t.userDataPath,{})),l=_.isEmpty(this.props.stepData);return React.createElement(a,{loading:this.props.loading,success:l},l?React.createElement(U,{resourceName:"plugins"}):React.createElement(o,{celled:!0},React.createElement(o.Header,null,React.createElement(o.Row,null,React.createElement(o.HeaderCell,null,"Plugin"),React.createElement(o.HeaderCell,null,"Version"),React.createElement(o.HeaderCell,null,"Distribution"),React.createElement(o.HeaderCell,{colSpan:"3"},"Action"))),React.createElement(o.Body,null,l?React.createElement(U,{resourceName:"plugins"}):_.map(_.keys(this.props.stepData),(function(t){var n=e.state.pluginsInCatalog[t],a=Stage.Basic.Image;return React.createElement(o.Row,{key:t,name:t},React.createElement(o.Cell,{collapsing:!0},_.isNil(n)?React.createElement("span",null,t," "):React.createElement("span",null,React.createElement(a,{src:n.icon,height:"25",verticalAlign:"middle",spaced:"right"}),n.title),e.isUserDefinedPlugin(t)&&React.createElement(i,{trigger:React.createElement(r,{icon:"minus",size:"mini",onClick:e.deleteUserPlugin.bind(e,t)}),content:"Remove plugin"})),React.createElement(o.Cell,{collapsing:!0},_.get(s[t],"params.version","-")),React.createElement(o.Cell,{collapsing:!0},_.get(s[t],"params.distribution","-")),React.createElement(o.Cell,{collapsing:!0},e.getPluginStatus(t)),React.createElement(o.Cell,null,e.getPluginAction(t)),React.createElement(o.Cell,{collapsing:!0},e.getPluginVisibility(t)))})))),React.createElement(a.Button,{content:"Add plugin",icon:"add",labelPosition:"left",onClick:this.addUserPlugin.bind(this)}))}}],[{key:"getPluginStatus",value:function(e,n,r,a){var i=n[e],o=_.get(i,"params.version"),s=_.get(i,"params.distribution"),l=r[e],u=a[e];return _.isNil(l)?_.isNil(u)?t.statusNotInstalledAndNotInCatalog:_.isNil(o)||_.isEqual(o,u.version)?t.statusNotInstalledAndInCatalog:t.statusNotInstalledAndNotInCatalog:(_.isNil(o)||_.isEqual(o,l.version))&&(_.isNil(s)||_.isEqual(s,l.distribution))?t.statusInstalledAndParametersMatched:t.statusInstalledAndParametersUnmatched}}]),t}(React.Component);f()(W,"propTypes",Stage.Basic.Wizard.Step.Content.propTypes),f()(W,"statusUnknown",0),f()(W,"statusInstalledAndParametersMatched",1),f()(W,"statusInstalledAndParametersUnmatched",2),f()(W,"statusNotInstalledAndInCatalog",3),f()(W,"statusUserDefinedPlugin",4),f()(W,"statusNotInstalledAndNotInCatalog",5),f()(W,"defaultPluginState",{yamlUrl:"",yamlFile:null,wagonUrl:"",wagonFile:null,visibility:Stage.Common.Consts.defaultVisibility,status:W.statusUnknown}),f()(W,"blueprintDataPath","blueprint.plugins"),f()(W,"userDataPath","userResources.plugins");var L=F("plugins","Plugins","Select plugins",W,A);function q(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function M(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?q(Object(n),!0).forEach((function(t){f()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):q(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var G=Stage.Basic.Wizard.Utils.createWizardStep,V=function(e){function t(){return a()(this,t),l()(this,c()(t).apply(this,arguments))}return d()(t,e),o()(t,[{key:"onNext",value:function(e){var t=this;return this.props.onLoading().then(this.props.fetchData).then((function(n){var r=n.stepData,a=_.chain(r).pickBy((function(e){return e.status===H.statusUndefined})).value(),i=_.chain(r).pickBy((function(e){return e.status===H.statusUndefined&&_.isEmpty(e.value)})).mapValues((function(){return!0})).value();return _.isEmpty(i)?t.props.onNext(e,{secrets:a}):Promise.reject({message:"Provide values for the following secrets: ".concat(_.keys(i).join(", ")),errors:i})})).catch((function(n){return t.props.onError(e,n.message,n.errors)}))}},{key:"render",value:function(){var e=Stage.Basic.Wizard;return React.createElement(e.Step.Actions,y()({},this.props,{onNext:this.onNext.bind(this)}))}}]),t}(React.Component);f()(V,"propTypes",Stage.Basic.Wizard.Step.Actions.propTypes);var H=function(e){function t(e){var n;return a()(this,t),(n=l()(this,c()(t).call(this,e))).state=t.initialState,n}return d()(t,e),o()(t,[{key:"componentDidMount",value:function(){var e=this,n=_.get(this.props.wizardData,t.dataPath,{});this.props.onLoading().then((function(){return e.props.toolbox.getManager().doGet("/secrets?_include=key,visibility")})).then((function(r){r=r.items,r=_.reduce(r,(function(e,t){return e[t.key]={visibility:t.visibility},e}),{});var a={},i=!0,o=!1,s=void 0;try{for(var l,u=_.keys(n)[Symbol.iterator]();!(i=(l=u.next()).done);i=!0){var c=l.value;a[c]=e.props.stepData[c]||M({},t.defaultSecretState),_.includes(_.keys(r),c)?(a[c].status=t.statusDefined,a[c].visibility=r[c].visibility):a[c].status=t.statusUndefined}}catch(e){o=!0,s=e}finally{try{i||null==u.return||u.return()}finally{if(o)throw s}}return{stepData:a,secretsInManager:r}})).then((function(t){var n=t.stepData,r=t.secretsInManager;return new Promise((function(t){return e.setState({secretsInManager:r},(function(){e.props.onChange(e.props.id,n),t()}))}))})).catch((function(t){return e.props.onError(e.props.id,t)})).finally((function(){return e.props.onReady()}))}},{key:"getSecretStatus",value:function(e){switch(this.props.stepData[e].status){case t.statusDefined:return React.createElement(j,{status:j.noActionRequired,text:"Secret defined."});case t.statusUndefined:return React.createElement(j,{status:j.actionRequired,text:"Secret not defined. Please provide value for the secret."});default:return React.createElement(j,{status:j.unknown,text:"Unknown status. Internal error."})}}},{key:"getSecretAction",value:function(e){var n=this,r=Stage.Basic.Form,a=this.props.stepData[e];switch(a.status){case t.statusDefined:return React.createElement(N,null,"No action required.");case t.statusUndefined:return React.createElement(N,null,React.createElement(r.Input,{name:e,value:a.value,error:this.props.errors[e],fluid:!0,placeholder:"Provide secret value",onChange:function(t,r){r.name;var a=r.value;return n.handleChange(e,"value",a)}}));default:return null}}},{key:"getSecretVisibility",value:function(e){var n=this,r=Stage.Basic.VisibilityField,a=this.props.stepData[e];switch(a.status){case t.statusDefined:return React.createElement(N,null,React.createElement(r,{visibility:a.visibility,className:"large",allowChange:!1}));case t.statusUndefined:return React.createElement(N,null,React.createElement(r,{visibility:a.visibility,className:"large",onVisibilityChange:function(t){return n.handleChange(e,"visibility",t)}}));default:return null}}},{key:"handleChange",value:function(e,t,n){var r=M({},this.props.stepData[e]);r[t]=n,this.props.onChange(this.props.id,M({},this.props.stepData,f()({},e,r)))}},{key:"render",value:function(){var e=this,n=Stage.Basic,r=n.Form,a=n.Table,i=_.get(this.props.wizardData,t.dataPath,{}),o=_.isEmpty(i);return React.createElement(r,{loading:this.props.loading,success:o},o?React.createElement(U,{resourceName:"secrets"}):React.createElement(a,{celled:!0},React.createElement(a.Header,null,React.createElement(a.Row,null,React.createElement(a.HeaderCell,null,"Secret"),React.createElement(a.HeaderCell,{colSpan:"3"},"Action"))),React.createElement(a.Body,null,_.map(_.keys(this.props.stepData),(function(t){return!_.isNil(i[t])&&React.createElement(a.Row,{key:t,name:t},React.createElement(a.Cell,{collapsing:!0},t),React.createElement(a.Cell,{collapsing:!0},e.getSecretStatus(t)),React.createElement(a.Cell,null,e.getSecretAction(t)),React.createElement(a.Cell,{collapsing:!0},e.getSecretVisibility(t)))})))))}}]),t}(React.Component);f()(H,"propTypes",Stage.Basic.Wizard.Step.Content.propTypes),f()(H,"statusUnknown",0),f()(H,"statusDefined",1),f()(H,"statusUndefined",2),f()(H,"defaultSecretState",{value:"",visibility:Stage.Common.Consts.defaultVisibility,status:H.statusUnknown}),f()(H,"dataPath","blueprint.secrets"),f()(H,"initialState",{secretsInManager:[]});var Y=G("secrets","Secrets","Define secrets",H,V);function J(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function K(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?J(Object(n),!0).forEach((function(t){f()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):J(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Q=Stage.Basic.Wizard.Utils.createWizardStep,X=function(e){function t(e){return a()(this,t),l()(this,c()(t).call(this,e))}return d()(t,e),o()(t,[{key:"onNext",value:function(e){var n=this,r=Stage.Common.InputsUtils;return this.props.onLoading().then(this.props.fetchData).then((function(a){var i=a.stepData,o={},s=_.get(n.props.wizardData,t.inputsDataPath,{}),l=r.getInputsToSend(s,i,o);return _.isEmpty(o)?n.props.onNext(e,{inputs:K({},l)}):Promise.reject({message:"Provide values for the following inputs: ".concat(_.keys(o).join(", ")),errors:o})})).catch((function(t){return n.props.onError(e,t.message,t.errors)}))}},{key:"render",value:function(){var e=Stage.Basic.Wizard;return React.createElement(e.Step.Actions,y()({},this.props,{onNext:this.onNext.bind(this)}))}}]),t}(React.Component);f()(X,"propTypes",Stage.Basic.Wizard.Step.Actions.propTypes),f()(X,"inputsDataPath","blueprint.inputs");var Z=function(e){function t(e){var n;return a()(this,t),(n=l()(this,c()(t).call(this,e))).state={fileLoading:!1},n}return d()(t,e),o()(t,[{key:"componentDidMount",value:function(){var e=this,n=_.get(this.props.wizardData,t.inputsDataPath,{}),r=_.get(this.props.wizardData,t.dataTypesDataPath,{}),a=_.mapValues(n,(function(t,a){if(!_.isUndefined(e.props.stepData[a]))return e.props.stepData[a];var i=!_.isEmpty(r)&&n[a].type?r[n[a].type]:void 0;return Stage.Common.InputsUtils.getInputFieldInitialValue(t.default,t.type,i)}));this.props.onChange(this.props.id,K({},a))}},{key:"handleInputChange",value:function(e,t){this.props.onChange(this.props.id,K({},this.props.stepData,{},Stage.Basic.Form.fieldNameValue(t)))}},{key:"handleYamlFileChange",value:function(e){var n=this;if(e){var r=Stage.Common,a=r.FileActions,i=r.InputsUtils,o=new a(this.props.toolbox);this.setState({fileLoading:!0}),o.doGetYamlFileContent(e).then((function(e){var r=_.get(n.props.wizardData,t.inputsDataPath,{}),a=i.getUpdatedInputs(r,n.props.stepData,e);n.props.onChange(n.props.id,K({},a)),n.setState({fileLoading:!1})})).catch((function(e){var t="Loading values from YAML file failed: ".concat(_.isString(e)?e:e.message);n.props.onError(n.props.id,t,{yamlFile:t}),n.setState({fileLoading:!1})}))}}},{key:"getInputStatus",value:function(e){return _.isNil(e)?React.createElement(j,{status:j.actionRequired,text:"Input has no default value defined. Please provide value."}):React.createElement(j,{status:j.noActionRequired,text:"Input has default value defined. No action required."})}},{key:"render",value:function(){var e=this,n=Stage.Basic,r=n.Divider,a=n.Form,i=n.Table,o=Stage.Common,s=o.DataTypesButton,l=o.InputsUtils,u=o.InputsHeader,c=o.YamlFileButton,p=_.get(this.props.wizardData,t.inputsDataPath,{}),d=_.get(this.props.wizardData,t.dataTypesDataPath,{}),h=_.isEmpty(p);return React.createElement(a,{loading:this.props.loading,success:h},h?React.createElement(U,{resourceName:"inputs"}):React.createElement("div",null,React.createElement(c,{onChange:this.handleYamlFileChange.bind(this),dataType:"deployment's inputs",fileLoading:this.state.fileLoading}),!_.isEmpty(d)&&React.createElement(s,{types:d}),React.createElement(r,{hidden:!0,style:{clear:"both"}}),React.createElement(i,{celled:!0},React.createElement(i.Header,null,React.createElement(i.Row,null,React.createElement(i.HeaderCell,null,"Input"),React.createElement(i.HeaderCell,{colSpan:"2"},React.createElement(u,{header:"Value",dividing:!1})))),React.createElement(i.Body,null,_.map(_.keys(this.props.stepData),(function(t){if(!_.isNil(p[t])){var n=!_.isEmpty(d)&&p[t].type?d[p[t].type]:void 0,r=l.getHelp(p[t].description,p[t].type,p[t].constraints,p[t].default,n);return React.createElement(i.Row,{key:t,name:t},React.createElement(i.Cell,{collapsing:!0},React.createElement(a.Field,{key:t,help:r,label:t})),React.createElement(i.Cell,{collapsing:!0},e.getInputStatus(p[t].default)),React.createElement(i.Cell,null,l.getInputField(t,e.props.stepData[t],p[t].default,e.handleInputChange.bind(e),e.props.errors[t],p[t].type,p[t].constraints)))}return null}))))))}}]),t}(React.Component);f()(Z,"propTypes",Stage.Basic.Wizard.Step.Content.propTypes),f()(Z,"inputsDataPath","blueprint.inputs"),f()(Z,"dataTypesDataPath","blueprint.dataTypes");var $=Q("inputs","Inputs","Provide inputs",Z,X),ee=n(12),te=n.n(ee),ne=n(18),re=n.n(ne),ae=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.Status.pending,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;a()(this,e),this.name=t,this.promise=n,this.status=r,this.error=i}return o()(e,[{key:"changeToInProgress",value:function(){this.status=e.Status.inProgress}},{key:"changeToFinished",value:function(){this.status=e.Status.finished}},{key:"changeToFailed",value:function(t){this.status=e.Status.failed,this.error=t}},{key:"isPending",value:function(){return this.status===e.Status.pending}},{key:"isInProgress",value:function(){return this.status===e.Status.inProgress}},{key:"isFinished",value:function(){return this.status===e.Status.finished}},{key:"isFailed",value:function(){return this.status===e.Status.failed}},{key:"run",value:function(){return this.promise()}}]),e}();f()(ae,"Status",{pending:0,inProgress:1,finished:2,failed:3});var ie=function(e){function t(){return a()(this,t),l()(this,c()(t).apply(this,arguments))}return d()(t,e),o()(t,[{key:"getStatusIcon",value:function(){var e=Stage.Basic.Icon,t={color:"",loading:!1,name:""};switch(this.props.status){case ae.Status.pending:t.color="black",t.name="clock";break;case ae.Status.inProgress:t.color="grey",t.loading=!0,t.name="spinner";break;case ae.Status.finished:t.color="green",t.name="check";break;case ae.Status.failed:t.color="red",t.name="remove"}return React.createElement(e,t)}},{key:"getStatusText",value:function(){var e=this.props,t=e.error,n=e.status,r="",a=t?React.createElement("em",null,t):null;switch(n){case ae.Status.pending:r="Pending.";break;case ae.Status.inProgress:r="In progress.";break;case ae.Status.finished:r="Finished successfully.";break;case ae.Status.failed:r="Failed with error: "}return React.createElement(React.Fragment,null,React.createElement("strong",null,r),a)}},{key:"render",value:function(){var e=this.props.name,t=this.getStatusIcon(),n=this.getStatusText();return React.createElement("span",null,e,"... ",t," ",n)}}]),t}(React.Component);f()(ie,"propTypes",{name:PropTypes.string.isRequired,status:PropTypes.oneOf([ae.Status.pending,ae.Status.inProgress,ae.Status.finished,ae.Status.failed]).isRequired,error:PropTypes.string});var oe=function(e){function t(){return a()(this,t),l()(this,c()(t).apply(this,arguments))}return d()(t,e),o()(t,[{key:"render",value:function(){var e=this,t=this.props.tasks,n=Stage.Basic,r=n.Header,a=n.List;return React.createElement(React.Fragment,null,React.createElement(r,{as:"h4"},this.props.header),React.createElement(a,{ordered:!0,relaxed:!0},_.map(t,(function(t){return React.createElement(a.Item,{key:t.name},e.props.withStatus?React.createElement(ie,t):t.name)}))))}}]),t}(React.Component);function se(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function le(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?se(Object(n),!0).forEach((function(t){f()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):se(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}f()(oe,"propTypes",{header:PropTypes.string,tasks:PropTypes.arrayOf(PropTypes.shape(ie.propTypes)),withStatus:PropTypes.bool}),f()(oe,"defaultProps",{header:"Task list",withStatus:!1});var ue=Stage.Basic.Wizard.Utils.createWizardStep,ce=function(e){function t(e){return a()(this,t),l()(this,c()(t).call(this,e))}var n;return d()(t,e),o()(t,[{key:"isUsed",value:(n=re()(te.a.mark((function e(t){var n,r;return te.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new Stage.Common.DeploymentActions(this.props.toolbox),r=function(){return n.doGetDeployments({_search:t})},e.t0=_,e.t1=t,e.next=6,pe.chooseId(t,r,"deployment");case 6:return e.t2=e.sent,e.abrupt("return",!e.t0.isEqual.call(e.t0,e.t1,e.t2));case 8:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"onNext",value:function(e){var t=this;return this.props.onLoading().then(this.props.fetchData).then((function(e){var n=e.stepData;return t.isUsed(n.deploymentId).then((function(e){return{stepData:n,isDeploymentNameUsed:e}}))})).then((function(n){var r=n.stepData;n.isDeploymentNameUsed?t.props.onError(e,"Deployment name '".concat(r.deploymentId,"' is already used. Please choose a different one."),{deploymentId:!0}):t.props.onNext(e,{tasks:r.tasks,installOutputs:{deploymentId:r.deploymentId,blueprintId:r.blueprintId}})})).catch((function(n){return t.props.onError(e,n)}))}},{key:"render",value:function(){var e=Stage.Basic.Wizard;return React.createElement(e.Step.Actions,y()({},this.props,{onNext:this.onNext.bind(this),nextLabel:"Install",nextIcon:"download"}))}}]),t}(React.Component);f()(ce,"propTypes",Stage.Basic.Wizard.Step.Actions.propTypes);var pe=function(e){function t(e){return a()(this,t),l()(this,c()(t).call(this,e))}return d()(t,e),o()(t,[{key:"addPluginsTasks",value:function(e,t){var n=new Stage.Common.PluginActions(this.props.toolbox),r=!0,a=!1,i=void 0;try{for(var o,s=function(){var r=o.value,a=e[r],i=a.wagonFile?"":a.wagonUrl,s=a.yamlFile?"":a.yamlUrl;t.push(new ae("Upload plugin ".concat(r),(function(){return n.doUpload(a.visibility,i,s,a.wagonFile,a.yamlFile)})))},l=_.keys(e)[Symbol.iterator]();!(r=(o=l.next()).done);r=!0)s()}catch(e){a=!0,i=e}finally{try{r||null==l.return||l.return()}finally{if(a)throw i}}return Promise.resolve()}},{key:"addSecretsTasks",value:function(e,t){var n=new Stage.Common.SecretActions(this.props.toolbox),r=!0,a=!1,i=void 0;try{for(var o,s=function(){var r=o.value,a=e[r].value,i=e[r].visibility;t.push(new ae("Create secret ".concat(r),(function(){return n.doCreate(r,a,i,!1)})))},l=_.keys(e)[Symbol.iterator]();!(r=(o=l.next()).done);r=!0)s()}catch(e){a=!0,i=e}finally{try{r||null==l.return||l.return()}finally{if(a)throw i}}return Promise.resolve()}},{key:"chooseBlueprintId",value:function(e){var n=new Stage.Common.BlueprintActions(this.props.toolbox);return t.chooseId(e,(function(){return n.doGetBlueprints({_search:e})}),"blueprint")}},{key:"addBlueprintUploadTask",value:function(e,t){var n=new Stage.Common.BlueprintActions(this.props.toolbox),r=e.blueprintFile?"":e.blueprintUrl,a=e.imageFile?"":e.imageUrl;return t.push(new ae("Upload blueprint ".concat(e.blueprintName),(function(){return n.doUpload(e.blueprintName,e.blueprintFileName,r,e.blueprintFile,a,e.imageFile,e.visibility)}))),Promise.resolve()}},{key:"chooseDeploymentId",value:function(e){var n=new Stage.Common.DeploymentActions(this.props.toolbox);return t.chooseId(e,(function(){return n.doGetDeployments({_search:e})}),"deployment")}},{key:"addDeployBlueprintTask",value:function(e,t,n,r,a){var i=new Stage.Common.BlueprintActions(this.props.toolbox),o=new Stage.Common.ExecutionActions(this.props.toolbox),s=function(){var t=re()(te.a.mark((function t(){var n,r,a,i,s,l;return te.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=60,r=1e3,a=!1,i=te.a.mark((function t(n){return te.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,new Promise((function(e){console.debug("Waiting for deployment is created...",n),setTimeout(e,r)})).then((function(){return o.doGetExecutions(e)})).then((function(e){var t=e.items;a=!_.isEmpty(t)&&_.isUndefined(_.find(t,{ended_at:null}))}));case 2:case"end":return t.stop()}}),t)})),s=0;case 5:if(!(s<n)||a){t.next=10;break}return t.delegateYield(i(s),"t0",7);case 7:s++,t.next=5;break;case 10:if(!a){t.next=12;break}return t.abrupt("return",Promise.resolve());case 12:return l=Math.floor(n*r/1e3),t.abrupt("return",Promise.reject("Timeout exceeded. Deployment was not created after ".concat(l," seconds.")));case 14:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();return a.push(new ae("Create ".concat(e," deployment from ").concat(t," blueprint"),(function(){return i.doDeploy({id:t},e,n,r).then((function(){return s()}))}))),Promise.resolve()}},{key:"addRunInstallWorkflowTask",value:function(e,t){var n=new Stage.Common.DeploymentActions(this.props.toolbox);return t.push(new ae("Execute install workflow on ".concat(e," deployment"),(function(){return n.doExecute({id:e},{name:"install"},{},!1)}))),Promise.resolve()}},{key:"componentDidMount",value:function(){var e=this,t=this.props.wizardData,n=[],r="",a="";this.props.onLoading().then((function(){return e.addPluginsTasks(t.plugins,n)})).then((function(){return e.addSecretsTasks(t.secrets,n)})).then((function(){return e.chooseBlueprintId(t.blueprint.blueprintName)})).then((function(a){return r=a,e.addBlueprintUploadTask(le({},t.blueprint,{blueprintName:a}),n)})).then((function(){return e.chooseDeploymentId(r)})).then((function(i){a=i,e.addDeployBlueprintTask(i,r,t.inputs,t.blueprint.visibility,n)})).then((function(){return e.addRunInstallWorkflowTask(a,n)})).then((function(){return{stepData:{tasks:n,blueprintId:r,deploymentId:a}}})).then((function(t){var n=t.stepData;return e.props.onChange(e.props.id,n)})).then((function(){return e.setState({deploymentId:a})})).catch((function(t){return e.props.onError(e.props.id,t)})).finally((function(){return e.props.onReady()}))}},{key:"handleInputChange",value:function(e,t){var n=_.dropRight(this.props.stepData.tasks,2);this.addDeployBlueprintTask(t.value,this.props.stepData.blueprintId,this.props.wizardData.inputs,this.props.wizardData.blueprint.visibility,n),this.addRunInstallWorkflowTask(t.value,n),this.props.onChange(this.props.id,le({},this.props.stepData,{tasks:n},Stage.Basic.Form.fieldNameValue(t)))}},{key:"render",value:function(){var e=Stage.Basic.Form,t=_.get(this.props.stepData,"tasks",[]),n=_.get(this.props.stepData,"deploymentId",[]);return React.createElement(e,{loading:this.props.loading},React.createElement(e.Input,{label:"Deployment name",name:"deploymentId",value:n,fluid:!0,error:this.props.errors.deploymentId,required:!0,onChange:this.handleInputChange.bind(this)}),React.createElement(oe,{tasks:t}))}}],[{key:"chooseId",value:function(e,t,n){var r=function(e,t){return!_.isUndefined(_.find(e,{id:t}))},a=e,i=!1;return t().then((function(t){var o=t.items;i=!r(o,a);for(var s=0;s<1e3&&!i;s++)a="".concat(e,"_").concat(s),i=!r(o,a);return i?Promise.resolve(a):Promise.reject("Not found unused ".concat(n," ID."))}))}}]),t}(React.Component);f()(pe,"propTypes",Stage.Basic.Wizard.Step.Content.propTypes);var de=ue("confirm","Confirm","Confirm installation",pe,ce),he=n(10),fe=n.n(he);function me(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ge(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?me(Object(n),!0).forEach((function(t){f()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):me(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ye=Stage.Basic.Wizard.Utils.createWizardStep,ve=_.reduce(_.values(ae.Status),(function(e,t){return ge({},e,f()({},t,0))}),{}),be=function(e){function t(e){var n;return a()(this,t),(n=l()(this,c()(t).call(this,e))).redirectionInterval=null,n.state=t.initialState,n}return d()(t,e),o()(t,[{key:"componentDidMount",value:function(){this.setState(t.initialState)}},{key:"componentDidUpdate",value:function(){var e=this,t=this.getTasksStats();if(-1===this.state.secondsRemaining&&t.allTasksEnded){this.setState({secondsRemaining:10}),this.redirectionInterval=setInterval((function(){e.setState({secondsRemaining:e.state.secondsRemaining-1},(function(){e.state.secondsRemaining<=0&&(e.cancelRedirection(),e.drillDownToDeploymentPage())}))}),1e3)}}},{key:"componentWillUnmount",value:function(){this.cancelRedirection()}},{key:"drillDownToDeploymentPage",value:function(){var e=_.get(this.props,"wizardData.installOutputs.deploymentId",null);this.props.toolbox.drillDown(this.props.toolbox.getWidget(),"deployment",{deploymentId:e},e)}},{key:"cancelRedirection",value:function(){this.setState({secondsRemaining:0}),clearInterval(this.redirectionInterval)}},{key:"getTasksStats",value:function(){var e=_.get(this.props,"wizardData.tasksStats",ve),t=_.get(this.props,"wizardData.tasks.length",0),n=e[ae.Status.finished]+e[ae.Status.failed],r=n===t,a=e[ae.Status.failed]>0;return{numberOfTasks:t,numberOfEndedTasks:n,anyTaskFailed:a,allTasksEnded:r,installationEnded:r||a}}},{key:"render",value:function(){var e=Stage.Basic,t=e.Button,n=e.Progress,r=e.Wizard,a=this.getTasksStats(),i=a.numberOfTasks>0?Math.floor(a.numberOfEndedTasks/a.numberOfTasks*100):0;return a.installationEnded||-1!==this.state.secondsRemaining?a.allTasksEnded&&this.state.secondsRemaining>0?React.createElement(r.Step.Actions,y()({},this.props,{showNext:!1,showPrev:!1,showStartOver:!1,showClose:!1}),React.createElement(n,{size:"large",percent:i,autoSuccess:!0},"Installation started! Redirecting to deployment page in ",this.state.secondsRemaining," seconds..."),React.createElement(t,{content:"Stay on this page",icon:"hand paper",labelPosition:"left",onClick:this.cancelRedirection.bind(this)})):a.allTasksEnded&&0===this.state.secondsRemaining?React.createElement(r.Step.Actions,y()({},this.props,{showNext:!1,showPrev:!1,showStartOver:!0,startOverLabel:"Install another blueprint",resetDataOnStartOver:!0}),React.createElement(n,{size:"large",percent:i,autoSuccess:!0},"Installation started!"),React.createElement(t,{icon:"rocket",labelPosition:"left",content:"Go to Deployment page",onClick:this.drillDownToDeploymentPage.bind(this)})):a.anyTaskFailed?React.createElement(r.Step.Actions,y()({},this.props,{showNext:!1,showPrev:!1,showStartOver:!0,startOverLabel:"Start over to fix",resetDataOnStartOver:!1}),React.createElement(n,{size:"large",percent:100,error:!0},"Installation failed. Check error details above.")):null:React.createElement(r.Step.Actions,y()({},this.props,{showNext:!1,showPrev:!1,showStartOver:!1,closeFloated:null}),React.createElement(n,{progress:!0,size:"large",percent:i,indicating:!0},"Installation in progress..."))}}]),t}(React.Component);f()(be,"propTypes",Stage.Basic.Wizard.Step.Actions.propTypes),f()(be,"initialState",{secondsRemaining:-1});var Se=function(e){function t(e){var n;return a()(this,t),(n=l()(this,c()(t).call(this,e))).state={tasks:[]},n}var n;return d()(t,e),o()(t,[{key:"componentDidMount",value:function(){var e=this,t=this.props.wizardData.tasks;this.setState({tasks:t},(function(){e.updateTasksInWizard().then((function(){return e.handleTasks(t)})).catch((function(t){return e.props.onError(e.props.id,t)}))}))}},{key:"updateTasksInWizard",value:function(){var e=this,t=this.state.tasks;return new Promise((function(n){var r=ge({},ve,{},_.countBy(t,(function(e){return e.status})));e.props.onChange(e.props.id,{tasksStats:r},!1),n({tasksStats:r})}))}},{key:"handleTask",value:function(e){var t=this,n=fe()(this.state.tasks),r=n[e];return r.changeToInProgress(),new Promise((function(e){return t.setState({tasks:n},e)})).then((function(){return r.run()})).then((function(){var n=fe()(t.state.tasks);return n[e].changeToFinished(),new Promise((function(e){return t.setState({tasks:n},e)}))})).catch((function(n){var a=fe()(t.state.tasks);return n=_.isString(n)?n:_.get(n,"message",Stage.Utils.Json.getStringValue(n)),a[e].changeToFailed(n),new Promise((function(e,i){return t.setState({tasks:a},i("Task '".concat(r.name,"' failed with error: ").concat(n)))}))})).finally((function(){return t.updateTasksInWizard()}))}},{key:"handleTasks",value:(n=re()(te.a.mark((function e(t){var n;return te.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=0;case 1:if(!(n<t.length)){e.next=7;break}return e.next=4,this.handleTask(n);case 4:n++,e.next=1;break;case 7:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"render",value:function(){var e=Stage.Basic.Form,t=this.state.tasks;return React.createElement(e,{loading:this.props.loading},React.createElement(oe,{tasks:t,withStatus:!0}))}}]),t}(React.Component);f()(Se,"propTypes",Stage.Basic.Wizard.Step.Content.propTypes);var we=ye("install","Install","Install resources",Se,be),Ee=!0,ke="Hello World Wizard",Re=!0,Pe="Deployment Wizard";Stage.defineWidget({id:"deploymentWizardButtons",name:"Deployment Wizard Buttons",description:"Shows buttons to start deployment wizard",initialWidth:2,initialHeight:8,hasReadme:!0,hasStyle:!0,isReact:!0,showHeader:!1,showBorder:!1,categories:[Stage.GenericConfig.CATEGORY.BUTTONS_AND_FILTERS],initialConfiguration:[{id:"showHelloWorldWizardButton",name:"Show Hello World Wizard button",default:Ee,type:Stage.Basic.GenericField.BOOLEAN_TYPE},{id:"helloWorldWizardButtonLabel",name:"Hello World Wizard button label",default:ke,type:Stage.Basic.GenericField.STRING_TYPE},{id:"showDeploymentWizardButton",name:"Show Deployment Wizard button",default:Re,type:Stage.Basic.GenericField.BOOLEAN_TYPE},{id:"deploymentWizardButtonLabel",name:"Deployment Wizard button label",default:Pe,type:Stage.Basic.GenericField.STRING_TYPE}],permission:Stage.GenericConfig.WIDGET_PERMISSION("deploymentWizardButtons"),render:function(e,t,n,r){var a=Stage.Basic.Divider,i=[C,L,Y,$,de,we],o=[k,L,Y,$,de,we],s=e.configuration,l=s.showHelloWorldWizardButton,u=void 0===l?Ee:l,c=s.showDeploymentWizardButton,p=void 0===c?Re:c,d=s.helloWorldWizardButtonLabel,h=void 0===d?ke:d,f=s.deploymentWizardButtonLabel,g=void 0===f?Pe:f;return React.createElement(React.Fragment,null,u&&React.createElement(m,{color:"red",icon:"globe",name:h,wizardTitle:"Hello World Wizard",steps:i,toolbox:r}),u&&p&&React.createElement(a,{hidden:!0}),p&&React.createElement(m,{color:"teal",icon:"wizard",name:g,wizardTitle:"Deployment Wizard",steps:o,toolbox:r}))}})}]);
\ No newline at end of file
+!function(e){var t={};function n(r){if(t[r])return t[r].exports;var a=t[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(r,a,function(t){return e[t]}.bind(null,a));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/console",n(n.s=37)}([function(e,t){e.exports=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}},function(e,t){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},function(e,t){function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e.exports=function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}},function(e,t,n){var r=n(7),a=n(6);e.exports=function(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?a(e):t}},function(e,t){function n(t){return e.exports=n=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},n(t)}e.exports=n},function(e,t,n){var r=n(8);e.exports=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&r(e,t)}},function(e,t){e.exports=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}},function(e,t){function n(t){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?e.exports=n=function(e){return typeof e}:e.exports=n=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(t)}e.exports=n},function(e,t){function n(t,r){return e.exports=n=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},n(t,r)}e.exports=n},function(e,t){function n(){return e.exports=n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},n.apply(this,arguments)}e.exports=n},function(e,t,n){var r=n(12),a=n(11),i=n(13);e.exports=function(e){return r(e)||a(e)||i()}},function(e,t){e.exports=function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}},function(e,t){e.exports=function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}},function(e,t){e.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}},function(e,t,n){e.exports=n(26)},function(e,t){e.exports=function(e){if(Array.isArray(e))return e}},function(e,t){e.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}},function(e,t,n){var r=n(15),a=n(19),i=n(16);e.exports=function(e,t){return r(e)||a(e,t)||i()}},function(e,t){function n(e,t,n,r,a,i,o){try{var s=e[i](o),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(r,a)}e.exports=function(e){return function(){var t=this,r=arguments;return new Promise((function(a,i){var o=e.apply(t,r);function s(e){n(o,a,i,s,l,"next",e)}function l(e){n(o,a,i,s,l,"throw",e)}s(void 0)}))}}},function(e,t){e.exports=function(e,t){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)){var n=[],r=!0,a=!1,i=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){a=!0,i=e}finally{try{r||null==s.return||s.return()}finally{if(a)throw i}}return n}}},,,,,,,function(e,t,n){var r=function(e){"use strict";var t,n=Object.prototype,r=n.hasOwnProperty,a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",o=a.asyncIterator||"@@asyncIterator",s=a.toStringTag||"@@toStringTag";function l(e,t,n,r){var a=t&&t.prototype instanceof m?t:m,i=Object.create(a.prototype),o=new O(r||[]);return i._invoke=function(e,t,n){var r=c;return function(a,i){if(r===d)throw new Error("Generator is already running");if(r===h){if("throw"===a)throw i;return x()}for(n.method=a,n.arg=i;;){var o=n.delegate;if(o){var s=R(o,n);if(s){if(s===f)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(r===c)throw r=h,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r=d;var l=u(e,t,n);if("normal"===l.type){if(r=n.done?h:p,l.arg===f)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(r=h,n.method="throw",n.arg=l.arg)}}}(e,n,o),i}function u(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=l;var c="suspendedStart",p="suspendedYield",d="executing",h="completed",f={};function m(){}function g(){}function y(){}var v={};v[i]=function(){return this};var b=Object.getPrototypeOf,S=b&&b(b(C([])));S&&S!==n&&r.call(S,i)&&(v=S);var w=y.prototype=m.prototype=Object.create(v);function E(e){["next","throw","return"].forEach((function(t){e[t]=function(e){return this._invoke(t,e)}}))}function k(e){var t;this._invoke=function(n,a){function i(){return new Promise((function(t,i){!function t(n,a,i,o){var s=u(e[n],e,a);if("throw"!==s.type){var l=s.arg,c=l.value;return c&&"object"==typeof c&&r.call(c,"__await")?Promise.resolve(c.__await).then((function(e){t("next",e,i,o)}),(function(e){t("throw",e,i,o)})):Promise.resolve(c).then((function(e){l.value=e,i(l)}),(function(e){return t("throw",e,i,o)}))}o(s.arg)}(n,a,t,i)}))}return t=t?t.then(i,i):i()}}function R(e,n){var r=e.iterator[n.method];if(r===t){if(n.delegate=null,"throw"===n.method){if(e.iterator.return&&(n.method="return",n.arg=t,R(e,n),"throw"===n.method))return f;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return f}var a=u(r,e.iterator,n.arg);if("throw"===a.type)return n.method="throw",n.arg=a.arg,n.delegate=null,f;var i=a.arg;return i?i.done?(n[e.resultName]=i.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,f):i:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,f)}function P(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function D(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function O(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(P,this),this.reset(!0)}function C(e){if(e){var n=e[i];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var a=-1,o=function n(){for(;++a<e.length;)if(r.call(e,a))return n.value=e[a],n.done=!1,n;return n.value=t,n.done=!0,n};return o.next=o}}return{next:x}}function x(){return{value:t,done:!0}}return g.prototype=w.constructor=y,y.constructor=g,y[s]=g.displayName="GeneratorFunction",e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,y):(e.__proto__=y,s in e||(e[s]="GeneratorFunction")),e.prototype=Object.create(w),e},e.awrap=function(e){return{__await:e}},E(k.prototype),k.prototype[o]=function(){return this},e.AsyncIterator=k,e.async=function(t,n,r,a){var i=new k(l(t,n,r,a));return e.isGeneratorFunction(n)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},E(w),w[s]="Generator",w[i]=function(){return this},w.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},e.values=C,O.prototype={constructor:O,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(D),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function a(r,a){return s.type="throw",s.arg=e,n.next=r,a&&(n.method="next",n.arg=t),!!a}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],s=o.completion;if("root"===o.tryLoc)return a("end");if(o.tryLoc<=this.prev){var l=r.call(o,"catchLoc"),u=r.call(o,"finallyLoc");if(l&&u){if(this.prev<o.catchLoc)return a(o.catchLoc,!0);if(this.prev<o.finallyLoc)return a(o.finallyLoc)}else if(l){if(this.prev<o.catchLoc)return a(o.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return a(o.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var a=this.tryEntries[n];if(a.tryLoc<=this.prev&&r.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var i=a;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=e,o.arg=t,i?(this.method="next",this.next=i.finallyLoc,f):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),f},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),D(n),f}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var a=r.arg;D(n)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:C(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),f}},e}(e.exports);try{regeneratorRuntime=r}catch(e){Function("r","regeneratorRuntime = r")(r)}},,,,,,,,,,,function(e,t,n){"use strict";n.r(t);var r=n(1),a=n.n(r),i=n(2),o=n.n(i),s=n(3),l=n.n(s),u=n(4),c=n.n(u),p=n(5),d=n.n(p),h=n(0),f=n.n(h),m=function(e){function t(e,n){var r;return a()(this,t),(r=l()(this,c()(t).call(this,e,n))).state={open:!1},r}return d()(t,e),o()(t,[{key:"openWizard",value:function(e){e.stopPropagation(),this.setState({open:!0})}},{key:"closeWizard",value:function(){this.setState({open:!1})}},{key:"render",value:function(){var e=Stage.Basic,t=e.Button,n=e.Icon,r=e.Wizard,a=this.props,i=a.color,o=a.icon,s=a.name,l=a.steps,u=a.toolbox,c=a.wizardTitle;return React.createElement(React.Fragment,null,React.createElement(t,{color:i,onClick:this.openWizard.bind(this),labelPosition:"left",icon:!0,className:"widgetButton"},React.createElement(n,{name:o,size:"large"}),s),React.createElement(r.Modal,{header:c,open:this.state.open,steps:l,onClose:this.closeWizard.bind(this),toolbox:u}))}}]),t}(React.Component);f()(m,"propTypes",{color:PropTypes.string.isRequired,name:PropTypes.string.isRequired,icon:PropTypes.string.isRequired,wizardTitle:PropTypes.string.isRequired,steps:Stage.Basic.Wizard.Modal.propTypes.steps,toolbox:PropTypes.object.isRequired});var g=n(9),y=n.n(g);function v(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function b(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?v(Object(n),!0).forEach((function(t){f()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):v(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var S=Stage.Basic.Wizard.Utils.createWizardStep,w=function(e){function t(e){return a()(this,t),l()(this,c()(t).call(this,e))}return d()(t,e),o()(t,[{key:"onNext",value:function(e){var t=this,n={};this.props.onLoading().then(this.props.fetchData).then((function(e){var r=e.stepData;n=r;var a=r.blueprintFile?"":r.blueprintUrl,i=r.imageFile?"":r.imageUrl,o={};return r.blueprintFile||!_.isEmpty(a)&&Stage.Utils.Url.isUrl(a)||(o.blueprintUrl="Blueprint package"),_.isEmpty(r.blueprintName)&&(o.blueprintName="Blueprint name"),_.isEmpty(r.blueprintFileName)&&(o.blueprintFileName="Blueprint YAML file"),_.isEmpty(i)||Stage.Utils.Url.isUrl(i)||(o.imageUrl="Blueprint icon"),_.isEmpty(o)?_.isNil(r.blueprintFile)?t.props.toolbox.getInternal().doPut("source/list/resources",{yamlFile:r.blueprintFileName,url:r.blueprintUrl}):t.props.toolbox.getInternal().doUpload("source/list/resources",{yamlFile:r.blueprintFileName},{archive:r.blueprintFile}):Promise.reject({message:"Please fill in the following fields with valid values: ".concat(_.values(o).join(", "),"."),errors:o})})).then((function(r){return t.props.onNext(e,{blueprint:b({},r,{},n)})})).catch((function(n){return t.props.onError(e,n.message,n.errors)}))}},{key:"render",value:function(){var e=Stage.Basic.Wizard;return React.createElement(e.Step.Actions,y()({},this.props,{onNext:this.onNext.bind(this)}))}}]),t}(React.Component);f()(w,"propTypes",Stage.Basic.Wizard.Step.Actions.propTypes);var E=function(e){function t(e){return a()(this,t),l()(this,c()(t).call(this,e))}return d()(t,e),o()(t,[{key:"componentDidMount",value:function(){this.props.onChange(this.props.id,b({},t.defaultBlueprintState,{},this.props.stepData))}},{key:"onChange",value:function(e){this.props.onChange(this.props.id,b({},this.props.stepData,{},e))}},{key:"render",value:function(){var e=this,t=Stage.Basic,n=t.Container,r=t.VisibilityField,a=Stage.Common.UploadBlueprintForm;return _.isEmpty(this.props.stepData)?null:React.createElement(React.Fragment,null,React.createElement(n,{textAlign:"right"},React.createElement(r,{visibility:this.props.stepData.visibility,className:"large",onVisibilityChange:function(t){return e.onChange({visibility:t})}})),React.createElement(a,{blueprintUrl:this.props.stepData.blueprintUrl,blueprintFile:this.props.stepData.blueprintFile,blueprintName:this.props.stepData.blueprintName,blueprintFileName:this.props.stepData.blueprintFileName,imageUrl:this.props.stepData.imageUrl,imageFile:this.props.stepData.imageFile,loading:this.props.loading,errors:this.props.errors,showErrorsSummary:!1,onChange:this.onChange.bind(this),toolbox:this.props.toolbox}))}}]),t}(React.Component);f()(E,"propTypes",Stage.Basic.Wizard.Step.Content.propTypes),f()(E,"defaultBlueprintState",{blueprintUrl:"",blueprintFile:null,blueprintName:"",blueprintFileName:"",imageUrl:"",imageFile:null,visibility:Stage.Common.Consts.defaultVisibility});var k=S("blueprint","Blueprint","Select blueprint",E,w);function R(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function P(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?R(Object(n),!0).forEach((function(t){f()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):R(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var D=Stage.Basic.Wizard.Utils.createWizardStep,O=function(e){function t(e){return a()(this,t),l()(this,c()(t).call(this,e))}return d()(t,e),o()(t,[{key:"onNext",value:function(e){var t=this,n={};this.props.onLoading().then(this.props.fetchData).then((function(e){var t=e.stepData;return n=t})).then((function(e){return t.props.toolbox.getInternal().doPut("source/list/resources",{yamlFile:e.blueprintFileName,url:e.blueprintUrl})})).then((function(r){return t.props.onNext(e,{blueprint:P({},r,{},n)})})).catch((function(){return t.props.onError(e,"Error during fetching data for the next step")}))}},{key:"render",value:function(){var e=Stage.Basic.Wizard;return React.createElement(e.Step.Actions,y()({},this.props,{onNext:this.onNext.bind(this)}))}}]),t}(React.Component);f()(O,"propTypes",Stage.Basic.Wizard.Step.Actions.propTypes);var C=function(e){function t(e){var n;return a()(this,t),(n=l()(this,c()(t).call(this,e))).state=t.initialState,n}return d()(t,e),o()(t,[{key:"componentDidMount",value:function(){_.isEmpty(this.props.stepData)?this.props.onChange(this.props.id,this.state.stepData):this.setState({stepData:P({},this.props.stepData)})}},{key:"onChange",value:function(e){var t=this;this.setState({stepData:P({},this.state.stepData,{blueprintFileName:e})},(function(){return t.props.onChange(t.props.id,t.state.stepData)}))}},{key:"render",value:function(){var e=this,t=Stage.Basic,n=t.Button,r=t.Form,a=t.Image,i=Stage.Utils.Url.widgetResourceUrl,o=this.state.stepData.blueprintFileName,s=function(t){var r;return React.createElement(n,{fluid:!0,basic:!0,size:"huge",active:t.active,name:t.value,onClick:e.onChange.bind(e,t.value)},React.createElement(a,{src:(r=t.value,i("deploymentWizardButtons","/images/".concat(_.replace(r,".yaml",""),"_logo.svg"),!1)),inline:!0,style:{cursor:"pointer",height:35}}))};return React.createElement(r,{loading:this.props.loading},_.map(_.chunk(["aws.yaml","gcp.yaml","openstack.yaml","azure.yaml"],2),(function(e,t){return React.createElement(r.Group,{key:"platformGroup".concat(t),widths:"equal"},_.map(e,(function(e){return React.createElement(r.Field,{key:e},React.createElement(s,{value:e,active:o===e}))})))})))}}]),t}(React.Component);f()(C,"defaultBlueprintName","hello-world"),f()(C,"helloWorldBlueprintUrl","https://github.com/cloudify-cosmo/cloudify-hello-world-example/archive/master.zip"),f()(C,"defaultBlueprintYaml","aws.yaml"),f()(C,"initialState",{stepData:{blueprintUrl:C.helloWorldBlueprintUrl,blueprintFile:null,blueprintName:C.defaultBlueprintName,blueprintFileName:C.defaultBlueprintYaml,imageUrl:"",imageFile:null,visibility:Stage.Common.Consts.defaultVisibility}}),f()(C,"propTypes",Stage.Basic.Wizard.Step.Content.propTypes);var x=D("infrastructure","Infrastructure","Select IaaS Provider",C,O),I=n(17),T=n.n(I),j=function(e){function t(){return a()(this,t),l()(this,c()(t).apply(this,arguments))}return d()(t,e),o()(t,[{key:"shouldComponentUpdate",value:function(e){return this.props.status!==e.status||this.props.text!==e.text}},{key:"render",value:function(){var e=Stage.Basic,n=e.Icon,r=e.Popup,a=this.props.status,i=null,o=this.props.text;switch(a){case t.unknown:i=React.createElement(n,{name:"question",color:"grey",size:"big"});break;case t.noActionRequired:i=React.createElement(n,{name:"check",color:"green",size:"big"});break;case t.actionRequired:i=React.createElement(n,{name:"warning",color:"yellow",size:"big"});break;case t.errorOccurred:default:i=React.createElement(n,{name:"cancel",color:"red",size:"big"})}return React.createElement(r,{hoverable:!0,trigger:i,header:"Status",content:o})}}]),t}(React.Component);f()(j,"unknown",0),f()(j,"noActionRequired",1),f()(j,"actionRequired",2),f()(j,"errorOccurred",3),f()(j,"propTypes",{status:PropTypes.oneOf([j.unknown,j.noActionRequired,j.actionRequired,j.errorOccurred]).isRequired,text:PropTypes.string.isRequired});var N=function(e){function t(){return a()(this,t),l()(this,c()(t).apply(this,arguments))}return d()(t,e),o()(t,[{key:"render",value:function(){var e=this.props.children;return React.createElement("div",null,e)}}]),t}(React.Component);f()(N,"propTypes",{children:PropTypes.any});var U=function(e){function t(){return a()(this,t),l()(this,c()(t).apply(this,arguments))}return d()(t,e),o()(t,[{key:"render",value:function(){var e=Stage.Basic.Message,t=this.props.resourceName;return React.createElement(e,{success:!0,icon:"checkmark",header:"No ".concat(t," required"),content:"You can go to the next step."})}}]),t}(React.Component);function B(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function z(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?B(Object(n),!0).forEach((function(t){f()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):B(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}f()(U,"propTypes",{resourceName:PropTypes.string.isRequired});var F=Stage.Basic.Wizard.Utils.createWizardStep,A=function(e){function t(e){return a()(this,t),l()(this,c()(t).call(this,e))}return d()(t,e),o()(t,[{key:"onNext",value:function(e){var t=this;return this.props.onLoading().then(this.props.fetchData).then((function(n){var r=n.stepData,a=_.pickBy(r,(function(e){return e.status!==W.statusInstalledAndParametersMatched})),i=[],o={};if(_.forEach(a,(function(e,t){var n=e.wagonFile?"":e.wagonUrl,r=e.yamlFile?"":e.yamlUrl,a=_.isEmpty(n)?!e.wagonFile:!Stage.Utils.Url.isUrl(n),s=_.isEmpty(r)?!e.yamlFile:!Stage.Utils.Url.isUrl(r);(a||s)&&(i.push(t),o[t]={wagonUrl:a,yamlUrl:s})})),!_.isEmpty(i))return Promise.reject({message:"Please correctly fill in fields for the following plugins: ".concat(i.join(", "),"."),errors:o});var s=_.pickBy(a,(function(e){return e.status===W.statusUserDefinedPlugin})),l={plugins:_.mapValues(s,(function(){return{params:{}}}))};return t.props.onNext(e,{plugins:a,userResources:l})})).catch((function(n){return t.props.onError(e,n.message,n.errors)}))}},{key:"render",value:function(){var e=Stage.Basic.Wizard;return React.createElement(e.Step.Actions,y()({},this.props,{onNext:this.onNext.bind(this)}))}}]),t}(React.Component);f()(A,"propTypes",Stage.Basic.Wizard.Step.Actions.propTypes);var W=function(e){function t(e){var n;return a()(this,t),(n=l()(this,c()(t).call(this,e))).state={pluginsInCatalog:[],pluginsInManager:[]},n}return d()(t,e),o()(t,[{key:"componentDidMount",value:function(){var e=this;this.props.onLoading().then((function(){return Promise.all([e.props.toolbox.getManager().doGet("/plugins?_include=distribution,package_name,package_version,visibility"),e.props.toolbox.getExternal().doGet("http://repository.cloudifysource.org/cloudify/wagons/plugins.json")])})).then((function(n){var r=T()(n,2),a=r[0],i=r[1],o=_.get(e.props.wizardData,t.blueprintDataPath,{}),s=_.get(e.props.wizardData,t.userDataPath,{});a=a.items,a=_.reduce(a,(function(e,t){return e[t.package_name]={version:t.package_version,distribution:t.distribution,visibility:t.visibility},e}),{}),i=_.reduce(i,(function(e,t){return e[t.name]=z({},_.omit(t,"name")),e}),{});var l={},u=!0,c=!1,p=void 0;try{for(var d,h=_.keys(o)[Symbol.iterator]();!(u=(d=h.next()).done);u=!0){var f=d.value,m=z({},t.defaultPluginState,{},e.props.stepData[f]);m.status=t.getPluginStatus(f,o,a,i),m.status===t.statusNotInstalledAndInCatalog?function(){var t="".concat(e.props.toolbox.getManager().getDistributionName().toLowerCase()," ").concat(e.props.toolbox.getManager().getDistributionRelease().toLowerCase()),n=_.find(i[f].wagons,(function(e){return e.name.toLowerCase()===t||"any"===e.name.toLowerCase()}));m.wagonUrl=n.url,m.yamlUrl=i[f].link}():m.status===t.statusInstalledAndParametersMatched&&(m.visibility=a[f].visibility),l[f]=z({},m)}}catch(e){c=!0,p=e}finally{try{u||null==h.return||h.return()}finally{if(c)throw p}}var g=!0,y=!1,v=void 0;try{for(var b,S=_.keys(s)[Symbol.iterator]();!(g=(b=S.next()).done);g=!0){var w=b.value,E=z({},t.defaultPluginState,{},e.props.stepData[w]);E.status=t.statusUserDefinedPlugin,l[w]=z({},E)}}catch(e){y=!0,v=e}finally{try{g||null==S.return||S.return()}finally{if(y)throw v}}return{stepData:l,pluginsInManager:a,pluginsInCatalog:i}})).then((function(t){var n=t.stepData,r=t.pluginsInManager,a=t.pluginsInCatalog;return new Promise((function(t){return e.setState({pluginsInManager:r,pluginsInCatalog:a},(function(){e.props.onChange(e.props.id,n),t()}))}))})).catch((function(t){return e.props.onError(e.props.id,t)})).finally((function(){return e.props.onReady()}))}},{key:"getPluginStatus",value:function(e){switch(_.get(this.props.stepData[e],"status")){case t.statusInstalledAndParametersMatched:return React.createElement(j,{status:j.noActionRequired,text:"Plugin already installed. No action required."});case t.statusInstalledAndParametersUnmatched:return React.createElement(j,{status:j.actionRequired,text:"Plugin installed but with different parameters. Provide details."});case t.statusNotInstalledAndNotInCatalog:return React.createElement(j,{status:j.actionRequired,text:"Cannot find plugin. Provide details."});case t.statusUserDefinedPlugin:return React.createElement(j,{status:j.actionRequired,text:"User defined plugin. Provide details."});case t.statusNotInstalledAndInCatalog:return React.createElement(j,{status:j.noActionRequired,text:"Plugin has been found in catalog and will be installed automatically. No action required."});case t.statusUnknown:return React.createElement(j,{status:j.unknown,text:"Unknown status."});default:return React.createElement(j,{status:j.errorOccurred,text:"Error during status calculation."})}}},{key:"onChange",value:function(e){var t=this;return function(n){var r=z({},t.props.stepData);return r[e]=z({},r[e],{},n),t.props.onChange(t.props.id,z({},r))}}},{key:"addUserPlugin",value:function(){var e=z({},this.props.stepData),n=function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"user-plugin",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3,r="",a=!1,i=0;i<n&&!a;i++)r="".concat(t,"-").concat(i),a=!e[r];return r}();e[n]=z({},t.defaultPluginState),e[n].status=t.statusUserDefinedPlugin,this.props.onChange(this.props.id,e)}},{key:"deleteUserPlugin",value:function(e){var t=z({},_.omit(this.props.stepData,e));this.props.onChange(this.props.id,t)}},{key:"getPluginAction",value:function(e){var n=_.get(this.props.stepData[e],"status"),r=Stage.Common.UploadPluginForm;switch(n){case t.statusInstalledAndParametersMatched:return React.createElement(N,null,"No action required.");case t.statusInstalledAndParametersUnmatched:case t.statusNotInstalledAndNotInCatalog:case t.statusUserDefinedPlugin:return React.createElement(N,null,React.createElement(r,{wagonUrl:this.props.stepData[e].wagonUrl,wagonFile:this.props.stepData[e].wagonFile,wagonPlaceholder:"",yamlUrl:this.props.stepData[e].yamlUrl,yamlFile:this.props.stepData[e].yamlFile,yamlPlaceholder:"",errors:this.props.errors[e],wrapInForm:!1,addRequiredMarks:!1,loading:this.props.loading,onChange:this.onChange(e).bind(this)}));case t.statusNotInstalledAndInCatalog:return React.createElement(N,null,"No action required.");case t.statusUnknown:default:return React.createElement(N,null)}}},{key:"getPluginVisibility",value:function(e){var n=this,r=Stage.Basic.VisibilityField,a=this.props.stepData[e];switch(_.get(a,"status")){case t.statusInstalledAndParametersMatched:return React.createElement(N,null,React.createElement(r,{visibility:a.visibility,className:"large",allowChange:!1}));case t.statusInstalledAndParametersUnmatched:case t.statusNotInstalledAndNotInCatalog:case t.statusNotInstalledAndInCatalog:case t.statusUserDefinedPlugin:return React.createElement(N,null,React.createElement(r,{visibility:a.visibility,className:"large",onVisibilityChange:function(t){return n.onChange(e)({visibility:t})}}));default:return null}}},{key:"isUserDefinedPlugin",value:function(e){return _.isEqual(_.get(this.props.stepData[e],"status",t.statusUnknown),t.statusUserDefinedPlugin)}},{key:"render",value:function(){var e=this,n=Stage.Basic,r=n.Button,a=n.Form,i=n.Popup,o=n.Table,s=z({},_.get(this.props.wizardData,t.blueprintDataPath,{}),{},_.get(this.props.wizardData,t.userDataPath,{})),l=_.isEmpty(this.props.stepData);return React.createElement(a,{loading:this.props.loading,success:l},l?React.createElement(U,{resourceName:"plugins"}):React.createElement(o,{celled:!0},React.createElement(o.Header,null,React.createElement(o.Row,null,React.createElement(o.HeaderCell,null,"Plugin"),React.createElement(o.HeaderCell,null,"Version"),React.createElement(o.HeaderCell,null,"Distribution"),React.createElement(o.HeaderCell,{colSpan:"3"},"Action"))),React.createElement(o.Body,null,l?React.createElement(U,{resourceName:"plugins"}):_.map(_.keys(this.props.stepData),(function(t){var n=e.state.pluginsInCatalog[t],a=Stage.Basic.Image;return React.createElement(o.Row,{key:t,name:t},React.createElement(o.Cell,{collapsing:!0},_.isNil(n)?React.createElement("span",null,t," "):React.createElement("span",null,React.createElement(a,{src:n.icon,height:"25",verticalAlign:"middle",spaced:"right"}),n.title),e.isUserDefinedPlugin(t)&&React.createElement(i,{trigger:React.createElement(r,{icon:"minus",size:"mini",onClick:e.deleteUserPlugin.bind(e,t)}),content:"Remove plugin"})),React.createElement(o.Cell,{collapsing:!0},_.get(s[t],"params.version","-")),React.createElement(o.Cell,{collapsing:!0},_.get(s[t],"params.distribution","-")),React.createElement(o.Cell,{collapsing:!0},e.getPluginStatus(t)),React.createElement(o.Cell,null,e.getPluginAction(t)),React.createElement(o.Cell,{collapsing:!0},e.getPluginVisibility(t)))})))),React.createElement(a.Button,{content:"Add plugin",icon:"add",labelPosition:"left",onClick:this.addUserPlugin.bind(this)}))}}],[{key:"getPluginStatus",value:function(e,n,r,a){var i=n[e],o=_.get(i,"params.version"),s=_.get(i,"params.distribution"),l=r[e],u=a[e];return _.isNil(l)?_.isNil(u)?t.statusNotInstalledAndNotInCatalog:_.isNil(o)||_.isEqual(o,u.version)?t.statusNotInstalledAndInCatalog:t.statusNotInstalledAndNotInCatalog:(_.isNil(o)||_.isEqual(o,l.version))&&(_.isNil(s)||_.isEqual(s,l.distribution))?t.statusInstalledAndParametersMatched:t.statusInstalledAndParametersUnmatched}}]),t}(React.Component);f()(W,"propTypes",Stage.Basic.Wizard.Step.Content.propTypes),f()(W,"statusUnknown",0),f()(W,"statusInstalledAndParametersMatched",1),f()(W,"statusInstalledAndParametersUnmatched",2),f()(W,"statusNotInstalledAndInCatalog",3),f()(W,"statusUserDefinedPlugin",4),f()(W,"statusNotInstalledAndNotInCatalog",5),f()(W,"defaultPluginState",{yamlUrl:"",yamlFile:null,wagonUrl:"",wagonFile:null,visibility:Stage.Common.Consts.defaultVisibility,status:W.statusUnknown}),f()(W,"blueprintDataPath","blueprint.plugins"),f()(W,"userDataPath","userResources.plugins");var L=F("plugins","Plugins","Select plugins",W,A);function q(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function M(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?q(Object(n),!0).forEach((function(t){f()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):q(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var G=Stage.Basic.Wizard.Utils.createWizardStep,V=function(e){function t(){return a()(this,t),l()(this,c()(t).apply(this,arguments))}return d()(t,e),o()(t,[{key:"onNext",value:function(e){var t=this;return this.props.onLoading().then(this.props.fetchData).then((function(n){var r=n.stepData,a=_.chain(r).pickBy((function(e){return e.status===H.statusUndefined})).value(),i=_.chain(r).pickBy((function(e){return e.status===H.statusUndefined&&_.isEmpty(e.value)})).mapValues((function(){return!0})).value();return _.isEmpty(i)?t.props.onNext(e,{secrets:a}):Promise.reject({message:"Provide values for the following secrets: ".concat(_.keys(i).join(", ")),errors:i})})).catch((function(n){return t.props.onError(e,n.message,n.errors)}))}},{key:"render",value:function(){var e=Stage.Basic.Wizard;return React.createElement(e.Step.Actions,y()({},this.props,{onNext:this.onNext.bind(this)}))}}]),t}(React.Component);f()(V,"propTypes",Stage.Basic.Wizard.Step.Actions.propTypes);var H=function(e){function t(e){var n;return a()(this,t),(n=l()(this,c()(t).call(this,e))).state=t.initialState,n}return d()(t,e),o()(t,[{key:"componentDidMount",value:function(){var e=this,n=_.get(this.props.wizardData,t.dataPath,{});this.props.onLoading().then((function(){return e.props.toolbox.getManager().doGet("/secrets?_include=key,visibility")})).then((function(r){r=r.items,r=_.reduce(r,(function(e,t){return e[t.key]={visibility:t.visibility},e}),{});var a={},i=!0,o=!1,s=void 0;try{for(var l,u=_.keys(n)[Symbol.iterator]();!(i=(l=u.next()).done);i=!0){var c=l.value;a[c]=e.props.stepData[c]||M({},t.defaultSecretState),_.includes(_.keys(r),c)?(a[c].status=t.statusDefined,a[c].visibility=r[c].visibility):a[c].status=t.statusUndefined}}catch(e){o=!0,s=e}finally{try{i||null==u.return||u.return()}finally{if(o)throw s}}return{stepData:a,secretsInManager:r}})).then((function(t){var n=t.stepData,r=t.secretsInManager;return new Promise((function(t){return e.setState({secretsInManager:r},(function(){e.props.onChange(e.props.id,n),t()}))}))})).catch((function(t){return e.props.onError(e.props.id,t)})).finally((function(){return e.props.onReady()}))}},{key:"getSecretStatus",value:function(e){switch(this.props.stepData[e].status){case t.statusDefined:return React.createElement(j,{status:j.noActionRequired,text:"Secret defined."});case t.statusUndefined:return React.createElement(j,{status:j.actionRequired,text:"Secret not defined. Please provide value for the secret."});default:return React.createElement(j,{status:j.unknown,text:"Unknown status. Internal error."})}}},{key:"getSecretAction",value:function(e){var n=this,r=Stage.Basic.Form,a=this.props.stepData[e];switch(a.status){case t.statusDefined:return React.createElement(N,null,"No action required.");case t.statusUndefined:return React.createElement(N,null,React.createElement(r.Input,{name:e,value:a.value,error:this.props.errors[e],fluid:!0,placeholder:"Provide secret value",onChange:function(t,r){r.name;var a=r.value;return n.handleChange(e,"value",a)}}));default:return null}}},{key:"getSecretVisibility",value:function(e){var n=this,r=Stage.Basic.VisibilityField,a=this.props.stepData[e];switch(a.status){case t.statusDefined:return React.createElement(N,null,React.createElement(r,{visibility:a.visibility,className:"large",allowChange:!1}));case t.statusUndefined:return React.createElement(N,null,React.createElement(r,{visibility:a.visibility,className:"large",onVisibilityChange:function(t){return n.handleChange(e,"visibility",t)}}));default:return null}}},{key:"handleChange",value:function(e,t,n){var r=M({},this.props.stepData[e]);r[t]=n,this.props.onChange(this.props.id,M({},this.props.stepData,f()({},e,r)))}},{key:"render",value:function(){var e=this,n=Stage.Basic,r=n.Form,a=n.Table,i=_.get(this.props.wizardData,t.dataPath,{}),o=_.isEmpty(i);return React.createElement(r,{loading:this.props.loading,success:o},o?React.createElement(U,{resourceName:"secrets"}):React.createElement(a,{celled:!0},React.createElement(a.Header,null,React.createElement(a.Row,null,React.createElement(a.HeaderCell,null,"Secret"),React.createElement(a.HeaderCell,{colSpan:"3"},"Action"))),React.createElement(a.Body,null,_.map(_.keys(this.props.stepData),(function(t){return!_.isNil(i[t])&&React.createElement(a.Row,{key:t,name:t},React.createElement(a.Cell,{collapsing:!0},t),React.createElement(a.Cell,{collapsing:!0},e.getSecretStatus(t)),React.createElement(a.Cell,null,e.getSecretAction(t)),React.createElement(a.Cell,{collapsing:!0},e.getSecretVisibility(t)))})))))}}]),t}(React.Component);f()(H,"propTypes",Stage.Basic.Wizard.Step.Content.propTypes),f()(H,"statusUnknown",0),f()(H,"statusDefined",1),f()(H,"statusUndefined",2),f()(H,"defaultSecretState",{value:"",visibility:Stage.Common.Consts.defaultVisibility,status:H.statusUnknown}),f()(H,"dataPath","blueprint.secrets"),f()(H,"initialState",{secretsInManager:[]});var Y=G("secrets","Secrets","Define secrets",H,V);function J(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function K(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?J(Object(n),!0).forEach((function(t){f()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):J(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Q=Stage.Basic.Wizard.Utils.createWizardStep,X=function(e){function t(e){return a()(this,t),l()(this,c()(t).call(this,e))}return d()(t,e),o()(t,[{key:"onNext",value:function(e){var n=this,r=Stage.Common.InputsUtils;return this.props.onLoading().then(this.props.fetchData).then((function(a){var i=a.stepData,o={},s=_.get(n.props.wizardData,t.inputsDataPath,{}),l=r.getInputsToSend(s,i,o);return _.isEmpty(o)?n.props.onNext(e,{inputs:K({},l)}):Promise.reject({message:"Provide values for the following inputs: ".concat(_.keys(o).join(", ")),errors:o})})).catch((function(t){return n.props.onError(e,t.message,t.errors)}))}},{key:"render",value:function(){var e=Stage.Basic.Wizard;return React.createElement(e.Step.Actions,y()({},this.props,{onNext:this.onNext.bind(this)}))}}]),t}(React.Component);f()(X,"propTypes",Stage.Basic.Wizard.Step.Actions.propTypes),f()(X,"inputsDataPath","blueprint.inputs");var Z=function(e){function t(e){var n;return a()(this,t),(n=l()(this,c()(t).call(this,e))).state={fileLoading:!1},n}return d()(t,e),o()(t,[{key:"componentDidMount",value:function(){var e=this,n=_.get(this.props.wizardData,t.inputsDataPath,{}),r=_.get(this.props.wizardData,t.dataTypesDataPath,{}),a=_.mapValues(n,(function(t,a){if(!_.isUndefined(e.props.stepData[a]))return e.props.stepData[a];var i=!_.isEmpty(r)&&n[a].type?r[n[a].type]:void 0;return Stage.Common.InputsUtils.getInputFieldInitialValue(t.default,t.type,i)}));this.props.onChange(this.props.id,K({},a))}},{key:"handleInputChange",value:function(e,t){this.props.onChange(this.props.id,K({},this.props.stepData,{},Stage.Basic.Form.fieldNameValue(t)))}},{key:"handleYamlFileChange",value:function(e){var n=this;if(e){var r=Stage.Common,a=r.FileActions,i=r.InputsUtils,o=new a(this.props.toolbox);this.setState({fileLoading:!0}),o.doGetYamlFileContent(e).then((function(e){var r=_.get(n.props.wizardData,t.inputsDataPath,{}),a=i.getUpdatedInputs(r,n.props.stepData,e);n.props.onChange(n.props.id,K({},a)),n.setState({fileLoading:!1})})).catch((function(e){var t="Loading values from YAML file failed: ".concat(_.isString(e)?e:e.message);n.props.onError(n.props.id,t,{yamlFile:t}),n.setState({fileLoading:!1})}))}}},{key:"getInputStatus",value:function(e){return _.isNil(e)?React.createElement(j,{status:j.actionRequired,text:"Input has no default value defined. Please provide value."}):React.createElement(j,{status:j.noActionRequired,text:"Input has default value defined. No action required."})}},{key:"render",value:function(){var e=this,n=Stage.Basic,r=n.Divider,a=n.Form,i=n.Table,o=Stage.Common,s=o.DataTypesButton,l=o.InputsUtils,u=o.InputsHeader,c=o.YamlFileButton,p=_.get(this.props.wizardData,t.inputsDataPath,{}),d=_.get(this.props.wizardData,t.dataTypesDataPath,{}),h=_.isEmpty(p);return React.createElement(a,{loading:this.props.loading,success:h},h?React.createElement(U,{resourceName:"inputs"}):React.createElement("div",null,React.createElement(c,{onChange:this.handleYamlFileChange.bind(this),dataType:"deployment's inputs",fileLoading:this.state.fileLoading}),!_.isEmpty(d)&&React.createElement(s,{types:d}),React.createElement(r,{hidden:!0,style:{clear:"both"}}),React.createElement(i,{celled:!0},React.createElement(i.Header,null,React.createElement(i.Row,null,React.createElement(i.HeaderCell,null,"Input"),React.createElement(i.HeaderCell,{colSpan:"2"},React.createElement(u,{header:"Value",dividing:!1})))),React.createElement(i.Body,null,_.map(_.keys(this.props.stepData),(function(t){if(!_.isNil(p[t])){var n=!_.isEmpty(d)&&p[t].type?d[p[t].type]:void 0,r=l.getHelp(p[t].description,p[t].type,p[t].constraints,p[t].default,n);return React.createElement(i.Row,{key:t,name:t},React.createElement(i.Cell,{collapsing:!0},React.createElement(a.Field,{key:t,help:r,label:t})),React.createElement(i.Cell,{collapsing:!0},e.getInputStatus(p[t].default)),React.createElement(i.Cell,null,l.getInputField(t,e.props.stepData[t],p[t].default,e.handleInputChange.bind(e),e.props.errors[t],p[t].type,p[t].constraints)))}return null}))))))}}]),t}(React.Component);f()(Z,"propTypes",Stage.Basic.Wizard.Step.Content.propTypes),f()(Z,"inputsDataPath","blueprint.inputs"),f()(Z,"dataTypesDataPath","blueprint.dataTypes");var $=Q("inputs","Inputs","Provide inputs",Z,X),ee=n(14),te=n.n(ee),ne=n(18),re=n.n(ne),ae=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.Status.pending,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;a()(this,e),this.name=t,this.promise=n,this.status=r,this.error=i}return o()(e,[{key:"changeToInProgress",value:function(){this.status=e.Status.inProgress}},{key:"changeToFinished",value:function(){this.status=e.Status.finished}},{key:"changeToFailed",value:function(t){this.status=e.Status.failed,this.error=t}},{key:"isPending",value:function(){return this.status===e.Status.pending}},{key:"isInProgress",value:function(){return this.status===e.Status.inProgress}},{key:"isFinished",value:function(){return this.status===e.Status.finished}},{key:"isFailed",value:function(){return this.status===e.Status.failed}},{key:"run",value:function(){return this.promise()}}]),e}();f()(ae,"Status",{pending:0,inProgress:1,finished:2,failed:3});var ie=function(e){function t(){return a()(this,t),l()(this,c()(t).apply(this,arguments))}return d()(t,e),o()(t,[{key:"getStatusIcon",value:function(){var e=Stage.Basic.Icon,t={color:"",loading:!1,name:""};switch(this.props.status){case ae.Status.pending:t.color="black",t.name="clock";break;case ae.Status.inProgress:t.color="grey",t.loading=!0,t.name="spinner";break;case ae.Status.finished:t.color="green",t.name="check";break;case ae.Status.failed:t.color="red",t.name="remove"}return React.createElement(e,t)}},{key:"getStatusText",value:function(){var e=this.props,t=e.error,n=e.status,r="",a=t?React.createElement("em",null,t):null;switch(n){case ae.Status.pending:r="Pending.";break;case ae.Status.inProgress:r="In progress.";break;case ae.Status.finished:r="Finished successfully.";break;case ae.Status.failed:r="Failed with error: "}return React.createElement(React.Fragment,null,React.createElement("strong",null,r),a)}},{key:"render",value:function(){var e=this.props.name,t=this.getStatusIcon(),n=this.getStatusText();return React.createElement("span",null,e,"... ",t," ",n)}}]),t}(React.Component);f()(ie,"propTypes",{name:PropTypes.string.isRequired,status:PropTypes.oneOf([ae.Status.pending,ae.Status.inProgress,ae.Status.finished,ae.Status.failed]).isRequired,error:PropTypes.string});var oe=function(e){function t(){return a()(this,t),l()(this,c()(t).apply(this,arguments))}return d()(t,e),o()(t,[{key:"render",value:function(){var e=this,t=this.props.tasks,n=Stage.Basic,r=n.Header,a=n.List;return React.createElement(React.Fragment,null,React.createElement(r,{as:"h4"},this.props.header),React.createElement(a,{ordered:!0,relaxed:!0},_.map(t,(function(t){return React.createElement(a.Item,{key:t.name},e.props.withStatus?React.createElement(ie,t):t.name)}))))}}]),t}(React.Component);function se(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function le(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?se(Object(n),!0).forEach((function(t){f()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):se(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}f()(oe,"propTypes",{header:PropTypes.string,tasks:PropTypes.arrayOf(PropTypes.shape(ie.propTypes)),withStatus:PropTypes.bool}),f()(oe,"defaultProps",{header:"Task list",withStatus:!1});var ue=Stage.Basic.Wizard.Utils.createWizardStep,ce=function(e){function t(e){return a()(this,t),l()(this,c()(t).call(this,e))}var n;return d()(t,e),o()(t,[{key:"isUsed",value:(n=re()(te.a.mark((function e(t){var n,r;return te.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new Stage.Common.DeploymentActions(this.props.toolbox),r=function(){return n.doGetDeployments({_search:t})},e.t0=_,e.t1=t,e.next=6,pe.chooseId(t,r,"deployment");case 6:return e.t2=e.sent,e.abrupt("return",!e.t0.isEqual.call(e.t0,e.t1,e.t2));case 8:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"onNext",value:function(e){var t=this;return this.props.onLoading().then(this.props.fetchData).then((function(e){var n=e.stepData;return t.isUsed(n.deploymentId).then((function(e){return{stepData:n,isDeploymentNameUsed:e}}))})).then((function(n){var r=n.stepData;n.isDeploymentNameUsed?t.props.onError(e,"Deployment name '".concat(r.deploymentId,"' is already used. Please choose a different one."),{deploymentId:!0}):t.props.onNext(e,{tasks:r.tasks,installOutputs:{deploymentId:r.deploymentId,blueprintId:r.blueprintId}})})).catch((function(n){return t.props.onError(e,n)}))}},{key:"render",value:function(){var e=Stage.Basic.Wizard;return React.createElement(e.Step.Actions,y()({},this.props,{onNext:this.onNext.bind(this),nextLabel:"Install",nextIcon:"download"}))}}]),t}(React.Component);f()(ce,"propTypes",Stage.Basic.Wizard.Step.Actions.propTypes);var pe=function(e){function t(e){return a()(this,t),l()(this,c()(t).call(this,e))}return d()(t,e),o()(t,[{key:"addPluginsTasks",value:function(e,t){var n=new Stage.Common.PluginActions(this.props.toolbox),r=!0,a=!1,i=void 0;try{for(var o,s=function(){var r=o.value,a=e[r],i=a.wagonFile?"":a.wagonUrl,s=a.yamlFile?"":a.yamlUrl;t.push(new ae("Upload plugin ".concat(r),(function(){return n.doUpload(a.visibility,i,s,a.wagonFile,a.yamlFile)})))},l=_.keys(e)[Symbol.iterator]();!(r=(o=l.next()).done);r=!0)s()}catch(e){a=!0,i=e}finally{try{r||null==l.return||l.return()}finally{if(a)throw i}}return Promise.resolve()}},{key:"addSecretsTasks",value:function(e,t){var n=new Stage.Common.SecretActions(this.props.toolbox),r=!0,a=!1,i=void 0;try{for(var o,s=function(){var r=o.value,a=e[r].value,i=e[r].visibility;t.push(new ae("Create secret ".concat(r),(function(){return n.doCreate(r,a,i,!1)})))},l=_.keys(e)[Symbol.iterator]();!(r=(o=l.next()).done);r=!0)s()}catch(e){a=!0,i=e}finally{try{r||null==l.return||l.return()}finally{if(a)throw i}}return Promise.resolve()}},{key:"chooseBlueprintId",value:function(e){var n=new Stage.Common.BlueprintActions(this.props.toolbox);return t.chooseId(e,(function(){return n.doGetBlueprints({_search:e})}),"blueprint")}},{key:"addBlueprintUploadTask",value:function(e,t){var n=new Stage.Common.BlueprintActions(this.props.toolbox),r=e.blueprintFile?"":e.blueprintUrl,a=e.imageFile?"":e.imageUrl;return t.push(new ae("Upload blueprint ".concat(e.blueprintName),(function(){return n.doUpload(e.blueprintName,e.blueprintFileName,r,e.blueprintFile,a,e.imageFile,e.visibility)}))),Promise.resolve()}},{key:"chooseDeploymentId",value:function(e){var n=new Stage.Common.DeploymentActions(this.props.toolbox);return t.chooseId(e,(function(){return n.doGetDeployments({_search:e})}),"deployment")}},{key:"addDeployBlueprintTask",value:function(e,t,n,r,a){var i=new Stage.Common.BlueprintActions(this.props.toolbox),o=new Stage.Common.DeploymentActions(this.props.toolbox);return a.push(new ae("Create ".concat(e," deployment from ").concat(t," blueprint"),(function(){return i.doDeploy({id:t},e,n,r).then((function(){return o.waitUntilCreated(e)}))}))),Promise.resolve()}},{key:"addRunInstallWorkflowTask",value:function(e,t){var n=new Stage.Common.DeploymentActions(this.props.toolbox);return t.push(new ae("Execute install workflow on ".concat(e," deployment"),(function(){return n.doExecute({id:e},{name:"install"},{},!1)}))),Promise.resolve()}},{key:"componentDidMount",value:function(){var e=this,t=this.props.wizardData,n=[],r="",a="";this.props.onLoading().then((function(){return e.addPluginsTasks(t.plugins,n)})).then((function(){return e.addSecretsTasks(t.secrets,n)})).then((function(){return e.chooseBlueprintId(t.blueprint.blueprintName)})).then((function(a){return r=a,e.addBlueprintUploadTask(le({},t.blueprint,{blueprintName:a}),n)})).then((function(){return e.chooseDeploymentId(r)})).then((function(i){a=i,e.addDeployBlueprintTask(i,r,t.inputs,t.blueprint.visibility,n)})).then((function(){return e.addRunInstallWorkflowTask(a,n)})).then((function(){return{stepData:{tasks:n,blueprintId:r,deploymentId:a}}})).then((function(t){var n=t.stepData;return e.props.onChange(e.props.id,n)})).then((function(){return e.setState({deploymentId:a})})).catch((function(t){return e.props.onError(e.props.id,t)})).finally((function(){return e.props.onReady()}))}},{key:"handleInputChange",value:function(e,t){var n=_.dropRight(this.props.stepData.tasks,2);this.addDeployBlueprintTask(t.value,this.props.stepData.blueprintId,this.props.wizardData.inputs,this.props.wizardData.blueprint.visibility,n),this.addRunInstallWorkflowTask(t.value,n),this.props.onChange(this.props.id,le({},this.props.stepData,{tasks:n},Stage.Basic.Form.fieldNameValue(t)))}},{key:"render",value:function(){var e=Stage.Basic.Form,t=_.get(this.props.stepData,"tasks",[]),n=_.get(this.props.stepData,"deploymentId",[]);return React.createElement(e,{loading:this.props.loading},React.createElement(e.Input,{label:"Deployment name",name:"deploymentId",value:n,fluid:!0,error:this.props.errors.deploymentId,required:!0,onChange:this.handleInputChange.bind(this)}),React.createElement(oe,{tasks:t}))}}],[{key:"chooseId",value:function(e,t,n){var r=function(e,t){return!_.isUndefined(_.find(e,{id:t}))},a=e,i=!1;return t().then((function(t){var o=t.items;i=!r(o,a);for(var s=0;s<1e3&&!i;s++)a="".concat(e,"_").concat(s),i=!r(o,a);return i?Promise.resolve(a):Promise.reject("Not found unused ".concat(n," ID."))}))}}]),t}(React.Component);f()(pe,"propTypes",Stage.Basic.Wizard.Step.Content.propTypes);var de=ue("confirm","Confirm","Confirm installation",pe,ce),he=n(10),fe=n.n(he);function me(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ge(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?me(Object(n),!0).forEach((function(t){f()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):me(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ye=Stage.Basic.Wizard.Utils.createWizardStep,ve=_.reduce(_.values(ae.Status),(function(e,t){return ge({},e,f()({},t,0))}),{}),be=function(e){function t(e){var n;return a()(this,t),(n=l()(this,c()(t).call(this,e))).redirectionInterval=null,n.state=t.initialState,n}return d()(t,e),o()(t,[{key:"componentDidMount",value:function(){this.setState(t.initialState)}},{key:"componentDidUpdate",value:function(){var e=this,t=this.getTasksStats();if(-1===this.state.secondsRemaining&&t.allTasksEnded){this.setState({secondsRemaining:10}),this.redirectionInterval=setInterval((function(){e.setState({secondsRemaining:e.state.secondsRemaining-1},(function(){e.state.secondsRemaining<=0&&(e.cancelRedirection(),e.drillDownToDeploymentPage())}))}),1e3)}}},{key:"componentWillUnmount",value:function(){this.cancelRedirection()}},{key:"drillDownToDeploymentPage",value:function(){var e=_.get(this.props,"wizardData.installOutputs.deploymentId",null);this.props.toolbox.drillDown(this.props.toolbox.getWidget(),"deployment",{deploymentId:e},e)}},{key:"cancelRedirection",value:function(){this.setState({secondsRemaining:0}),clearInterval(this.redirectionInterval)}},{key:"getTasksStats",value:function(){var e=_.get(this.props,"wizardData.tasksStats",ve),t=_.get(this.props,"wizardData.tasks.length",0),n=e[ae.Status.finished]+e[ae.Status.failed],r=n===t,a=e[ae.Status.failed]>0;return{numberOfTasks:t,numberOfEndedTasks:n,anyTaskFailed:a,allTasksEnded:r,installationEnded:r||a}}},{key:"render",value:function(){var e=Stage.Basic,t=e.Button,n=e.Progress,r=e.Wizard,a=this.getTasksStats(),i=a.numberOfTasks>0?Math.floor(a.numberOfEndedTasks/a.numberOfTasks*100):0;return a.installationEnded||-1!==this.state.secondsRemaining?a.allTasksEnded&&this.state.secondsRemaining>0?React.createElement(r.Step.Actions,y()({},this.props,{showNext:!1,showPrev:!1,showStartOver:!1,showClose:!1}),React.createElement(n,{size:"large",percent:i,autoSuccess:!0},"Installation started! Redirecting to deployment page in ",this.state.secondsRemaining," seconds..."),React.createElement(t,{content:"Stay on this page",icon:"hand paper",labelPosition:"left",onClick:this.cancelRedirection.bind(this)})):a.allTasksEnded&&0===this.state.secondsRemaining?React.createElement(r.Step.Actions,y()({},this.props,{showNext:!1,showPrev:!1,showStartOver:!0,startOverLabel:"Install another blueprint",resetDataOnStartOver:!0}),React.createElement(n,{size:"large",percent:i,autoSuccess:!0},"Installation started!"),React.createElement(t,{icon:"rocket",labelPosition:"left",content:"Go to Deployment page",onClick:this.drillDownToDeploymentPage.bind(this)})):a.anyTaskFailed?React.createElement(r.Step.Actions,y()({},this.props,{showNext:!1,showPrev:!1,showStartOver:!0,startOverLabel:"Start over to fix",resetDataOnStartOver:!1}),React.createElement(n,{size:"large",percent:100,error:!0},"Installation failed. Check error details above.")):null:React.createElement(r.Step.Actions,y()({},this.props,{showNext:!1,showPrev:!1,showStartOver:!1,closeFloated:null}),React.createElement(n,{progress:!0,size:"large",percent:i,indicating:!0},"Installation in progress..."))}}]),t}(React.Component);f()(be,"propTypes",Stage.Basic.Wizard.Step.Actions.propTypes),f()(be,"initialState",{secondsRemaining:-1});var Se=function(e){function t(e){var n;return a()(this,t),(n=l()(this,c()(t).call(this,e))).state={tasks:[]},n}var n;return d()(t,e),o()(t,[{key:"componentDidMount",value:function(){var e=this,t=this.props.wizardData.tasks;this.setState({tasks:t},(function(){e.updateTasksInWizard().then((function(){return e.handleTasks(t)})).catch((function(t){return e.props.onError(e.props.id,t)}))}))}},{key:"updateTasksInWizard",value:function(){var e=this,t=this.state.tasks;return new Promise((function(n){var r=ge({},ve,{},_.countBy(t,(function(e){return e.status})));e.props.onChange(e.props.id,{tasksStats:r},!1),n({tasksStats:r})}))}},{key:"handleTask",value:function(e){var t=this,n=fe()(this.state.tasks),r=n[e];return r.changeToInProgress(),new Promise((function(e){return t.setState({tasks:n},e)})).then((function(){return r.run()})).then((function(){var n=fe()(t.state.tasks);return n[e].changeToFinished(),new Promise((function(e){return t.setState({tasks:n},e)}))})).catch((function(n){var a=fe()(t.state.tasks);return n=_.isString(n)?n:_.get(n,"message",Stage.Utils.Json.getStringValue(n)),a[e].changeToFailed(n),new Promise((function(e,i){return t.setState({tasks:a},i("Task '".concat(r.name,"' failed with error: ").concat(n)))}))})).finally((function(){return t.updateTasksInWizard()}))}},{key:"handleTasks",value:(n=re()(te.a.mark((function e(t){var n;return te.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=0;case 1:if(!(n<t.length)){e.next=7;break}return e.next=4,this.handleTask(n);case 4:n++,e.next=1;break;case 7:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"render",value:function(){var e=Stage.Basic.Form,t=this.state.tasks;return React.createElement(e,{loading:this.props.loading},React.createElement(oe,{tasks:t,withStatus:!0}))}}]),t}(React.Component);f()(Se,"propTypes",Stage.Basic.Wizard.Step.Content.propTypes);var we=ye("install","Install","Install resources",Se,be),Ee=!0,ke="Hello World Wizard",Re=!0,Pe="Deployment Wizard";Stage.defineWidget({id:"deploymentWizardButtons",name:"Deployment Wizard Buttons",description:"Shows buttons to start deployment wizard",initialWidth:2,initialHeight:8,hasReadme:!0,hasStyle:!0,isReact:!0,showHeader:!1,showBorder:!1,categories:[Stage.GenericConfig.CATEGORY.BUTTONS_AND_FILTERS],initialConfiguration:[{id:"showHelloWorldWizardButton",name:"Show Hello World Wizard button",default:Ee,type:Stage.Basic.GenericField.BOOLEAN_TYPE},{id:"helloWorldWizardButtonLabel",name:"Hello World Wizard button label",default:ke,type:Stage.Basic.GenericField.STRING_TYPE},{id:"showDeploymentWizardButton",name:"Show Deployment Wizard button",default:Re,type:Stage.Basic.GenericField.BOOLEAN_TYPE},{id:"deploymentWizardButtonLabel",name:"Deployment Wizard button label",default:Pe,type:Stage.Basic.GenericField.STRING_TYPE}],permission:Stage.GenericConfig.WIDGET_PERMISSION("deploymentWizardButtons"),render:function(e,t,n,r){var a=Stage.Basic.Divider,i=[x,L,Y,$,de,we],o=[k,L,Y,$,de,we],s=e.configuration,l=s.showHelloWorldWizardButton,u=void 0===l?Ee:l,c=s.showDeploymentWizardButton,p=void 0===c?Re:c,d=s.helloWorldWizardButtonLabel,h=void 0===d?ke:d,f=s.deploymentWizardButtonLabel,g=void 0===f?Pe:f;return React.createElement(React.Fragment,null,u&&React.createElement(m,{color:"red",icon:"globe",name:h,wizardTitle:"Hello World Wizard",steps:i,toolbox:r}),u&&p&&React.createElement(a,{hidden:!0}),p&&React.createElement(m,{color:"teal",icon:"wizard",name:g,wizardTitle:"Deployment Wizard",steps:o,toolbox:r}))}})}]);
\ No newline at end of file
